<html dir="ltr">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=3, user-scalable=no, width=device-width">
  <title>MoTrack Therapy App</title>

  <!-- MoTrackThemeForComputer is MoTrackTheme but has different properties for
         hover (I had this at first for MoTrackTheme, but then it had weird effects
         on phone (for example, device would stay hovered after being clicked)) -->
  <link rel="stylesheet" href="css/themes/MoTrackTheme.css">
  <link rel="stylesheet" href="css/themes/jquery.mobile.icons.min.css">
  <link rel="stylesheet" href="jquery/jquery.mobile-1.4.5.min.css">
  <script src="jquery/jquery-1.11.1.min.js"></script>
  <script src="jquery/jquery.mobile-1.4.5.min.js"></script>

  <link rel="stylesheet" href="css/appui.css">

  <!-- for manifest, see tutorial https://developers.google.com/web/fundamentals/web-app-manifest/ -->
  <link rel="manifest" href="manifest.json" crossorigin="use-credentials">


  <!-- Below is the entire firebase library. However, to save space, let's only use the parts we need -->
  <!--<script src="firebasejs/firebase.js"></script> <!-- -->
  <!-- To save space, let's only use the parts we need however-->
  <script src="firebasejs/firebase-app.js"></script> <!-- -->
  <script src="firebasejs/firebase-auth.js"></script> <!-- -->
  <script src="firebasejs/firebase-database.js"></script> <!-- -->
  <script src="firebasejs/firebase-storage.js"></script> <!-- -->
  <script src="firebasejs/firebase-messaging.js"></script> <!-- -->
  <script src="firebasejs/firebase-functions.js"></script> <!-- -->

  <!-- Here are the actual urls instead of using the files I downloaded.
  <script src="https://www.gstatic.com/firebasejs/5.7.1/firebase.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.7.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.7.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.7.1/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.7.1/firebase-messaging.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.7.1/firebase-functions.js"></script>


  <!-- this library allows you to make easily customizable html templates -->
  <script src="jquery/mustache.min.js"></script> <!-- -->

  <!-- this library allows you make charts -->
  <script src="jquery/Chart.bundle.min.js"></script>


  <script>

    // Initialize Firebase
    function completionCallback(err) { // if firebase command is unsuccessful
      if (err) { // The write failed...
        showAndroidToast("Error saving data");
        console.log(err);
      } else { // Data saved successfully!
        console.log("Data saved successfully")
      }
    }
    var firebase_config = {
      apiKey: "AIzaSyDTt4Mjyx6z75KwfvYaXocBc0sTmG3b3lQ",
      authDomain: "motracktherapymobileapp.firebaseapp.com",
      databaseURL: "https://motracktherapymobileapp.firebaseio.com",
      projectId: "motracktherapymobileapp",
      storageBucket: "motracktherapymobileapp.appspot.com",
      messagingSenderId: "512965618127"
    };
    firebase.initializeApp(firebase_config);
    var database = firebase.database();
    var storage  = firebase.storage();
    var storageRef = storage.ref();
    var useMessaging = false; //messaging isn't working yet on the phones (as opposed to computer) and might crash the app
    var messaging = useMessaging ? firebase.messaging() : null;
    var functions = firebase.functions();


    if (useMessaging) {
      // Add the public key generated from the console here.
      messaging.usePublicVapidKey("BEk5GjGjhWcShUorgJZqX9S1z0Nq4hdGrW1CA0I2bfx3BCjmntk4lsQNo20GR3OZ5UV-Rfj4bgdvleBuO0Amop0");
    }

    var uid = null;
    var displayName;
    var email = null;
    var loginSessionID = null;
    var createAccountValues = null;

    var ANDROID_DEVICE = 1;
    var IOS_DEVICE = -1;
    var OTHER_DEVICE = 0;
    var MAC_OS = -2; //unused, but here for c++ consistency
    var LINUX_OS = -3; //unused, but here for c++ consistency

    var device = 0;
    var versionName = "N/A";
    var versionCode = 0;
    if (typeof Android !== 'undefined') { //window.webkit.messageHandlers.startGame.postMessage(exerciseGame*100+nrtbc_each);
      device = ANDROID_DEVICE
      setAppVersions(Android.getVersionName(), Android.getVersionCode());
    } else if (typeof window.webkit !== 'undefined') {
      device = IOS_DEVICE
      versionName = "iOS";
      //app version will be set by a function call from swift
    } else {
      device = OTHER_DEVICE
      versionName = "Web";
      setAppVersions(versionName, versionCode);
    }

    var currentGameID = 0;

    //will represent the video html DOM element
    var video1_player;
    var video2_player;
    var video1_ended = function(e) {
      navigateTo("#video2-screen");
    };;
    var video2_ended;
    var VIDEO2_PLAYER_PART2_TIME = 87; //units of seconds (not milliseconds)
    var allowAutologin = device == OTHER_DEVICE ? true : true;
    var TEST_MODE_ENABLED = false; //*** Turn this off before pushing to app store/play store ***

    var background_calib_algorithm = 4;
    var play_tutorial_videos = true;
    var play_gen_tutorial_video = false;

    var header_has_back = device === ANDROID_DEVICE ? false : true; //whether header has a home button or back button
    var is_test_account = false;
    var use_local_tutorial_vid_files = false; //set to true for now, since all the files fit and it is faster this way
    var is_sound_enabled = true;
    var is_access_code_required_for_therapist = false;
    var num_days_ago_progress_showing = 0;
    var num_days_ago_increment_amt = 1;
    var should_use_left_hand = false;

    var FIST_SQUEEZE_BOTTLE_GAME = 100,
            FIST_PUMP_BALLOON_GAME = 102,
            FIST_PLAIN_GAME = 105,
            HOOK_FIST_PLAIN_GAME = 115,
            DEVIATION_WINDSHIELD_WIPER_GAME = 120,
            DEVIATION_CATAPULT_LAUNCH_GAME = 122,
            DEVIATION_PLAIN_GAME = 125,
            FLEXION_DOOR_KNOCK_GAME = 130,
            FLEXION_CLIFF_MINE_GAME = 132,
            FLEXION_PLAIN_GAME = 135,
            PRONATION_TURN_DIAL_GAME = 150,
            PRONATION_KETCHUP_SHAKE_GAME = 152,
            PRONATION_PLAIN_GAME = 155,
            FABDUCTION_PEACOCK_GAME = 160,
            EXERCISE_GAME_ABDUCTION_PLAIN = 165,
            TOPPOSITION_ALLIGATOR_GAME = 170,
            EXERCISE_GAME_OPPOSITION_PLAIN = 175;
    //for exercise_map and games_map2, if "enabled" is set here to be false, it will be hardcoded in, otherwise, it will get the value from firebase
    var games_map2 = [
        {exerciseGameNum: FLEXION_DOOR_KNOCK_GAME,         showVideo:  true, gameIndex: 0, longGameName:"Door Knock",       shortGameName:"Knock",      longExerciseName:"Wrist Flexion/Extension",      shortExerciseName:"Flexion",    repSetLen: 2, repDifficultyRatio:  1, scoringSystem: 1}, //repSetLen is the increment number of the reps (i.e. if repSetLen is 2, then reps must be 0,2,4,6,8, etc). Make sure to change both this and data-change-unit in the incrementer/decrementer.
        {exerciseGameNum: FIST_SQUEEZE_BOTTLE_GAME,        showVideo:  true, gameIndex: 1, longGameName:"Bottle Squeeze",   shortGameName:"Squeeze",    longExerciseName:"Fist",                         shortExerciseName:"Fist",       repSetLen: 2, repDifficultyRatio:  1, scoringSystem: 1},
        {exerciseGameNum: DEVIATION_WINDSHIELD_WIPER_GAME, showVideo:  true, gameIndex: 2, longGameName:"Windshield Wipe",  shortGameName:"Windshield", longExerciseName:"Wrist Radial/Ulnar Deviation", shortExerciseName:"Deviation",  repSetLen: 2, repDifficultyRatio:  1, scoringSystem: 1},
        {exerciseGameNum: PRONATION_TURN_DIAL_GAME,        showVideo:  true, gameIndex: 3, longGameName:"Dial Turn",        shortGameName:"Dial",       longExerciseName:"Pronation/Supination",         shortExerciseName:"Pronation",  repSetLen: 2, repDifficultyRatio:  1, scoringSystem: 1},
        {exerciseGameNum: FIST_PUMP_BALLOON_GAME,          showVideo:  true, gameIndex: 4, longGameName:"Balloon Pump",     shortGameName:"Balloon",    longExerciseName:"Fist",                         shortExerciseName:"Fist",       repSetLen: 1, repDifficultyRatio: 10, scoringSystem: 2},
        {exerciseGameNum: DEVIATION_CATAPULT_LAUNCH_GAME,  showVideo:  true, gameIndex: 5, longGameName:"Catapult Launch",  shortGameName:"Catapult",   longExerciseName:"Wrist Radial/Ulnar Deviation", shortExerciseName:"Deviation",  repSetLen: 1, repDifficultyRatio: 10, scoringSystem: 2},
        {exerciseGameNum: FLEXION_CLIFF_MINE_GAME,         showVideo:  true, gameIndex: 6, longGameName:"Cliff Mine",       shortGameName:"Cliff",      longExerciseName:"Wrist Flexion/Extension",      shortExerciseName:"Flexion",    repSetLen: 1, repDifficultyRatio: 10, scoringSystem: 2},
        {exerciseGameNum: PRONATION_KETCHUP_SHAKE_GAME,    showVideo:  true, gameIndex: 7, longGameName:"Ketchup Shake",    shortGameName:"Ketchup",    longExerciseName:"Pronation/Supination",         shortExerciseName:"Pronation",  repSetLen: 1, repDifficultyRatio: 10, scoringSystem: 2},
        {exerciseGameNum: FABDUCTION_PEACOCK_GAME,         showVideo:  true, gameIndex: 8, longGameName:"Peacock Fan",      shortGameName:"Peacock",    longExerciseName:"Finger Abduction/Adduction",   shortExerciseName:"Abduction",  repSetLen: 2, repDifficultyRatio:  1, scoringSystem: 1},
        {exerciseGameNum: TOPPOSITION_ALLIGATOR_GAME,      showVideo:  true, gameIndex: 9, longGameName:"Alligator Chomp",  shortGameName:"Alligator",  longExerciseName:"Thumb Opposition",             shortExerciseName:"Opposition", repSetLen: 2, repDifficultyRatio:  1, scoringSystem: 1},
      ];

      var exercises_map = [{
          num : 2,
          descriptive_exercise_name : "Open Palm/Closed Fist",
          descriptive_short_exercise_name : "Open Palm/Closed Fist",
          short_exercise_name_lc : "fist",
          percentage_filled : 0,
          background_color: "#E3C1E8",
          //Note: COLOR CANNOT BE IN HEX, or the progress coloring system will break.
          background_color_rgba: "rgba(227,193,232,1)", //"#E3C1E8" //if no value is put, it will default to MoTrack blue
          background_color_name: "Purple",
        },{
          num : 7,
          descriptive_exercise_name : "Hook Fist/Table Top",
          descriptive_short_exercise_name : "Hook Fist/Table Top",
          short_exercise_name_lc : "hook-fist",
          percentage_filled : 0,
          background_color: "#FDA8D0",
          //Note: COLOR CANNOT BE IN HEX, or the progress coloring system will break.
          background_color_rgba: "rgba(253,168,208,1)", //"#FDA8D0" //if no value is put, it will default to MoTrack blue
          background_color_name: "Pink",
          is_always_disabled: true,
        },{
          num : 3,
          descriptive_exercise_name : "Wrist Ulnar/Radial Deviation",
          descriptive_short_exercise_name : "Wrist Uln/Rad Deviation",
          short_exercise_name_lc : "deviation",
          percentage_filled : 0,
          background_color: "#F9D159",
          //Note: COLOR CANNOT BE IN HEX, or the progress coloring system will break.
          background_color_rgba: "rgba(249,209,89,1)", //"#F9D159" //if no value is put, it will default to MoTrack blue
          background_color_name: "Yellow",
        },{
          num : 4,
          descriptive_exercise_name : "Pronation/Supination",
          descriptive_short_exercise_name : "Pronation/Supination",
          short_exercise_name_lc : "pronation",
          percentage_filled : 0,
          background_color: "#31CFC2",
          //Note: COLOR CANNOT BE IN HEX, or the progress coloring system will break.
          background_color_rgba: "rgba(49,207,194,1)", //hex is "#31CFC2" //if no value is put, it will default to MoTrack blue
          background_color_name: "Aqua",
        },{
          num : 1,
          descriptive_exercise_name : "Wrist Flexion/Extension",
          descriptive_short_exercise_name : "Wrist Flexion/Extension",
          short_exercise_name_lc : "flexion",
          percentage_filled : 0,
          background_color: "#FD6B7D",
          //Note: COLOR CANNOT BE IN HEX, or the progress coloring system will break.
          background_color_rgba: "rgba(253,107,125,1)", //"#68B4FC" //if no value is put, it will default to MoTrack blue
          background_color_name: "Red",
        },{
          num : 5,
          descriptive_exercise_name : "Finger Abduction/Adduction",
          descriptive_short_exercise_name : "Finger ABD/ADD",
          short_exercise_name_lc : "abduction",
          percentage_filled : 0,
          background_color: "#C2FEBC",
          //Note: COLOR CANNOT BE IN HEX, or the progress coloring system will break.
          background_color_rgba: "rgba(194,254,188,1)", //"#C2FEBC" //if no value is put, it will default to MoTrack blue
          background_color_name: "Green",
        },{
          num : 6,
          descriptive_exercise_name : "Thumb Opposition",
          descriptive_short_exercise_name : "Thumb Opposition",
          short_exercise_name_lc : "opposition",
          percentage_filled : 0,
          background_color: "#6430DF",
          //Note: COLOR CANNOT BE IN HEX, or the progress coloring system will break.
          background_color_rgba: "rgba(100,48,223,1)", //hex is "#31CFC2" //if no value is put, it will default to MoTrack blue
          background_color_name: "Purple",
        }];


    firebase.auth().onAuthStateChanged(
      function(user) {
        if (user) {
          console.log("Logging in user.displayName:" + user.displayName);

          // User is signed in.
          displayName = user.displayName;
          email = user.email;
          $("#username-box1").val(""+email)
          $("#password-box1").val("--------")
          var emailVerified = user.emailVerified;
          var photoURL = user.photoURL;
          var isAnonymous = user.isAnonymous;
          uid = user.uid;
          var providerData = user.providerData;
          //createAccountValues is created when a new account is created
          updateAfterSuccessfulLogin();

        } else {
          //Runs once in the beginning before signed in
          console.log("user is now signed out");

          displayName = null;
          email = null;
          uid = null;
          createAccountValues = null;

          // this line below navigates to the #loginscreen, but I wonder if
          // it is better here or at the end of signOutAndGoToLoginScreen()
          navigateTo("#booth-signupscreen");
        }
    });

    // below is called whenever a new page is shown (regardless of which page,
    // so I figured it's best to put it here instead of in each page)
    $(document).on("pagecontainershow", function(e, ui) {
        // Refer page as ui.toPage for the jquery object or ui.toPage[0] for the html object
        // Similarly for toPage. NOTE: previous page will be undefined if there is no previous page
        if (ui.toPage[0] && ui.prevPage[0] && ui.toPage[0].id === "exercisetypescreen" && ui.prevPage[0].id === "homescreen") {
          $("#reminderspopup").popup("open");
        }
    });


    // Only happens when page is ready
    // source: https://learn.jquery.com/using-jquery-core/document-ready/
    $( document ).ready(
      function() {
        // can't do this stuff directly in javascript (as opposed in
        // the document ready listener) because not all elements will be defined yet

        var reminderspopupimg = $("#reminderspopup img");
        var imgaspratio = 2439.0/1193.0; //reminderspopupimg.width() *1.0/ reminderspopupimg.height();
        reminderspopupimg.css('max-height', $( window ).height()*0.75);
        $("#reminderspopup").css("margin", 10/75*$(window).width() + "px");
        $("#reminderspopup").css("padding", 2/75*$(window).width() + "px");
        //margin: 50px; padding: 10px
        //reminderspopupimg.css('width',  $( window ).height()*0.75*imgaspratio);
        //$("#reminderspopup").enhanceWithin();

        //set the value of video1_player and video2_player
        video1_player = $("#video1-player")[0]; //[0] converts between JQuery object and HTML DOM object
        video2_player = $("#video2-player")[0]; //[0] converts between JQuery object and HTML DOM object

        //setup decrementers/incrementers. Put here so that I could loop over them instead of doing each separately.
        $.each( games_map2,
          function( key, game ) {
            var val = game['gameIndex'];
            var minAllowed = 2;
            var maxAllowed = 20;
            var changeUnit = game['repSetLen']; //must make the changeUnit  multiple of 2 for the c++ code because each "exercise" includes two exercises (Flexion is really palmar and dorsi flexion which are two exercises that alternate. Each one counts for one point.)
            $("#rep-counter-" + val + "-decrementer").click(
             function(){
               playClickSound();
               //set to the data value, or if that is undefined, use the default prior value
               minAllowed = $("#rep-counter-" + val + "-decrementer").data("min-allowed") || minAllowed;
               maxAllowed = $("#rep-counter-" + val + "-decrementer").data("max-allowed") || maxAllowed;
               //changeUnit = $("#rep-counter-" + val + "-decrementer").data("change-unit") || changeUnit;
               var nrtbc_each_current = parseInt( $('#rep-counter-' + val).html() );
               if (!isNaN(nrtbc_each_current) && nrtbc_each_current > minAllowed) {
                 var nrtbc_each_future = nrtbc_each_current - changeUnit;
                 $('#rep-counter-' + val).html(nrtbc_each_future+"");
                 console.log("Updated value from " + nrtbc_each_current + " to " + nrtbc_each_future);
                 if (nrtbc_each_future - changeUnit < minAllowed) {
                   $("#rep-counter-" + val + "-decrementer").prop('disabled', true);
                 }
                 if (nrtbc_each_future + changeUnit <= maxAllowed) {
                   $("#rep-counter-" + val + "-incrementer").prop('disabled', false);
                 }
               }
             });
            $("#rep-counter-" + val + "-incrementer").click(
             function(){
               playClickSound();
               //set to the data value, or if that is undefined, use the default prior value
               minAllowed = $("#rep-counter-" + val + "-decrementer").data("min-allowed") || minAllowed;
               maxAllowed = $("#rep-counter-" + val + "-decrementer").data("max-allowed") || maxAllowed;
               //changeUnit = $("#rep-counter-" + val + "-decrementer").data("change-unit") || changeUnit;
               var nrtbc_each_current = parseInt( $('#rep-counter-' + val).html() );
               if (!isNaN(nrtbc_each_current) && nrtbc_each_current < maxAllowed) {
                 var nrtbc_each_future = nrtbc_each_current + changeUnit;
                 $('#rep-counter-' + val).html(nrtbc_each_future+"");
                 console.log("Updated value from " + nrtbc_each_current + " to " + nrtbc_each_future);
                 if (nrtbc_each_future - changeUnit >= minAllowed) {
                   $("#rep-counter-" + val + "-decrementer").prop('disabled', false);
                 }
                 if (nrtbc_each_future + changeUnit > maxAllowed) {
                   $("#rep-counter-" + val + "-incrementer").prop('disabled', true);
                 }
               }
             });
        });


        //set up the tutorial walk-through next and back buttons
        var walk_through_pages = ["tutorial-walk-through", "tutorial-hand-positioning",
                                  "tutorial-main-menu","tutorial-exercise-sets","tutorial-progress-bars",
                                  "tutorial-instructions-screen","tutorial-game-setup","tutorial-game-play"];
        $.each( walk_through_pages, function( currentKey, val ) {
           $("#walk-through-back-button-" + currentKey).click(
              function(){
                var nextKey = currentKey - 1;
                if (nextKey < 0) { //cycle through, looped back at the end
                  nextKey = walk_through_pages.length-1;
                }
                playClickSound();
                navigateTo("#" + walk_through_pages[nextKey]);
              });
           $("#walk-through-next-button-" + currentKey).click(
              function(){
                console.log("hello");
                console.log(currentKey);
                var nextKey = currentKey + 1;
                if (nextKey >= walk_through_pages.length) { //cycle through, looped back at the end
                  nextKey = 0;
                }
                playClickSound();
                navigateTo("#" + walk_through_pages[nextKey]);
              });
        });


        //Set the header bars of all pages that should have one
        setUpHeaders();


        setUpExerciseScreens();


        //set the starting state of tutorial-videos-btn to be checked iff play_tutorial_videos is true
        //in the future, when tutorial-videos-btn is changed, play_tutorial_videos will be changed
        $('#tutorial-videos-btn').prop('checked', play_tutorial_videos);
        $('.game-play-or-tutorial-button-text').text(play_tutorial_videos ? 'Start tutorials!' : "Let's play!");

        $('#tutorial-video1-btn').prop('checked', play_gen_tutorial_video);
        $("#video2-screen .header-bar .header-text").text(play_gen_tutorial_video ? "Tutorial Video #2/2" : "Tutorial Video");
        //Note: This does not work. Must manually do it.
        /*$("#tutorial-video1-btn").flipswitch({
         disabled: !play_tutorial_videos
         });*/

        $('#local-tutorial-vid-files-btn').prop('checked', use_local_tutorial_vid_files);

        $('#back-enabled-in-header-btn').prop('checked', header_has_back);

        updateTesterAccountDetails();


        //Set up the color scheme/formatting/images of each gamelistscreen
        $.each(exercises_map, function( index, exercise ) {
          var short_exercise_name_lc = exercise["short_exercise_name_lc"];
          var descriptive_exercise_name = exercise["descriptive_exercise_name"];
          var background_color = exercise["background_color"];
          var background_color_name = exercise["background_color_name"];
          var all_exercise_text_in_secondary = true;

          //COMBINED GAME EXERCISE PAGES
          // Set up color of secondary header bar
          $("#gamelistscreen-"+short_exercise_name_lc + " .header-bar2").css("background-color",background_color);

          // Set up text of secondary header bar
          if (all_exercise_text_in_secondary) {
            $("#gamelistscreen-"+short_exercise_name_lc + " .header-bar2 .header-text").html("<i>" + background_color_name + " Set:</i> " + descriptive_exercise_name);

          } else {
            $("#gamelistscreen-"+short_exercise_name_lc + " .header-bar2 .header-text").text(background_color_name + " Set");
            $("#gamelistscreen-"+short_exercise_name_lc + " .header-bar .header-text").text(descriptive_exercise_name);
          }

          //add a colored bar on the left of buttons to denote which exercise they belong to
          $("#gamelistscreen-"+short_exercise_name_lc + " .ui-btn:not(.ui-btn-icon-notext)").css("background-image", "linear-gradient(to right, "+background_color+" 10%, #000 10.01%, #000 10.29%, #30ABDF 10.3%)");
          $("."+short_exercise_name_lc+"-game-displayer .ui-btn:not(.ui-btn-icon-notext)").css(  "background-image", "linear-gradient(to right, "+background_color+" 10%, #000 10.01%, #000 10.29%, #30ABDF 10.3%)");


          // Set up which GIF images
          $("#gamelistscreen-"+short_exercise_name_lc + " .gamelistscreen-exercise-instructions").attr("src","Dropbox/ui_media/exercise_arrows/exercise_gifs/"+short_exercise_name_lc+"_arrows.gif");
          // Set up border around GIF images
          //$("#gamelistscreen-"+short_exercise_name_lc + " .gamelistscreen-exercise-instructions").css("border-color",background_color);
          // Change the colors of all buttons on the gamelistscreen page as well
          //$("#gamelistscreen-"+short_exercise_name_lc + " .two-layer-btn-v2").css("background-color",background_color);


          //EACH INDIVIDUAL GAME PAGE
          // Set up color of secondary header bar
          $("."+short_exercise_name_lc + "-game-displayer .header-bar2").css("background-color",background_color);
          // Set up text of secondary header bar
          $("."+short_exercise_name_lc + "-game-displayer .header-bar2 .header-text").html("<i>" + background_color_name + " Set:</i> " + descriptive_exercise_name);

        });


        $(document).delegate('.gamelistscreen', 'pagebeforeshow', function() {
          //**WARNING*** THIS STUFF IS VERY CONFUSING AND I HAVE NO IDEA WHY THIS WORKS  BUT SOME OTHER STUFF DOESN'T
          if (should_use_left_hand == true) {
            //console.log("changing to left");
            //$( this ).find( ".hand-select-option option[value='l']" ).attr('selected', 'selected');
            //$( this ).find( ".hand-select-option option[value='r']" ).removeAttr('selected');
            $( this ).find( ".hand-select-option" ).val('l');
            $( this ).find( ".hand-select-option" ).flipswitch().flipswitch('refresh');

          } else if (should_use_left_hand == false) {
            //console.log("changing to right");
            //$( this ).find( ".hand-select-option option[value='r']" ).attr('selected', 'selected');
            //$( this ).find( ".hand-select-option option[value='l']" ).removeAttr('selected');
            $( this ).find( ".hand-select-option" ).val('r');
            $( this ).find( ".hand-select-option" ).flipswitch().flipswitch('refresh');
          }
          //flipswitch('refresh')
        });


        $('.hand-select-option').change(function() {
          //**WARNING*** THIS STUFF IS VERY CONFUSING AND I HAVE NO IDEA WHY THIS WORKS  BUT SOME OTHER STUFF DOESN'T

          //Simpler code way of doing it is this
          // $(".hand-select-option option[value='" + $(this).val() +"']").attr('selected', 'selected');
          //But if we do it this way, we do it it one less element (we skip the current element), which presumably is faster and more robust

          //console.log( $(this).attr('id') + " changed to " + $(this).val());
          if (typeof $(this).val() == "string") {
            var hand_lc = $(this).val().toLowerCase().trim();

            var whichHandRef = firebase.database().ref('users/' + uid + '/settings/whichHand');
            if ( hand_lc=="l" || hand_lc=="left") {
              should_use_left_hand = true;
              //$(".hand-select-option").not( $(this) ).find( "option[value='l']" ).attr('selected', 'selected');
              whichHandRef.set("left");
            } else {
              should_use_left_hand = false;
              //$(".hand-select-option").not( $(this) ).find( "option[value='l']" ).removeAttr('selected');
              whichHandRef.set("right");
            }


            //Necessary to actually change the ui (once agin, for improved robustnes but I don't think is necessary)
            //I will use the .not argument to prevent the same one from being refreshed
            //The original flipswitch() is there in case the elements aren't initialized already, which would throw an error
            //$(".hand-select-option").not( $(this) ).flipswitch().flipswitch( "refresh" );


            //flip all of the images that should be flipped depending on the hand
            var orientation = should_use_left_hand ? -1 : 1;
            $(".hand-flippable").css(        "transform","scaleX("+orientation+")");
            $(".hand-flippable").css("-webkit-transform","scaleX("+orientation+")");
          }

        });

        //empirically tested Mar 7, 2019 that this flipswitch starts to wonky around here. Removing the label makes it a bit better
        if ( $(document).width() > 445) {
          //this is the label for .hand-select-option
          $(".which-hand-gif-field-contain label").remove();
        }

        //otherwise, will auto login on iOS
        if (!allowAutologin) signOutAndGoToLoginScreen();

    });


    $(document).one('pagebeforecreate', function () {
      //"The pagebeforecreate event will emit on each and every page, but only ONCE. If you have 5 pages in one HTML file (Multi-Page Model), that event will fire 5 times before creating/showing the target page."
      //https://stackoverflow.com/questions/22634955/restrict-jqm-panel-to-only-1-instance-on-page/22636966#22636966
      //$.mobile.pageContainer.prepend(panel);
      $("#settingspanel").panel().enhanceWithin();
    });


    function updateTesterAccountDetails() {
      $('#basic-games-btn').prop('checked', is_test_account);

      if (is_test_account) {
        $(".testers-only-1").show();
        $(".plain-game-button-holder").show();
      } else {
        $(".testers-only-1").hide();
        $(".plain-game-button-holder").hide();
        /*
        $("#flexion-plain-button-holder").remove();
        $("#deviation-plain-button-holder").remove();
        $("#pronation-plain-button-holder").remove();
        $("#fist-plain-button-holder").remove();*/
      }

    }

    //set the header bars of all pages that should have one
    function setUpHeaders() {
      /*
      var header_template_with_back = $('#header_template_with_back').html();
      var header_template_with_home = $('header_template_with_home').html();
      var header_template_with_tutorial = $('header_template_with_tutorial').html();*/

      var header_template_with_back = document.getElementById('header_template_with_back').innerHTML;
      var header_template_with_home = document.getElementById('header_template_with_home').innerHTML;
      var header_template_with_tutorial = document.getElementById('header_template_with_tutorial').innerHTML;


      $( ".header-bar" ).each(
        function( index ) {
          var header_template;
          if ($('#homescreen').has( this ).length) {
            header_template = header_template_with_tutorial;
          } else if (header_has_back) {
            header_template = header_template_with_back;
          } else {
            header_template = header_template_with_home;
          }
          //$( this ).text() gets the text (html stripped out) of the header-bar class
          var header_output = Mustache.render(header_template, { screen_title : $( this ).text() } );
          $( this ).html(header_output);
          $( this ).enhanceWithin();
        });


      $( ".header-bar-force-with-home" ).each(
        function( index ) {
          //$( this ).text() gets the text (html stripped out) of the header-bar class
          var header_output = Mustache.render(header_template_with_home, { screen_title : $( this ).text() } );
          $( this ).html(header_output);
          $( this ).enhanceWithin();
        });
    }

    function setUpExerciseScreens() {
      /* THIS CODE IS FROM WHEN I TRIED TO MAKE THE EXERCISE/GAME SCREENS AUTOMATIC
      var eachexercisescreen_template = $("#eachexercisescreen_template").html();
      var eachexercisescreen = Mustache.render(eachexercisescreen_template, exercises_map );
      $("body").append(eachexercisescreen);
      $( "body" ).parent().enhanceWithin();*/

      /*
      $.each(exercises_map, function( index1, exercise ) {
        var eachexercisescreen_template2 = $("#eachexercisescreen_template2").html();
        var eachexercisescreen = Mustache.render(eachexercisescreen_template2, exercise );
        $("#gamelistscreen-"+exercise.short_exercise_name_lc).html(eachexercisescreen);
        $( "#gamelistscreen-"+exercise.short_exercise_name_lc).parent().enhanceWithin();
      });*/
    }


    //functions necessary for early parts of the app (as opposed to functions like startGame())
    function updateAfterSuccessfulLogin() {
      //update displayName
      var nameRef = firebase.database().ref('users/' + uid + '/fname');
      nameRef.on('value',
        function(snapshot_name) {
          //null indicates empty (never been set)
          if (snapshot_name.val() == null || snapshot_name.val().length == 0) {
            $(".display-name-holder").html(displayName)
          } else {
            $(".display-name-holder").html(snapshot_name.val())
          }
        }, function(err) { // error callback triggered with PERMISSION_DENIED
          showAndroidToast("Permission Denied 1 " + err);
      });

      $(".testers-only-1").hide(); //have this be the default while the testerFunctionality is loading
      var testerFunctionalityRef = firebase.database().ref('users/' + uid + '/testerFunctionality');
      testerFunctionalityRef.on('value',
        function(snapshot_tester) {
            //null indicates empty (never been set)
            if (snapshot_tester.val() == null || snapshot_tester.val() <= 0) {
              is_test_account = false;
              updateTesterAccountDetails();
            } else if (snapshot_tester.val() == 1) {
              is_test_account = true;
              updateTesterAccountDetails();
            }
          }, function(err) { // error callback triggered with PERMISSION_DENIED
            showAndroidToast("Permission Denied 2 " + err);
        });


      
      //update firebase with new login
      loginSessionID = firebase.database().ref('logins/' + uid + '/').push().key;
      var newLoginRef = firebase.database().ref('logins/' + uid + '/' + loginSessionID);
      var time = getTimeAsReadableString();
      var mydevice = "X";
      if (device == ANDROID_DEVICE) {
       mydevice = "android";
      } else if (device == IOS_DEVICE) {
       mydevice = "ios";
      } else if (device == OTHER_DEVICE) {
       mydevice = "web";
      }
      newLoginRef.set({ unixTime: time.unix, stringTime: time.str, device: mydevice, versionCode: versionCode }, completionCallback);


      //reset all the hand select options to blank
      //$(".hand-select-option").not( $(this) ).find( "option[value='l']" ).removeAttr('selected');
      should_use_left_hand = false;
      var whichHandRef = firebase.database().ref('users/' + uid + '/settings/whichHand');
      whichHandRef.once('value',
        function(snapshot) {
          if (snapshot.val() != null) {
            if (typeof snapshot.val() == "string") {
              var lc = snapshot.val().toLowerCase().trim();
              should_use_left_hand = (lc=="l" || lc=="left");
            }
          }
        });

      var userSetupTimeRef = firebase.database().ref('users/' + uid + '/setupUnixTime');
      userSetupTimeRef.once('value',
        function(snapshot_time) {
          //null indicates empty (never been set), negative snapshot_time (i.e. -1) indicates reset setup to default
          if ( (snapshot_time.val() == null || snapshot_time.val() < 0 )) {
            var addNewUserInfo = firebase.functions().httpsCallable('addNewUserInfo');
            addNewUserInfo({createAccountValues: createAccountValues, userUid: uid, email: email, versionName: versionName, versionCode: versionCode, device: device}).then(function(result) {
              // Read result of the Cloud Function.
              //var sanitizedMessage = result.data.text;
              console.log( result.data.setupStringTime );

              if (createAccountValues.length > 4) {
                //[fname, lname, clinicCode, userCategory, phone, clinic_name, state_loc]
                var phone = createAccountValues[4];
                firebase.database().ref('users/' + uid + '/userInfo/phoneNumber').set(phone);
                var clinic_name = createAccountValues[5];
                firebase.database().ref('users/' + uid + '/userInfo/clinicName').set(clinic_name);
                var state_loc = createAccountValues[6];
                firebase.database().ref('users/' + uid + '/userInfo/stateLocation').set(state_loc);
              }

              $.mobile.loading("hide");
              updateExerciseTypeScreen();
              registerForPushNotifications();

              //only navigate if coming from #loginscreen. Otherwise, it's annoying while testing if I refresh in chrome because it goes back to the homescreen.
              var hashInd = $(location).attr('href').indexOf("#");
              var page = $(location).attr('href').substring(hashInd);
              var ampInd = page.indexOf("&");
              if (ampInd > 0) {
                page = page.substring(0,ampInd);
              }

              if (hashInd < 0 || page === "#loginscreen") {
                $.mobile.loading( "hide");
                navigateTo("#homescreen");
                //window.location = "#homescreen";
              } else if (page === "#signupscreen2") {
                $.mobile.loading( "hide");
                navigateTo("#homescreen");
              }

            }).catch(function(err) {
              // Getting the Error details.
              $.mobile.loading("hide");
              var code = err.code;
              var message = err.message;
              var details = err.details;
              console.log("code: " + code);
              console.log("message: " + message);
              console.log("details: " + details);
              completionCallback();

            });



          } else {
            $.mobile.loading("hide");
            updateExerciseTypeScreen();
            registerForPushNotifications();

            //only navigate if coming from #loginscreen. Otherwise, it's annoying while testing if I refresh in chrome because it goes back to the homescreen.
            var hashInd = $(location).attr('href').indexOf("#");
            var page = $(location).attr('href').substring(hashInd);
            var ampInd = page.indexOf("&");
            if (ampInd > 0) {
              page = page.substring(0,ampInd);
            }

            if (hashInd < 0 || page === "#loginscreen") {
              $.mobile.loading( "hide");
              navigateTo("#homescreen");
              //window.location = "#homescreen";
            } else if (page === "#signupscreen2") {
              $.mobile.loading( "hide");
              navigateTo("#homescreen");
            }

          }

        }, function(err) { // error callback triggered with PERMISSION_DENIED
          showAndroidToast("Permission Denied 3 " + err);
        });

        var isSoundEnabledRef = firebase.database().ref('users/' + uid + '/settings/isSoundEnabled');
        isSoundEnabledRef.on('value',
          function(snapshot) {
              //null indicates empty (never been set)
              if (snapshot.val() != null) {
                if (snapshot.val() == true) {
                  is_sound_enabled = true;

                } else if (snapshot.val() == false) {
                  is_sound_enabled = false;

                } else is_sound_enabled = true; //default value
              } else is_sound_enabled = true; //default value

              if ( $("#app-sounds-btn").prop("checked") != is_sound_enabled ) {
                $("#app-sounds-btn").prop("checked", is_sound_enabled);
                $("#app-sounds-btn").flipswitch( "refresh" );
              }

            }, function(err) { // error callback triggered with PERMISSION_DENIED
              showAndroidToast("Permission denied for checking if sound is enabled: " + err);
          });


        var isTutorialVideosEnabledRef = firebase.database().ref('users/' + uid + '/settings/isTutorialVideosEnabled');
        isTutorialVideosEnabledRef.on('value',
          function(snapshot) {
              //null indicates empty (never been set)
              if (snapshot.val() != null) {
                if (snapshot.val() == true) {
                  play_tutorial_videos = true;

                } else if (snapshot.val() == false) {
                  play_tutorial_videos = false;

                } else play_tutorial_videos = true; //default value
              } else play_tutorial_videos = true; //default value

              if ( $("#tutorial-videos-btn").prop("checked") != play_tutorial_videos ) {
                $("#tutorial-videos-btn").prop("checked", play_tutorial_videos);
                $("#tutorial-videos-btn").flipswitch( "refresh" );
              }
              //play_tutorial_videos will stay at current value if not set in the server (or is set to an invalid value)

            }, function(err) { // error callback triggered with PERMISSION_DENIED
              showAndroidToast("Permission denied for checking if sound is enabled: " + err);
          });

        //Tried to implement remote logout, but didn't work.
        /*
        var loggedOnAllowedRef = getVersionsRefFromFirebase();
        loggedOnAllowedRef.on("child_added", //must be child_added not value. Otherwise, it will return back value of key iOS/Android
          function(snapshot) {
            console.log(snapshot.val());
            var val = snapshot.child("appAccess/loggedOnAllowed").val();
            if (val != null && val >= 10 ) {

            } else {
              signOutAndGoToLoginScreen();
            }
          }, function(err) { // error callback triggered with PERMISSION_DENIED
            showAndroidToast("Error with getting log in permissions");
            console.log(err);
          });*/

         //navigateTo("#homescreen");
    }

    function updateAfterFailedLogin(errorCode, errorMessage) {
      //the below documentation says what errorCode appeared to be from testing it in javascript's firebase
      //if username does not have an "@" and a letter after "@", then it says //auth/invalid-email (minimum for ex "motracktherapy@g")
      //if username is empty, it says auth/wrong-password
      //the above two happen regardless of whether wifi is connected.
      //if the two above are fine, then it says auth/network-request-failed if wifi isn't connected
      //if wifi is connected, then it will say auth/user-not-found if the user does not exist
      //if the user does exist, then it says auth/wrong-password again if the password is wrong
      console.log("errorCode:");
      console.log(errorCode);
      console.log("errorMessage:");
      console.log(errorMessage);

      if (errorCode === "auth/network-request-failed") {
        $("#loginresponse").text("Can't connect to the Internet.");
      } else if (errorCode == "auth/invalid-email") {
        $("#loginresponse").text("Username is not in a valid form.");
      } else if (errorCode.startsWith("motrack/")) {
        $("#loginresponse").text(errorMessage);
      } else {
        $("#loginresponse").text("Wrong login/password. Try again.");
      }

      $.mobile.loading("hide");

    }

    //Meant to be called from iOS to set these values
    //appVersionStr input is a string
    function setAppVersions(appVersionStr, buildNumber) {
      versionName = appVersionStr; //global variables versionName and versionCode.
      versionCode = buildNumber; //parseInt( buildNumberStr, 10 );
      $( document ).ready(
        function() {
          //set the version codes
          $(".version-name-holder").text(versionName);
          $(".version-code-holder").text(versionCode);
          $(".version-suffix-holder").text(TEST_MODE_ENABLED ? "*" : "");

          //Set up the tutorial video URLs for the version
          var versionsForDeviceRef = getVersionsRefFromFirebase();
          versionsForDeviceRef.once("child_added", //must be child_added not value. Otherwise, it will return back value of key iOS/Android
            function(snapshot) {
              var accessCodesInfo = snapshot.child("accessCodes").val();
              if (accessCodesInfo != null) {
                $("#sign-up-access-code-box").attr('placeholder', accessCodesInfo["signupText"]); //code (optional)
                is_access_code_required_for_therapist = accessCodesInfo["isRequired"];
              }

              $.each(games_map2, function( key, game ) {
                     var shortGameName_lc = game["shortGameName"].toLowerCase();
                     game["tutorialVidName"] = snapshot.child("tutorialVideos").child(shortGameName_lc+"Video").val();
                     if (game["tutorialVidName"] == null) {
                       game["tutorialVidName"] = snapshot.child("tutorialVideos").child(shortGameName_lc).val()
                     }
                     game["tutorialVidSubtitlesName"] = snapshot.child("tutorialVideos").child(shortGameName_lc+"Subtitles").val();
                 });
              }, function(err) { // error callback triggered with PERMISSION_DENIED
                showAndroidToast("Error loading tutorial videos.");
                console.log(err);
            });
      });
    }

    function updateExerciseListInSettings() {
      $('#enable-exercise-settings-btns').off("click"); //remove any event listeners attached with "on"

      var exerciselistforsettings_template = $('#exerciselistforsettings_template').html();

      var myexercises_map = jQuery.extend(true, [], exercises_map); //deep copy, so we don't sort/edit the original array
      //Use below code if we want to keep all the enabled exercises first
      /*myexercises_map.sort(function (a, b) {
        return (b.enabled ? 1 : -1) - (a.enabled ? 1 : -1);
      });*/
      var output2 = Mustache.render(exerciselistforsettings_template, myexercises_map);
      $( "#exerciselistforsettings_optionholder" ).html( output2 ); //use .prepend(.) or .append(.)
      $("#exercise-settings").enhanceWithin();


      $.each( exercises_map, function( index, exercise ) {
        var short_exercise_name_lc=exercise["short_exercise_name_lc"];
        $('#enable-'+short_exercise_name_lc+'-settings-btn, #expandable-'+short_exercise_name_lc+'-settings-area .delete-exercise-btn').on("click", function() {
          var currentStatus = $( this ).closest("li").data('exercise-enabled');
          console.log('not firing ' + currentStatus);
          var exerciseEnabledRef = firebase.database().ref('users/' + uid + '/exercises/' + short_exercise_name_lc + '/enabled');
          if (currentStatus == true) exerciseEnabledRef.set(false); //set the opposite of the current value
          else if (currentStatus == false) exerciseEnabledRef.set(true); //set the opposite of the current value
          else showAndroidToast("Error. Couldn't change the exercise being enabled or not.")
          //$( this ).data('icon')
        });

        $('#expandable-'+short_exercise_name_lc+'-settings-area .save-exercise-btn').on("click", function() {
          var currentVal = $('#repsToDo-'+short_exercise_name_lc+'-fill').val()
          var currentValInt = parseInt(currentVal);
          if (isNaN(currentValInt)) {
            showAndroidToast("Error. Couldn't change the exercise repsToDo because currentVal was " + currentVal);
          } else {
            var exerciseRepsToDoRef = firebase.database().ref('users/' + uid + '/exercises/' + short_exercise_name_lc + '/repsToDo');
            exerciseRepsToDoRef.set(currentValInt);
          }


          var obj = $("#expandable-"+short_exercise_name_lc+"-settings-area");
          obj.css('display','none');
        });

        $('#expand-'+short_exercise_name_lc+'-settings-btn').on("click", function() {
          var obj = $("#expandable-"+short_exercise_name_lc+"-settings-area");
          if (obj.css('display') == "none") obj.css('display','block');
          else obj.css('display','none');

          //$( this ).data('icon')
        });
      });
    }

    //for managing exercisetypescreen_template
    function updateExerciseTypeScreen() {
      var exercisetypescreen_template = document.getElementById('exercisetypescreen_template').innerHTML;
      var output = Mustache.render(exercisetypescreen_template, exercises_map);
      $( "#exercisetypescreen_optionholder" ).html( output ); //use .prepend(.) or .append(.)

      updateExerciseListInSettings();

      /*
      if (!TEST_MODE_ENABLED) {
        $("#general-app-settings-button").closest("div.ui-btn").addClass("ui-disabled");
        $("#exercise-settings-button").closest("div.ui-btn").addClass("ui-disabled");
      }*/


      //get videoWatches values
      $.each(games_map2, function( index1, game ) {
        var longGameName_lc = game["longGameName"].toLowerCase();
        var shortExerciseName_lc = game["shortExerciseName"].toLowerCase();
        var buttonName = shortExerciseName_lc + "-" + longGameName_lc + "-button";
        buttonName = buttonName.replace(/\s+/g, '-'); // Replaces all spaces with dashes using regular expressions. The g flag makes it replace all occurences.


        if (game["is_always_disabled"] == true && TEST_MODE_ENABLED !== true) { //undefined/null doesn't return "== true" or "== false"
          $("#" + buttonName).closest("div.ui-btn").addClass("ui-disabled");

          var gameEnabledRef = firebase.database().ref('users/' + uid + '/games/' + longGameName_lc + '/enabled');
          gameEnabledRef.on('value',
            function(snapshot_game) {
              if (snapshot_game.val() == true) {
                //closest(.) finds the first ancestor (including itself) matching the selector. It is used to find the container for the button.
                $("#" + buttonName).closest("div.ui-btn").show();
                game["enabled"] = true;
              } else { //this is default (ie null), default is make these hidden
                $("#" + buttonName).closest("div.ui-btn").hide();
                game["enabled"] = false;
              }
            });

        } else {
          var gameRef = firebase.database().ref('users/' + uid + '/games/' + longGameName_lc + '');
          gameRef.on('value',
            function(snapshot_game) {
              var videoWatches = snapshot_game.child("videoWatches").val() || 0;
              game["videoWatches"] = videoWatches;
              var enabled = snapshot_game.child("enabled").val();
              if (enabled == null) enabled = true; //null is equivalent to true for game enabled (different than exercise enabled)
              game["enabled"] = enabled;

              if (enabled == true) {
                //closest(.) finds the first ancestor (including itself) matching the selector. It is used to find the container for the button.
                $("#" + buttonName).closest("div.ui-btn").show();
              } else {
                $("#" + buttonName).closest("div.ui-btn").hide();
              }
            });
        }

      });


      //update the progress bars and set button click listeners
      //surrounded by a for each loop to do it for each progress bar/button
      $.each(exercises_map,
        function( index, exercise ) {
          var short_exercise_name_lc = exercise.short_exercise_name_lc;
          if (exercise["is_always_disabled"] == true && TEST_MODE_ENABLED !== true) { //undefined/null doesn't return "== true" or "== false"
            $("#" + short_exercise_name_lc + "-exercise").addClass("ui-disabled");

            var exerciseEnabledRef = firebase.database().ref('users/' + uid + '/exercises/' + short_exercise_name_lc + '/enabled');
            exerciseEnabledRef.on('value',
              function(snapshot_exercise) {
                if (snapshot_exercise.val() == true) {
                  //closest(.) finds the first ancestor (including itself) matching the selector. It is used to find the container for the button.
                  $("#" + short_exercise_name_lc + "-exercise").show();
                  exercise["enabled"] = true;
                } else { //this is default (ie null), default is make these hidden
                  $("#" + short_exercise_name_lc + "-exercise").hide();
                  exercise["enabled"] = false;
                }
                updateExerciseListInSettings();
              });


          } else {
            var exerciseRef = firebase.database().ref('users/' + uid + '/exercises/' + short_exercise_name_lc);
            exerciseRef.on('value',
              function(snapshot_exercise) {
                var exercise_descript = snapshot_exercise.val();
                //var exercise = exercises_map.find((exercise) => exercise.short_exercise_name_lc === short_exercise_name_lc);
                var old_enabled  = exercise["enabled"];
                if (old_enabled == null) {
                  //null is equivalent to false for enabled, but old_enabled starts off as true because originally the buttons are there and they have to be hidden
                  old_enabled = true;
                }

                var enabled;
                var percentage = 0; //0%

                if (exercise_descript == null) {
                  enabled = false;
                  percentage = 0; //0%
                  console.log(short_exercise_name_lc + " has null for its exercise");
                  delete exercise["repsToDo"];

                } else {
                  var repsToDo = exercise_descript["repsToDo"];
                  var repsDone = exercise_descript["repsDone"];
                  enabled = exercise_descript["enabled"];

                  if (enabled == null) {
                   enabled = false; //null is equivalent to false for enabled (including if the entire exercise is null)
                  }

                  if (enabled == true) {
                    if (repsToDo != 0) {
                      percentage = (repsDone/repsToDo)*100;
                    } else {
                      percentage = 1; //1 is 100%
                    }

                  } else {
                    percentage = 0;
                  }
                  exercise["repsToDo"] = repsToDo || 0;

                }

                exercise["enabled"] = enabled;
                exercise["percentage_filled"] = percentage;
                if (enabled !== old_enabled) {
                  console.log("Switched to enabled=" + enabled + " from old_enabled=" + old_enabled + " for " + short_exercise_name_lc)
                }

                if (!enabled) {
                 $("#" + short_exercise_name_lc + "-exercise").hide();

                } else if (enabled) {
                  $("#" + short_exercise_name_lc + "-exercise").show();
                }

                 //set the progress bar percentage. Use Math.min so progress bar doesn't overflow after 100% (negative % doesn't do anything in Android)
                $("#" + short_exercise_name_lc + "-progress-bar-filler").css("width", Math.min(percentage,100) + "%");

                updateExerciseListInSettings();

              }, function(err) {
                // error callback triggered with PERMISSION_DENIED
                showAndroidToast("Permission Denied 4 " + err);
              });
          }


          //tells what should happen after being clicked
          //note that this does need to be redone after every log in because deleting the old buttons removes the functions despite the id being the same
          $("#all-"+short_exercise_name_lc+"-exercises-button").click(
            function(){
              playClickSound();
              navigateTo("#gamelistscreen-"+short_exercise_name_lc);
            });

      });

      //get clinic code value
      //.access-code-settings-btns
      $(".access-code-settings-btns").val("None");
      var clinicCodeRef = firebase.database().ref('users/' + uid + '/clinicCode');
      clinicCodeRef.on('value',
        function(snapshot) {
          if (snapshot.val() == null) $(".access-code-settings-btns").val("None");
          else {
            if (typeof snapshot.val() == "string") {
              $(".access-code-settings-btns").val(snapshot.val().toUpperCase());
            } else $(".access-code-settings-btns").val("---");
          }
        });


    }

    function registerForPushNotifications() {
      if (device == ANDROID_DEVICE) {
        Android.createPushNotificationChannel();
        if (useMessaging) {
          messaging.requestPermission().then(function() {
            console.log('Notification permission granted.');
            // TODO(developer): Retrieve an Instance ID token for use with FCM.
            // ...
          }).catch(function(err) {
            console.log('Unable to get permission to notify.', err);
          });
        }



      } else if (device == IOS_DEVICE) {
        console.log ("Push notifications set up not needed for iOS.");

      } else if (device == OTHER_DEVICE) {
        //console.log ("Push notifications not set up for other device types.");


      } else {
        console.log ("device '" + device + "' is invalid for registerForPushNotifications");
      }
    }

    function sendPushNotification(contentTitle, contentText, contentTextBigText) {
      if (device == ANDROID_DEVICE) {
        Android.sendPushNotification(contentTitle, contentText, contentTextBigText);

      } else if (device == IOS_DEVICE) {
        console.log ("Push notifications sending not set up for iOS.");

      } else if (device == OTHER_DEVICE) {
        console.log ("Push notifications sending not set up for other device types.");

      } else {
        console.log ("device '" + device + "' is invalid for sendPushNotification");
      }
    }

  </script>

</head>

<body>


  <!-- data-display options are overlay, reveal, and push -->
  <div data-role='panel' id='settingspanel' class='jqm-nav-panel jqm-quicklink-panel ui-panel ui-panel-position-right ui-panel-display-overlay ui-panel-closed ui-body-a ui-panel-animate' data-position='right' data-display='overlay' data-theme='d'>
    <div class='ui-panel-inner'>
      <!-- i.e. Version 18 (00.18) -->
      <h2> Version <span class='version-name-holder'></span> (<span class='version-code-holder'></span><span class="version-suffix-holder"></span>) </h2>
      <div class="testers-only-1">
        <div class='ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn button-with-progress-bar'>
          <p class='button-title'> Test Video </p>
          <input type='button' data-enhanced='true' value='Test Video' id='start-video-button'>
        </div>

        <div class='ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn button-with-progress-bar'>
          <p class='button-title'> Test Crash </p>
          <input type='button' data-enhanced='true' value='Crash' id='crash-button'>
        </div>

        <div class='ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn button-with-progress-bar'>
          <p class='button-title'> Test Background </p>
          <input type='button' data-enhanced='true' value='Crash' id='demo-game-button'>
        </div>

        <div class='ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn button-with-progress-bar'>
          <p class='button-title'> Test Notifications </p>
          <input type='button' data-enhanced='true' value='Push Notifications' id='demo-push-notification-button'>
        </div>

      </div>

      <div class='ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn button-with-progress-bar'>
        <p class='button-title'> Go To Home </p>
        <input type='button' data-enhanced='true' value='Homescreen' id='settings-go-to-homescreen'>
      </div>

      <!-- <div class='ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn button-with-progress-bar'>
        <p class='button-title'> View Credits </p>
        <input type='button' data-enhanced='true' value='Homescreen' id='view-credits-homescreen'>
      </div> -->

      <a class="ui-btn ui-corner-all ui-shadow two-layer-btn" rel="external" href="https://docs.google.com/document/d/1hAQdCV78qF2-JSAEambNh4qtOxGDgltnzGu5x5A1rAg/edit"> View Credits </a>

      <div class="testers-only-1">
        <div class='ui-field-contain'>
          <!-- Having the label before the options doesn't match the other hand-select-options, but it matches the other things in settings-->
          <label for='hand-select'>Hand</label>
          <select id='hand-select' class="hand-select-option" name='hand-select' data-role='flipswitch'>
            <option value='r'>right</option>
            <option value='l'>left</option>
          </select>
        </div>
      </div>

      <div class='ui-field-contain'>
        <label for='access-code-settings-btn'> MoTrack Access Code </label>
        <input type='text' id='access-code-settings-btn' class='access-code-settings-btns' readonly="readonly" value="N/A"><!-- checked -->
      </div>

      <div class='ui-field-contain'>
        <label for='tutorial-videos-btn'> Tutorial Videos Enabled </label>
        <input type='checkbox' id='tutorial-videos-btn' data-role='flipswitch' checked> <!-- checked -->
      </div>

      <div class='ui-field-contain'>
        <label for='app-sounds-btn'> App Sounds Enabled </label>
        <input type='checkbox' id='app-sounds-btn' data-role='flipswitch' checked> <!-- checked -->
      </div>

      <div class="testers-only-1">
        <div class='ui-field-contain'>
          <label for='auto-background-calib-btn'> Auto Background Calibration </label>
          <input type='checkbox' id='auto-background-calib-btn' data-role='flipswitch' checked> <!-- checked -->
        </div>

        <div class='ui-field-contain'>
          <label for='auto-background-calib-btn'> Display Extra Info </label>
          <button class="display-extra-info-changer" data-change-unit=-1 data-inline="true" data-icon="arrow-d" data-iconpos="notext" data-mini="true"> Up </button>
          <p id="display-extra-info-text" class="rep-count" data-inline="true"> 0 </p>
          <button class="display-extra-info-changer" data-change-unit=1 data-inline="true" data-icon="arrow-u" data-iconpos="notext" data-mini="true"> Down </button>
        </div>


        <div class='ui-field-contain'>
          <label for='tutorial-video1-btn'> General Tutorial Video Enabled </label>
          <input type='checkbox' id='tutorial-video1-btn' data-role='flipswitch'> <!-- checked -->
        </div>

        <div class='ui-field-contain'>
          <label for='basic-games-btn'> Basic Games Enabled </label>
          <input type='checkbox' id='basic-games-btn' data-role='flipswitch' disabled> <!-- checked -->
        </div>

        <div class='ui-field-contain'>
          <label for='local-tutorial-vid-files-btn'> Load Videos Locally </label>
          <input type='checkbox' id='local-tutorial-vid-files-btn' data-role='flipswitch'> <!-- checked -->
        </div>
      </div>

      <div class="testers-only-1">
        <!-- Below determines whether navigation bar has a "back" button or a "home button". The default value depends on whether it is Android or iOS.  -->
        <!-- It currently (Feb 25, 2019) has a bug where the UI gets warped each time you click it, so I'm taking it away from non-testers at this point -->
        <div class='ui-field-contain'>
          <label for='back-enabled-in-header-btn'> Header Back Button </label>
          <input type='checkbox' id='back-enabled-in-header-btn' data-role='flipswitch'> <!-- checked -->
        </div>
      </div>


    </div>

    <script type="text/javascript">
      $('#start-video-button').click(function() {
        playClickSound();
        navigateTo("#video1-screen");
        //window.location = "#homescreen";
      });
      $('#demo-game-button').click(function() {
        playClickSound();
        startGame(0);
        //window.location = "#homescreen";
      });
      $('#crash-button').click(function() {
        if (device == ANDROID_DEVICE) {
          Android.crashAppPurposefully();
        } else if (device == IOS_DEVICE) {
          console.log("Error. Crash functionality not setup for iOS.")
        } else if (device == OTHER_DEVICE) {
          console.log("Error. Crash functionality not setup for other devices.")
        } else {
          console.log("Error. Device number is not one of the possible numbers.")
        }
      });
      $('#demo-push-notification-button').click(function() {
        var contentTitle = "Time to use MoTrack!";
        var contentText = "Don't forget to do your exercises";
        var contentTextBigText = contentText;
        sendPushNotification(contentTitle, contentText, contentTextBigText);
      })
      $('#settings-go-to-homescreen').click(function() {
        navigateTo('#homescreen');
      });

      $(".display-extra-info-changer").click(function() {
         playClickSound();
         var display_extra_info_amt = parseInt( $('#display-extra-info-text').html() );
         if (display_extra_info_amt == null || isNaN(display_extra_info_amt)) {
           display_extra_info_amt = 0;
         } else {
           var changeAmount = parseInt( $( this ).data('change-unit') ) || 5;
           display_extra_info_amt = display_extra_info_amt + changeAmount;
         }
         $('#display-extra-info-text').html(display_extra_info_amt);
         setDisplayExtraInfo(display_extra_info_amt);
       });


      $("#auto-background-calib-btn").change(function() {
        //would be a string, "On" or "Off" instead of a boolean
        //var a = $("#auto-background-calib-btn").prop("checked") ? "On" : "Off";

        background_calib_algorithm = $("#auto-background-calib-btn").prop("checked") ? 4 : 0;
        setCalibAlgorithm(background_calib_algorithm);

      });

      //this is called regardless of a programmatic change or a user change
      //fortunately it doesn't do an infinite loop (empirically tested, it only does one call here and one call in the listener)
      $("#tutorial-videos-btn").change(function() {
        //would be a string, "On" or "Off" instead of a boolean
        //var a = $("#tutorial-videos-btn").prop("checked") ? "On" : "Off";

        play_tutorial_videos = $("#tutorial-videos-btn").prop("checked");
        $('.game-play-or-tutorial-button-text').text(play_tutorial_videos ? 'Start tutorial!' : "Let's play!");
        $("#tutorial-video1-btn").flipswitch({
          disabled: !play_tutorial_videos
        });

        var isTutorialVideosEnabledRef = firebase.database().ref('users/' + uid + '/settings/isTutorialVideosEnabled');
        isTutorialVideosEnabledRef.set(play_tutorial_videos);

      });

      //this is called regardless of a programmatic change or a user change
      //fortunately it doesn't do an infinite loop (empirically tested, it only does one call here and one call in the listener)
      $("#app-sounds-btn").change(function() {
        is_sound_enabled = $("#app-sounds-btn").prop("checked");
        console.log("changed app-sounds-btn");
        var isSoundEnabledRef = firebase.database().ref('users/' + uid + '/settings/isSoundEnabled');
        isSoundEnabledRef.set(is_sound_enabled);
        setGameSoundsEnabled(is_sound_enabled);
      });


      $("#tutorial-video1-btn").change(function() { //would be a string, "On" or "Off" instead of a boolean
        play_gen_tutorial_video = $("#tutorial-video1-btn").prop("checked");
        $("#video2-screen .header-bar .header-text").text(play_gen_tutorial_video ? "Tutorial Video #2/2" : "Tutorial Video");
        console.log("changed tutorial video button");
      });

      $("#back-enabled-in-header-btn").change(function() {
        header_has_back = $("#back-enabled-in-header-btn").prop("checked");
        console.log("changed 2");
        setUpHeaders();
      });

      $("#local-tutorial-vid-files-btn").change(function() {
        use_local_tutorial_vid_files = $("#local-tutorial-vid-files-btn").prop("checked");
        console.log("changed 3");
      });

      $("#hand-select").change(function() {
        //if you wanted to do something with the value, you can do it with the string from: $("#hand-select").val();
        //nothing needs to be done here because the value is just accessed as necessary using getWhichHandIntended()

      });
    </script>
  </div>


  <!-- ============================================================= -->
  <!--                     AUTHENTICATION SCREENS                    -->
  <!-- ============================================================= -->

  <div data-role="page" id="booth-signupscreen" data-theme="d">
    <div data-role="main" class="ui-content auth-screen-main" style="padding-bottom: 0px; margin-bottom: 0px;">
      <div class="image-text-container" style="margin: auto; width: 110px; height: 100px">
        <img src="Dropbox/ui_media/main_images/singleletterlogo.png" alt="Logo" style="width: 100px; height: 100px">
        <span class="text-bottom-right-of-image">
          v<span class="version-name-holder">_</span><span class="version-suffix-holder"></span>
        </span>
      </div>
      <h3>Sign up below!</h3>
      <form class="loginpart">
        <input class="username-box" id="booth-sign-up-email-addr-box" type="email" value="" data-clear-btn="true" placeholder="email address">
        <input class="username-box" id="booth-sign-up-fname-box" type="text" value="" data-clear-btn="true" placeholder="first name">
        <input class="username-box" id="booth-sign-up-lname-box" type="text" value="" data-clear-btn="true" placeholder="last name">
        <input class="password-box" id="booth-sign-up-password-box" type="password" value="" data-clear-btn="true" placeholder="password">
        <input class="password-box" id="booth-sign-up-password-confirm-box" type="password" value="" data-clear-btn="true" placeholder="confirm password">

        <input class="username-box" id="booth-sign-up-phone-box" type="number" value="" data-clear-btn="true" placeholder="phone #">
        <input class="username-box" id="booth-sign-up-clinic-name-box" type="text" value="" data-clear-btn="true" placeholder="clinic name">
        <input class="username-box" id="booth-sign-up-state-box" type="text" value="" data-clear-btn="true" placeholder="state or location">

        <input class="username-box" id="booth-sign-up-access-code-box" type="text" value="" data-clear-btn="true" placeholder="access code">

        <p class="authresponse" id="booth-signupresponse"></p>
        <input type="button" id="booth-sign-up-complete-button" data-shadow="false" value="Sign up!">
      </form>
      <div class="loginlinks">
        <p><a href="#need-access-code-popup" class="loginpopup" data-rel="popup" data-transition="slideup"> How do I get an access code? </a></p>
        <!-- <p><a href="#loginscreen"> Already have an account? </a></p> -->
      </div>
      <img src="Dropbox/ui_media/main_images/tabletimage.png" alt="TabletImage" class="authtabletimage">
    </div> <!-- main -->

    <div data-role="popup" id="booth-need-access-code-popup" data-theme="c" > <!-- Add data-overlay-theme="b" to add shading to back part-->
      <p>To get an access code if you do not already have one, please contact MoTrack Therapy at <a target="external" href="tel:+1-732-456-5701">732-456-5701</a> (8AM-10PM EST, call or text) or <a target="external" href="mailto:support@motracktherapy.com">support@motracktherapy.com</a>. </p>
    </div>

    <script type="text/javascript">
      $(document).delegate('#booth-signupscreen', 'pagebeforeshow', function() {
        //Your code for each page load here
        $("#booth-signupresponse").text("");

        //reset values
        $("#booth-sign-up-email-addr-box").val("");
        $("#booth-sign-up-fname-box").val("");
        $("#booth-sign-up-lname-box").val("");
        $("#booth-sign-up-password-box").val("");
        $("#booth-sign-up-password-confirm-box").val("");

        $("#booth-sign-up-phone-box").val("");
        $("#booth-sign-up-clinic-name-box").val("");
        $("#booth-sign-up-state-box").val("");

        $("#booth-sign-up-access-code-box").val("");
      });

      $("#booth-sign-up-complete-button").click(function() {
        playClickSound();
        $("#booth-signupresponse").text(""); //make empty
        var email_addr = $("#booth-sign-up-email-addr-box").val().trim();
        var fname = $("#booth-sign-up-fname-box").val().trim();
        var lname = $("#booth-sign-up-lname-box").val().trim();
        var password = $("#booth-sign-up-password-box").val();
        var password_confirm = $("#booth-sign-up-password-confirm-box").val();

        var phone = $("#booth-sign-up-phone-box").val();
        var clinic_name = $("#booth-sign-up-clinic-name-box").val();
        var state_loc = $("#booth-sign-up-state-box").val();


        var access_code = $("#booth-sign-up-access-code-box").val();
        //$("#booth-sign-up-password-box").val(""); //set the text to empty for security
        //$("#booth-sign-up-password-confirm-box").val(""); //set the text to empty for security
        var clinicCode = $("#booth-sign-up-access-code-box").val();
        var userCategory = "Therapist"; //will be undefined if nothing is checked

        if (email_addr == "") {
          $("#booth-signupresponse").text("Please enter your email address.");

        } else if (!email_addr.includes("@")) {
          $("#booth-signupresponse").text("Please enter a valid email address.");

        } else if (fname == "") {
          $("#booth-signupresponse").text("Please enter your first name.");

        } else if (lname == "") {
          $("#booth-signupresponse").text("Please enter your last name.");

        } else if (password == "") {
          $("#booth-password").html("Please enter a password");

        } else if (password != password_confirm) {
          $("#booth-signupresponse").text("Password confirmation doesn't match password.");

        } else if (password.length < 6) {
          //this is a firebase requirement, so we might as well tell them here instead of waiting until firebase returns with a auth/weak-password
          $("#booth-signupresponse").text("Password must be at least 6 letters.");

        } else if (userCategory == null || userCategory == "") {
          //this is a firebase requirement, so we might as well tell them here instead of waiting until firebase returns with a auth/weak-password
          $("#booth-signupresponse").text("Please answer what type of user you are.");

        } else if (access_code == null || access_code == "") {
          //Make access code not required for now
          $("#booth-signupresponse").text("Please enter your clinic's MoTrack Therapy access code.");

        } else {
          var incorrectAccessCodeStr = "We're sorry. That access code does not exist. Check with your institution and try again.";
          access_code = access_code.toUpperCase();
          var regex = /^([A-Z]{2}[0-9]{4})$/; //must match exactly two uppercase letters, then exactly four numbers
          if(!regex.test(access_code)) { //if it doesn't even match the format, we know the access code is wrong, so we don't even have to check it online
            $("#booth-signupresponse").text(incorrectAccessCodeStr);
            console.log("#1");

          } else {

            $.mobile.loading("show", {
              text: "Creating Account...",
              textVisible: true,
              theme: "d",
              html: ""
            });

            var time = getTimeAsReadableString();

            var clinicCodeRef = firebase.database().ref('clinicCodes/' + access_code + '');
            clinicCodeRef.set(
              {email_addr: email_addr,
                AOTAUsed2: true,
                "timestr": time.str,
                "time": time.unix,
                 fname: fname,
                 lname: lname },
              function(err) { // error callback triggered with PERMISSION_DENIED
              showAndroidToast("Permission Denied 1 " + err);
            });
            createAccountValues = [fname, lname, clinicCode, userCategory, phone, clinic_name, state_loc];
            firebase.auth().createUserWithEmailAndPassword(email_addr, password).catch(
              function(error) {
                // Handle Errors here.
                var errorCode = error.code;
                var errorMessage = error.message;
                if (errorCode == "auth/weak-password") { //one reason this can happen is it password is too short
                  $("#booth-signupresponse").text(errorMessage);
                } else if (errorCode == "auth/email-already-in-use") {
                  $("#booth-signupresponse").html("That email address is already taken. If this you, <a href='#resetpasswordscreen'> click here to reset your password </a>.");
                } else {
                  $("#booth-signupresponse").text(errorMessage);
                  //$("#signupresponse").text("Unable to create this account right now.");
                }
            });
          }
        }


      });
    </script>

  </div> <!-- sign up page -->


  <div data-role="page" id="loginscreen" data-theme="d">

    <div data-role="main" class="ui-content auth-screen-main" style="padding-bottom: 0px; margin-bottom: 0px;">
      <div class="image-text-container" style="margin: auto; width: 110px; height: 100px">
        <img src="Dropbox/ui_media/main_images/singleletterlogo.png" alt="Logo" style="width: 100px; height: 100px">
        <span class="text-bottom-right-of-image">
          v<span class="version-name-holder">_</span><span class="version-suffix-holder"></span>
        </span>
      </div>
      <h3>Sign in below!</h3>
      <form class="loginpart">
        <input class="username-box" id="username-box1" type="email"     value="" data-clear-btn="true" placeholder="email address">
        <input class="password-box" id="password-box1" type="password" value="" data-clear-btn="true" placeholder="password">
        <p class="authresponse" id="loginresponse"></p>
        <input type="button" id="login-button" data-shadow="false" value="Let's Play!">
      </form>
      <div class="loginlinks">
        <p><a href="#signupscreen1"> Create an account?</a></p>
        <p><a href="#resetpasswordscreen"> Forgot username or password?</a></p>
        <!-- <p><a href="#signin-info-popup" class="loginpopup" data-rel="popup" data-transition="slideup"> Popup</a></p> -->
      </div>
      <img src="Dropbox/ui_media/main_images/tabletimage.png" alt="TabletImage" class="authtabletimage">
    </div> <!-- main -->

    <script type="text/javascript">
      $(document).delegate('#loginscreen', 'pagebeforeshow', function() {
        //Your code for each page load here
        $("#password-box1").val("");
        $("#loginresponse").text(""); //make loginresponse empty
        if ($("#reset-password-email-addr-box").val()) { //will not activate if #username-box1 is empty
          $("#username-box1").val( $("#reset-password-email-addr-box").val() );
        }
      });

      //async modifier needed so that we can use the await command
      $("#login-button").click(async function() {
        playClickSound();
        $("#loginresponse").text(""); //make empty
        var username_box_val = $("#username-box1").val();
        test_username = username_box_val.toLowerCase().trim();
        var test_password = $("#password-box1").val();


        //in case error in which user is somehow already currently signed in
        //await requires this function to be async
        await firebase.auth().signOut();


        $("#password-box1").val(""); //set the text to empty
        if (!test_username.includes("@")) {
          test_username = test_username + "@motracktherapy.com";
        }
        $.mobile.loading("show", {
          text: "Loading...",
          textVisible: true,
          theme: "d",
          html: ""
        });

        var loginsAllowedRef = getVersionsRefFromFirebase();
        loginsAllowedRef.once("child_added", //must be child_added not value. Otherwise, it will return back value of key iOS/Android
          function(snapshot) {
            var val = snapshot.child("appAccess/loginsAllowed").val();

            //if val of 0, let user know that logins/signups are not allowed
            //if val of 2, let user know that they need to update the app to log in/sign up
            //if val between 4 and 10, warn user that they will need to update the app soon, but try to log them in/sign them up now anyway
            //if val above 10, try to log them in/sign them up with no warnings
            if (val < 2) {
              updateAfterFailedLogin("motrack/loginsNotAllowed", "Logins are not currently allowed. Contact support at (732) 456 5701 or support@motracktherapy.com.")

            } else if (val < 4) {
              updateAfterFailedLogin("motrack/loginsNotAllowed", "You must first update your version of the MoTrack Therapy app.")

            } else if (val == null || val >= 4) {
              if (val != null && val < 10) {
                $("#loginresponse").text("Warning: You will soon have to update your app version.");
              }
              firebase.auth().signInWithEmailAndPassword(test_username, test_password).catch(function(error) {
                updateAfterFailedLogin(error.code, error.message); // Handle Errors here.
              });
            }


          }, function(err) { // error callback triggered with PERMISSION_DENIED
            $.mobile.loading("hide");
            showAndroidToast("Error with getting log in permissions");
            console.log(err);
          });

      });
    </script>

  </div> <!-- login page -->

  <div data-role="page" id="resetpasswordscreen" data-theme="d">
    <div data-role="main" class="ui-content auth-screen-main" style="padding-bottom: 0px; margin-bottom: 0px;">
      <div class="image-text-container" style="margin: auto; width: 110px; height: 100px">
        <img src="Dropbox/ui_media/main_images/singleletterlogo.png" alt="Logo" style="width: 100px; height: 100px">
        <span class="text-bottom-right-of-image">
          v<span class="version-name-holder">_</span><span class="version-suffix-holder"></span>
        </span>
      </div>
      <h3>Reset your password</h3>
      <p style="color: black;"> Enter in your email address and we'll send you an email that will let you reset your password. </p>
      <form class="loginpart">
        <input class="username-box" id="reset-password-email-addr-box" type="email" value="" data-clear-btn="true" placeholder="email address">
        <p class="authresponse" id="resetpasswordresponse"></p>
        <input type="button" id="reset-password-button" data-shadow="false" value="Send Reset Link">
      </form>
      <div class="loginlinks">
        <p><a href="#loginscreen"> Remembered your password? </a></p>
        <p><a href="#lost-username-popup" class="loginpopup" data-rel="popup" data-transition="slideup"> Forgot your email address? </a></p>
      </div>
      <img src="Dropbox/ui_media/main_images/tabletimage.png" alt="TabletImage" class="authtabletimage">
    </div> <!-- main -->

    <div data-role="popup" id="lost-username-popup" data-theme="c" > <!-- Add data-overlay-theme="b" to add shading to back part-->
      <p>If you have lost your username/email address, please contact MoTrack Therapy at <a target="external" href="tel:+1-732-456-5701">732-456-5701</a> (8AM-10PM EST, call or text) or <a href="mailto:support@motracktherapy.com">support@motracktherapy.com</a> </p>
    </div>

    <script type="text/javascript">
      $(document).delegate('#resetpasswordscreen', 'pagebeforeshow', function() {
        //Your code for each page load here
        if ($("#username-box1").val()) { //will not activate if #username-box1 is empty
          $("#reset-password-email-addr-box").val( $("#username-box1").val() );
        } else {
          $("#reset-password-email-addr-box").val( "" );
        }
        $("#resetpasswordresponse").text(""); //make loginresponse empty


      });

      $("#reset-password-button").click(function() {
        playClickSound();
        if (!$("#reset-password-email-addr-box").val()) {
          $("#resetpasswordresponse").text("Please enter an email address");

        } else {
          firebase.auth().sendPasswordResetEmail( $("#reset-password-email-addr-box").val() ).then(function() {
            $("#resetpasswordresponse").text("");
            navigateTo("#loginscreen");
            /*setTimeout(
              function() {
                if (uid == null) { //need this if statement in case user goes back and logs in before the timer is out

                }
              }, 5000);*/
            // Email sent.

          }).catch(function(error) {
            if (error.code === "auth/network-request-failed") {
              $("#resetpasswordresponse").text("Can't connect to the Internet.");
            } else if (error.code == "auth/invalid-email") {
              $("#resetpasswordresponse").text("Username is not in a valid form.");
            } else if (errorCode.startsWith("motrack/")) {
              $("#resetpasswordresponse").text(error.message);
            } else {
              $("#resetpasswordresponse").text(error.message);
            }
            // An error happened.
          });
        }


      });
    </script>

  </div> <!-- reset password -->



  <div data-role="page" id="signupscreen1" data-theme="d">
    <div data-role="main" class="ui-content auth-screen-main" style="padding-bottom: 0px; margin-bottom: 0px;">
      <div class="image-text-container" style="margin: auto; width: 110px; height: 100px">
        <img src="Dropbox/ui_media/main_images/singleletterlogo.png" alt="Logo" style="width: 100px; height: 100px">
        <span class="text-bottom-right-of-image">
          v<span class="version-name-holder">_</span><span class="version-suffix-holder"></span>
        </span>
      </div>
      <h3>Sign up below!</h3>
      <form class="loginpart">
        <fieldset id="signup-user-type" data-role="controlgroup" data-theme="a">
          <legend>I am a...</legend>
          <input type="radio" name="radio-choice-v-2" id="radio-choice-v-2a" value="Patient">
          <label for="radio-choice-v-2a">Patient wanting to use the app</label>
          <input type="radio" name="radio-choice-v-2" id="radio-choice-v-2b" value="Therapist">
          <label for="radio-choice-v-2b">Therapist wanting to demo</label>
        </fieldset>
        <input type="button" id="sign-up-next-button" data-shadow="false" value="Next!" disabled="">
      </form>
      <div class="loginlinks">
        <p><a href="#loginscreen"> Already have an account? </a></p>
      </div>
      <img src="Dropbox/ui_media/main_images/tabletimage.png" alt="TabletImage" class="authtabletimage">
    </div> <!-- main -->

    <script type="text/javascript">
      $("#sign-up-next-button").click(function() {
        playClickSound();
        navigateTo("#signupscreen2");
      });
      $('#signup-user-type input').change(function() {
        var userCategory = $("#signup-user-type :radio:checked").val() //the value is represented by short_exercise_name_lc
        console.log("userCategory: " + userCategory);
        if (userCategory == null) { //nothing is checked
          $("#sign-up-next-button").button('disable');
        } else {
          $("#sign-up-next-button").button('enable');
        }
      });
    </script>

  </div> <!-- sign up page -->

  <div data-role="page" id="signupscreen2" data-theme="d">
    <div data-role="main" class="ui-content auth-screen-main" style="padding-bottom: 0px; margin-bottom: 0px;">
      <div class="image-text-container" style="margin: auto; width: 110px; height: 100px">
        <img src="Dropbox/ui_media/main_images/singleletterlogo.png" alt="Logo" style="width: 100px; height: 100px">
        <span class="text-bottom-right-of-image">
          v<span class="version-name-holder">_</span><span class="version-suffix-holder"></span>
        </span>
      </div>
      <h3>Sign up below!</h3>
      <form class="loginpart">
        <input class="username-box" id="sign-up-email-addr-box" type="email" value="" data-clear-btn="true" placeholder="email address">
        <input class="username-box" id="sign-up-fname-box" type="text" value="" data-clear-btn="true" placeholder="first name">
        <input class="username-box" id="sign-up-lname-box" type="text" value="" data-clear-btn="true" placeholder="last name">
        <input class="password-box" id="sign-up-password-box" type="password" value="" data-clear-btn="true" placeholder="password">
        <input class="password-box" id="sign-up-password-confirm-box" type="password" value="" data-clear-btn="true" placeholder="confirm password">
        <input class="username-box" id="sign-up-access-code-box" type="text" value="" data-clear-btn="true" placeholder="code (optional)">
        <p class="authresponse" id="signupresponse"></p>
        <input type="button" id="sign-up-complete-button" data-shadow="false" value="Sign up!">
      </form>
      <div class="loginlinks">
        <p><a href="#need-access-code-popup" class="loginpopup" data-rel="popup" data-transition="slideup"> How do I get an access code? </a></p>
        <p><a href="#loginscreen"> Already have an account? </a></p>
      </div>
      <img src="Dropbox/ui_media/main_images/tabletimage.png" alt="TabletImage" class="authtabletimage">
    </div> <!-- main -->

    <div data-role="popup" id="need-access-code-popup" data-theme="c" > <!-- Add data-overlay-theme="b" to add shading to back part-->
      <p>To get an access code if you do not already have one, please contact MoTrack Therapy at <a target="external" href="tel:+1-732-456-5701">732-456-5701</a> (8AM-10PM EST, call or text) or <a target="external" href="mailto:support@motracktherapy.com">support@motracktherapy.com</a>. </p>
    </div>

    <script type="text/javascript">
      $(document).delegate('#loginscreen', 'pagebeforeshow', function() {
        //Your code for each page load here
        $("#signupresponse").text("");

        //reset values
        $("#sign-up-email-addr-box").val("");
        $("#sign-up-fname-box").val("");
        $("#sign-up-lname-box").val("");
        $("#sign-up-password-box").val("");
        $("#sign-up-password-confirm-box").val("");
        $("#sign-up-access-code-box").val("");
        $("#sign-up-password-box").val("");
      });

      $("#sign-up-complete-button").click(function() {
        playClickSound();
        var newSignUpsAllowed = true;
        if (newSignUpsAllowed) {
          $("#signupresponse").text(""); //make empty
          var email_addr = $("#sign-up-email-addr-box").val().trim();
          var fname = $("#sign-up-fname-box").val().trim();
          var lname = $("#sign-up-lname-box").val().trim();
          var password = $("#sign-up-password-box").val();
          var password_confirm = $("#sign-up-password-confirm-box").val();
          var access_code = $("#sign-up-access-code-box").val();
          $("#sign-up-password-box").val(""); //set the text to empty for security
          $("#sign-up-password-confirm-box").val(""); //set the text to empty for security
          var clinicCode = $("#sign-up-access-code-box").val();
          var userCategory = $("#signup-user-type :radio:checked").val(); //will be undefined if nothing is checked

          if (email_addr == "") {
            $("#signupresponse").text("Please enter your email address.");

          } else if (!email_addr.includes("@")) {
            $("#signupresponse").text("Please enter a valid email address.");

          } else if (fname == "") {
            $("#signupresponse").text("Please enter your first name.");

          } else if (lname == "") {
            $("#signupresponse").text("Please enter your last name.");

          } else if (password == "") {
            $("#password").html("Please enter a password");

          } else if (password != password_confirm) {
            $("#signupresponse").text("Password confirmation doesn't match password.");

          } else if (password.length < 6) {
            //this is a firebase requirement, so we might as well tell them here instead of waiting until firebase returns with a auth/weak-password
            $("#signupresponse").text("Password must be at least 6 letters.");

          } else if (userCategory == null || userCategory == "") {
            //this is a firebase requirement, so we might as well tell them here instead of waiting until firebase returns with a auth/weak-password
            $("#signupresponse").text("Please answer what type of user you are.");

          } else if (access_code == null || access_code == "") {
            //Make access code not required for now
            if (is_access_code_required_for_therapist || userCategory == "Patient") {
              $("#signupresponse").text("Please enter your clinic's MoTrack Therapy access code.");

            } else {
              var signupsAllowedRef = getVersionsRefFromFirebase();
              signupsAllowedRef.once("child_added", //must be child_added not value. Otherwise, it will return back value of key iOS/Android
                function(snapshot) {
                  var val = snapshot.child("appAccess/signupsAllowed").val();

                  //if val of 0, let user know that logins/signups are not allowed
                  //if val of 2, let user know that they need to update the app to log in/sign up
                  //if val between 4 and 10, warn user that they will need to update the app soon, but try to log them in/sign them up now anyway
                  //if val above 10, try to log them in/sign them up with no warnings
                  if (val < 2) {
                    $("#signupresponse").text("Sign ups are not currently allowed. Contact support at (732) 456 5701 or support@motracktherapy.com.")

                  } else if (val < 4) {
                    $("#signupresponse").text("You must first update your version of the MoTrack Therapy app.")

                  } else if (val == null || val >= 4) {
                    if (val != null && val < 10) { //give warning, but still allow logging in
                      $("#signupresponse").text("Warning: You will soon have to update your app version.");
                    }
                    if (val < 6 || (val >= 10 && val < 12) ) {

                    }
                    createAccountValues = [fname, lname, clinicCode, userCategory];
                    firebase.auth().createUserWithEmailAndPassword(email_addr, password).catch(
                      function(error) {
                        // Handle Errors here.
                        var errorCode = error.code;
                        var errorMessage = error.message;
                        if (errorCode == "auth/weak-password") { //one reason this can happen is it password is too short
                          $("#signupresponse").text(errorMessage);
                        } else if (errorCode == "auth/email-already-in-use") {
                          $("#signupresponse").html("That email address is already taken. If this you, <a href='#resetpasswordscreen'> click here to reset your password </a>.");
                        } else {
                          $("#signupresponse").text(errorMessage);
                          //$("#signupresponse").text("Unable to create this account right now.");
                        }
                    });

                  }

                }, function(err) { // error callback triggered with PERMISSION_DENIED
                  showAndroidToast("Error with getting log in permissions");
                });
            }



          } else {
            var incorrectAccessCodeStr = "We're sorry. That access code does not exist. Check with your institution and try again.";
            access_code = access_code.toUpperCase();
            var regex = /^([A-Z]{2}[0-9]{4})$/; //must match exactly two uppercase letters, then exactly four numbers
            if(!regex.test(access_code)) { //if it doesn't even match the format, we know the access code is wrong, so we don't even have to check it online
              $("#signupresponse").text(incorrectAccessCodeStr);
              console.log("#1");

            } else {
              var clinicCodeRef = firebase.database().ref('clinicCodes/' + access_code + '');
              clinicCodeRef.once('value',
                function(snapshot) {
                  //null indicates empty (never been set)
                  if (snapshot.val() == null || snapshot.val().length == 0) {
                    $("#signupresponse").text(incorrectAccessCodeStr);
                    console.log("#2");
                  } else {
                    var enabled = snapshot.child("enabled").val();
                    if ( enabled == null || typeof enabled != 'number' || enabled < 1) {
                      $("#signupresponse").text(incorrectAccessCodeStr);
                      console.log("#3");

                    } else if (enabled >= 1 ){ //Confirmed that the access code exists and is enabled

                      var signupsAllowedRef = getVersionsRefFromFirebase();
                      signupsAllowedRef.once("child_added", //must be child_added not value. Otherwise, it will return back value of key iOS/Android
                        function(snapshot) {
                          var val = snapshot.child("appAccess/signupsAllowed").val();

                          //if val of 0, let user know that logins/signups are not allowed
                          //if val of 2, let user know that they need to update the app to log in/sign up
                          //if val between 4 and 10, warn user that they will need to update the app soon, but try to log them in/sign them up now anyway
                          //if val above 10, try to log them in/sign them up with no warnings
                          if (val < 2) {
                            $("#signupresponse").text("Sign ups are not currently allowed. Contact support at (732) 456 5701 or support@motracktherapy.com.")

                          } else if (val < 4) {
                            $("#signupresponse").text("You must first update your version of the MoTrack Therapy app.")

                          } else if (val == null || val >= 4) {
                            if (val != null && val <= 10) { //give warning, but still allow logging in
                              $("#signupresponse").text("Warning: You will soon have to update your app version.");
                            }
                            createAccountValues = [fname, lname, clinicCode, userCategory];
                            firebase.auth().createUserWithEmailAndPassword(email_addr, password).catch(
                              function(error) {
                                // Handle Errors here.
                                var errorCode = error.code;
                                var errorMessage = error.message;
                                if (errorCode == "auth/weak-password") { //one reason this can happen is it password is too short
                                  $("#signupresponse").text(errorMessage);
                                } else if (errorCode == "auth/email-already-in-use") {
                                  $("#signupresponse").html("That email address is already taken. If this you, <a href='#resetpasswordscreen'> click here to reset your password </a>.");
                                } else {
                                  $("#signupresponse").text(errorMessage);
                                  //$("#signupresponse").text("Unable to create this account right now.");
                                }
                            });

                          }

                        }, function(err) { // error callback triggered with PERMISSION_DENIED
                          showAndroidToast("Error with getting log in permissions");
                        });



                    } else {
                      $("#signupresponse").text("Error with access code.");
                    }
                  }
                }, function(err) { // error callback triggered with PERMISSION_DENIED
                  showAndroidToast("Permission Denied 1 " + err);
                });
            }
          }
        } else {
          $("#signupresponse").text("No new signups are allowed at this time.");
        }


      });
    </script>

  </div> <!-- sign up page -->



  <!-- ============================================================= -->
  <!--                     TEMPLATES SCREENS                    -->
  <!-- ============================================================= -->
  <script id="header_template_with_tutorial" type="text/html">

    <a href="#tutorial-main" data-transition="slide" class="ui-btn ui-icon-info ui-btn-icon-notext ui-corner-all">Home</a>
    <h1 class="header-text">
      {{screen_title}}
    </h1>
    <a href="#settingspanel" class="ui-btn ui-icon-gear ui-btn-icon-notext ui-corner-all">Settings</a>

  </script>

  <script id="header_template_with_home" type="text/html">

    <a href="#homescreen" data-transition="slide" data-direction="reverse" class="ui-btn ui-icon-home ui-btn-icon-notext ui-corner-all">Home</a>
    <h1 class="header-text">
      {{screen_title}}
    </h1>
    <a href="#settingspanel" class="ui-btn ui-icon-gear ui-btn-icon-notext ui-corner-all">Settings</a>

  </script>

  <script id="header_template_with_back" type="text/html">

    <a href="javascript:history.back()"  data-transition="slide" data-direction="reverse" class="ui-btn ui-icon-arrow-l ui-btn-icon-notext ui-corner-all">Back</a>
    <h1 class="header-text header-text-style">
      {{screen_title}}
    </h1>
    <a href="#settingspanel" class="ui-btn ui-icon-gear ui-btn-icon-notext ui-corner-all">Settings</a>

  </script>


  <!-- ============================================================= -->
  <!--                        SUBTITLE TEXTS                         -->
  <!-- ============================================================= -->

  <!-- **********  Test SUBTITLES  ********** -->
<script id="subtitles-test" type="text/vtt">
WEBVTT - This file has cues.

00:01.000 --> 00:04.000
Welcome to this app.

00:05.000 --> 00:09.000
- It is a pleasure to meet you.
- Thanks for watching!
</script>

<!-- **********************************************
     **********  BALLOON GAME SUBTITLES  **********
     ********************************************** -->
<script id="subtitles-balloon" type="text/vtt">
WEBVTT - MoTrack Therapy Balloon Game Subtitles, March 12, 2019

00:00:00.000 --> 00:00:08.000
As you get ready to play, follow these steps to have the best experience possible.

00:00:09.000 --> 00:00:14.000
1. Place your phone down on a flat surface, with the screen facing up.

00:00:15.000 --> 00:00:19.000
2. Make sure there are no lights directly overhead.

00:00:20.000 --> 00:00:22.000
This makes it difficult for the camera to focus on your hand).

00:00:23.000 --> 00:00:25.000
3. Make sure your sound is on.

00:00:26.000 --> 00:00:30.000
The different sounds will let you know when different things are happening in the games.

00:00:32.000 --> 00:00:36.000
4. When you’re ready, the phone will automatically begin to count down from 5,

00:00:37.000 --> 00:00:43.000
giving you 5 seconds to remove any moving body parts (like your head and your hands) out of view of the camera.

00:00:44.000 --> 00:00:48.000
During and after the countdown, refrain from moving your phone again.

00:00:49.000 --> 00:00:53.000
5. When the countdown gets to 0, you will see the screen change.

00:00:54.000 --> 00:00:59.000
When this happens, you can move your hand back into the frame (but try to keep out any other body parts).

00:01:00.000 --> 00:01:04.000
Try to make sure your hand is roughly the same size as the hand that appears on the screen.

00:01:06.000 --> 00:01:10.000
6. The screen will change one more time, bringing you to the game.

00:01:11.000 --> 00:01:13.000
You can begin completing your exercises.

00:01:14.000 --> 00:01:20.000
7. If the background begins to look funny, like this--

00:01:21.000 --> 00:01:27.000
hit the reset button, which will bring you back to the countdown, and you can try again.

00:01:29.000 --> 00:01:32.000
Once everything seems to be working and you’re ready to play,

00:01:33.000 --> 00:01:39.000
begin performing the correct exercise at your own pacein this case, open palm/closed fist.

00:01:40.000 --> 00:01:47.000
You will see the balloon begin to inflate. Make sure you keep your four fingers together with your thumb out for best results.

00:01:48.000 --> 00:01:53.000
The objective of the game is to inflate the balloon as much as possible before it pops.

00:01:54.000 --> 00:01:58.000
If it pops, you will not be awarded any points.

00:01:59.000 --> 00:02:04.000
When you have inflated the balloon as much as you think you can, pause for a moment, and the balloon should float away.

00:02:05.000 --> 00:02:09.000
The bigger the balloon, the more points you will be awarded.

00:02:10.000 --> 00:02:15.000
Make sure you don’t pause too early, or your balloon may float away before you’re finished inflating!

00:02:16.000 --> 00:02:20.000
However, make sure you still take your time and don’t strain yourself to the point of discomfort.

00:02:21.000 --> 00:02:33.000
If you do feel extreme pain or discomfort at any point, please stop playing and contact your healthcare provider.
  </script>


  <!-- **********************************************
       **********  CATAPULT GAME SUBTITLES  **********
       ********************************************** -->
<script id="subtitles-catapult" type="text/vtt">
WEBVTT - MoTrack Therapy Catapult Game Subtitles, March 12, 2019

00:00:00.000 --> 00:00:08.000
As you get ready to play, follow these steps to have the best experience possible.

00:00:09.000 --> 00:00:14.000
1. Place your phone down on a flat surface, with the screen facing up.

00:00:15.000 --> 00:00:19.000
2. Make sure there are no lights directly overhead.

00:00:20.000 --> 00:00:22.000
This makes it difficult for the camera to focus on your hand).

00:00:23.000 --> 00:00:25.000
3. Make sure your sound is on.

00:00:26.000 --> 00:00:30.000
The different sounds will let you know when different things are happening in the games.

00:00:32.000 --> 00:00:36.000
4. When you’re ready, the phone will automatically begin to count down from 5,

00:00:37.000 --> 00:00:43.000
giving you 5 seconds to remove any moving body parts (like your head and your hands) out of view of the camera.

00:00:44.000 --> 00:00:48.000
During and after the countdown, refrain from moving your phone again.

00:00:49.000 --> 00:00:53.000
5. When the countdown gets to 0, you will see the screen change.

00:00:54.000 --> 00:00:59.000
When this happens, you can move your hand back into the frame (but try to keep out any other body parts).

00:01:00.000 --> 00:01:04.000
Try to make sure your hand is roughly the same size as the hand that appears on the screen.

00:01:06.000 --> 00:01:10.000
6. The screen will change one more time, bringing you to the game.

00:01:11.000 --> 00:01:13.000
You can begin completing your exercises.

00:01:14.000 --> 00:01:20.000
7. If the background begins to look funny, like this--

00:01:21.000 --> 00:01:27.000
hit the reset button, which will bring you back to the countdown, and you can try again.

00:01:28.000 --> 00:01:31.000
Once everything seems to be working and you’re ready to play

00:01:32.000 --> 00:01:38.000
begin performing the correct exercise at your own pacein this case, radial/ulnar deviation.

00:01:39.000 --> 00:01:43.000
Make sure you keep your four fingers together with your thumb out for best results.

00:01:44.000 --> 00:01:48.000
Soon, you will see the arm of the catapult begin to draw back.

00:01:49.000 --> 00:01:53.000
The objective of the game is to draw back the arm as far as it can go before it breaks.

00:01:54.000 --> 00:01:58.000
If it breaks, you will not be awarded any points.

00:01:59.000 --> 00:02:07.000
When you have pulled back the arm as much as you think you can, remove your hand from the screen, and the catapult should fire the ball at the target.

00:02:08.000 --> 00:02:12.000
The farther back you pull the arm, the closer your ball will land to the target’s center.

00:02:13.000 --> 00:02:16.000
You will earn more points when the ball lands closer to the center.

00:02:17.000 --> 00:02:20.000
Take your time and don’t strain yourself to the point of discomfort.

00:02:21.000 --> 00:02:31.000
If you do feel extreme pain or discomfort at any point, please stop playing and contact your healthcare provider.
</script>

<!-- **********************************************
     ***********  KNOCK GAME SUBTITLES  ***********
     ********************************************** -->
<script id="subtitles-knock" type="text/vtt">
WEBVTT - MoTrack Therapy Door Game Subtitles, March 12, 2019

00:00:00.000 --> 00:00:08.000
As you get ready to play, follow these steps to have the best experience possible.

00:00:09.000 --> 00:00:14.000
1. Place your phone down on a flat surface, with the screen facing up.

00:00:15.000 --> 00:00:19.000
2. Make sure there are no lights directly overhead.

00:00:20.000 --> 00:00:22.000
This makes it difficult for the camera to focus on your hand).

00:00:23.000 --> 00:00:25.000
3. Make sure your sound is on.

00:00:26.000 --> 00:00:30.000
The different sounds will let you know when different things are happening in the games.

00:00:32.000 --> 00:00:36.000
4. When you’re ready, the phone will automatically begin to count down from 5,

00:00:37.000 --> 00:00:43.000
giving you 5 seconds to remove any moving body parts (like your head and your hands) out of view of the camera.

00:00:44.000 --> 00:00:48.000
During and after the countdown, refrain from moving your phone again.

00:00:49.000 --> 00:00:53.000
5. When the countdown gets to 0, you will see the screen change.

00:00:54.000 --> 00:00:59.000
When this happens, you can move your hand back into the frame (but try to keep out any other body parts).

00:01:00.000 --> 00:01:04.000
Try to make sure your hand is roughly the same size as the hand that appears on the screen.

00:01:06.000 --> 00:01:10.000
6. The screen will change one more time, bringing you to the game.

00:01:11.000 --> 00:01:13.000
You can begin completing your exercises.

00:01:14.000 --> 00:01:20.000
7. If the background begins to look funny, like this--

00:01:21.000 --> 00:01:27.000
hit the reset button, which will bring you back to the countdown, and you can try again.

00:01:30.000 --> 00:01:39.000
Once everything seems to be working and you’re ready to play, look for blue arrows that will instruct you where to move first.

00:01:40.000 --> 00:01:49.000
As you begin completing the flexion/extension exercises, make sure you keep your four fingers together with your thumb out for best results.

00:01:50.000 --> 00:01:56.000
There will be text at the top of the screen that will instruct you to hold your current position (which should appear in green),

00:01:57.000 --> 00:02:02.000
or instruct you to move to the next position, “readjust” (which should appear in red).

00:02:03.000 --> 00:02:09.000
The objective of this game is to knock on the door as many times as you can while still feeling comfortable.

00:02:10.000 --> 00:02:17.000
If you feel extreme pain or discomfort at any point, please stop playing and contact your healthcare provider.
</script>


<!-- **********************************************
     **********  SQUEEZE GAME SUBTITLES  **********
     ********************************************** -->
<script id="subtitles-squeeze" type="text/vtt">
WEBVTT - MoTrack Therapy Squeeze Game Subtitles, March 12, 2019

00:00:00.000 --> 00:00:08.000
As you get ready to play, follow these steps to have the best experience possible.

00:00:09.000 --> 00:00:14.000
1. Place your phone down on a flat surface, with the screen facing up.

00:00:15.000 --> 00:00:19.000
2. Make sure there are no lights directly overhead.

00:00:20.000 --> 00:00:22.000
This makes it difficult for the camera to focus on your hand).

00:00:23.000 --> 00:00:25.000
3. Make sure your sound is on.

00:00:26.000 --> 00:00:30.000
The different sounds will let you know when different things are happening in the games.

00:00:32.000 --> 00:00:36.000
4. When you’re ready, the phone will automatically begin to count down from 5,

00:00:37.000 --> 00:00:43.000
giving you 5 seconds to remove any moving body parts (like your head and your hands) out of view of the camera.

00:00:44.000 --> 00:00:48.000
During and after the countdown, refrain from moving your phone again.

00:00:49.000 --> 00:00:53.000
5. When the countdown gets to 0, you will see the screen change.

00:00:54.000 --> 00:00:59.000
When this happens, you can move your hand back into the frame (but try to keep out any other body parts).

00:01:00.000 --> 00:01:04.000
Try to make sure your hand is roughly the same size as the hand that appears on the screen.

00:01:06.000 --> 00:01:10.000
6. The screen will change one more time, bringing you to the game.

00:01:11.000 --> 00:01:13.000
You can begin completing your exercises.

00:01:14.000 --> 00:01:20.000
7. If the background begins to look funny, like this--

00:01:21.000 --> 00:01:27.000
hit the reset button, which will bring you back to the countdown, and you can try again.

00:01:29.000 --> 00:01:32.000
Once everything seems to be working and you’re ready to play,

00:01:33.000 --> 00:01:36.000
look for blue arrows that will instruct you where to move first.

00:01:37.000 --> 00:01:46.000
As you begin completing the open palm/closed fist exercise, make sure you keep your four fingers together with your thumb out for best results.

00:01:47.000 --> 00:01:54.000
There will be text at the top of the screen that will instruct you to hold your current position (which should appear in green),

00:01:55.000 --> 00:01:59.000
or instruct you to move to the next position, “readjust” (which should appear in red).

00:02:00.000 --> 00:02:05.000
The objective of this game is to squeeze the bottle to fill up the bin at the bottom of the screen.

00:02:06.000 --> 00:02:09.000
Squeeze the bottle as many times as you can while still feeling comfortable.

00:02:10.000 --> 00:02:19.000
If you feel extreme pain or discomfort at any point, please stop playing and contact your healthcare provider.
</script>


<!-- **********************************************
     ********** WINDSHIELD GAME SUBTITLES **********
     ********************************************** -->
<script id="subtitles-windshield" type="text/vtt">
WEBVTT - MoTrack Therapy Windshield Game Subtitles, March 12, 2019

00:00:00.000 --> 00:00:08.000
As you get ready to play, follow these steps to have the best experience possible.

00:00:09.000 --> 00:00:14.000
1. Place your phone down on a flat surface, with the screen facing up.

00:00:15.000 --> 00:00:19.000
2. Make sure there are no lights directly overhead.

00:00:20.000 --> 00:00:22.000
This makes it difficult for the camera to focus on your hand).

00:00:23.000 --> 00:00:25.000
3. Make sure your sound is on.

00:00:26.000 --> 00:00:30.000
The different sounds will let you know when different things are happening in the games.

00:00:32.000 --> 00:00:36.000
4. When you’re ready, the phone will automatically begin to count down from 5,

00:00:37.000 --> 00:00:43.000
giving you 5 seconds to remove any moving body parts (like your head and your hands) out of view of the camera.

00:00:44.000 --> 00:00:48.000
During and after the countdown, refrain from moving your phone again.

00:00:49.000 --> 00:00:53.000
5. When the countdown gets to 0, you will see the screen change.

00:00:54.000 --> 00:00:59.000
When this happens, you can move your hand back into the frame (but try to keep out any other body parts).

00:01:00.000 --> 00:01:04.000
Try to make sure your hand is roughly the same size as the hand that appears on the screen.

00:01:06.000 --> 00:01:10.000
6. The screen will change one more time, bringing you to the game.

00:01:11.000 --> 00:01:13.000
You can begin completing your exercises.

00:01:14.000 --> 00:01:20.000
7. If the background begins to look funny, like this--

00:01:21.000 --> 00:01:24.000
hit the reset button, which will bring you back to the countdown, and you can try again.

00:01:25.000 --> 00:01:33.000
Once everything seems to be working and you’re ready to play, look for blue arrows that will instruct you where to move first.

00:01:34.000 --> 00:01:37.000
As you begin completing the radial/ulnar deviation exercises,

00:01:38.000 --> 00:01:43.000
make sure you keep your four fingers together with your thumb out for best results.

00:01:44.000 --> 00:01:49.000
There will be text at the top of the screen that will instruct you to hold your current position (which should appear in green),

00:01:50.000 --> 00:01:55.000
or instruct you to move to the next position, “readjust” (which should appear in red).

00:01:56.000 --> 00:02:02.000
The objective of this game is to wipe the car windshield as many times as you can while still feeling comfortable.

00:02:03.000 --> 00:02:15.000
If you feel extreme pain or discomfort at any point, please stop playing and contact your healthcare provider.
</script>


<!-- **********************************************
     ************* CLIFF GAME SUBTITLES ***********
     ********************************************** -->
<script id="subtitles-cliff" type="text/vtt">
WEBVTT - MoTrack Therapy Cliff Game Subtitles, March 13, 2019

00:00:00.000 --> 00:00:08.000
As you get ready to play, follow these steps to have the best experience possible.

00:00:09.000 --> 00:00:14.000
1. Place your phone down on a flat surface, with the screen facing up.

00:00:15.000 --> 00:00:19.000
2. Make sure there are no lights directly overhead.

00:00:20.000 --> 00:00:22.000
This makes it difficult for the camera to focus on your hand).

00:00:23.000 --> 00:00:25.000
3. Make sure your sound is on.

00:00:26.000 --> 00:00:30.000
The different sounds will let you know when different things are happening in the games.

00:00:32.000 --> 00:00:36.000
4. When you’re ready, the phone will automatically begin to count down from 5,

00:00:37.000 --> 00:00:43.000
giving you 5 seconds to remove any moving body parts (like your head and your hands) out of view of the camera.

00:00:44.000 --> 00:00:48.000
During and after the countdown, refrain from moving your phone again.

00:00:49.000 --> 00:00:53.000
5. When the countdown gets to 0, you will see the screen change.

00:00:54.000 --> 00:00:59.000
When this happens, you can move your hand back into the frame (but try to keep out any other body parts).

00:01:00.000 --> 00:01:04.000
Try to make sure your hand is roughly the same size as the hand that appears on the screen.

00:01:06.000 --> 00:01:10.000
6. The screen will change one more time, bringing you to the game.

00:01:11.000 --> 00:01:13.000
You can begin completing your exercises.

00:01:14.000 --> 00:01:20.000
7. If the background begins to look funny, like this--

00:01:21.000 --> 00:01:27.000
hit the reset button, which will bring you back to the countdown, and you can try again.

00:01:28.000 --> 00:01:31.000
Once everything seems to be working and you’re ready to play

00:01:32.000 --> 00:01:38.000
begin performing the correct exercise at your own pacein this case, radial/ulnar deviation.

00:01:39.000 --> 00:01:43.000
Make sure you keep your four fingers together with your thumb out for best results.

00:01:44.000 --> 00:01:47.000
Soon, you will see cracks begin to form in the cliff.

00:01:48.000 --> 00:01:55.000
The objective of the game is to mine the cliff for as much gold as possible before the cliff cracks too much and collapses.

00:01:56.000 --> 00:02:00.000
If the cliff does collapse, you will not be awarded any points.

00:02:01.000 --> 00:02:06.000
When you have mined the cliff as much as you think you can, remove your hand from the screen.

00:02:07.000 --> 00:02:09.000
You will see the gold you mined appear.

00:02:10.000 --> 00:02:12.000
You will earn more points if you collect more gold.

00:02:13.000 --> 00:02:17.000
Take your time and don’t strain yourself to the point of discomfort.

00:02:18.000 --> 00:02:25.000
If you do feel extreme pain or discomfort at any point, please stop playing and contact your healthcare provider.
</script>


<!-- **********************************************
     ************** DIAL GAME SUBTITLES ***********
     ********************************************** -->
<script id="subtitles-dial" type="text/vtt">
WEBVTT - MoTrack Therapy Dial Game Subtitles, March 17, 2019

00:00:00.000 --> 00:00:08.000
As you get ready to play, follow these steps to have the best experience possible.

00:00:09.000 --> 00:00:14.000
1. Place your phone down on a flat surface, with the screen facing up.

00:00:15.000 --> 00:00:19.000
2. Make sure there are no lights directly overhead.

00:00:20.000 --> 00:00:22.000
This makes it difficult for the camera to focus on your hand).

00:00:23.000 --> 00:00:25.000
3. Make sure your sound is on.

00:00:26.000 --> 00:00:30.000
The different sounds will let you know when different things are happening in the games.

00:00:32.000 --> 00:00:36.000
4. When you’re ready, the phone will automatically begin to count down from 5,

00:00:37.000 --> 00:00:43.000
giving you 5 seconds to remove any moving body parts (like your head and your hands) out of view of the camera.

00:00:44.000 --> 00:00:48.000
During and after the countdown, refrain from moving your phone again.

00:00:49.000 --> 00:00:53.000
5. When the countdown gets to 0, you will see the screen change.

00:00:54.000 --> 00:00:59.000
When this happens, you can move your hand back into the frame (but try to keep out any other body parts).

00:01:00.000 --> 00:01:04.000
Try to make sure your hand is roughly the same size as the hand that appears on the screen.

00:01:06.000 --> 00:01:10.000
6. The screen will change one more time, bringing you to the game.

00:01:11.000 --> 00:01:13.000
You can begin completing your exercises.

00:01:14.000 --> 00:01:20.000
7. If the background begins to look funny, like this--

00:01:21.000 --> 00:01:27.000
hit the reset button, which will bring you back to the countdown, and you can try again.

00:01:28.000 --> 00:01:35.000
Once everything seems to be working and you’re ready to play, begin completing the pronation/supination exercises.

00:01:36.000 --> 00:01:41.000
Make sure you keep your four fingers together with your thumb out for best results.

00:01:42.000 --> 00:01:47.000
For this game, you may need to position your hand a little higher above the screen than normal.

00:01:48.000 --> 00:01:54.000
If the camera doesn’t seem to be tracking your movements, try moving your hand a little higher up.

00:01:55.000 --> 00:02:01.000
There will be text at the top of the screen that will instruct you to hold your current position (which should appear in green),

00:02:02.000 --> 00:02:07.000
or instruct you to move to the next position, “readjust” (which should appear in red).

00:02:08.000 --> 00:02:14.000
The objective of this game is to turn the dial as many times as you can while still feeling comfortable.

00:02:15.000 --> 00:02:24.000
If you feel extreme pain or discomfort at any point, please stop playing and contact your healthcare provider.
</script>


<!-- **********************************************
     ************** DIAL GAME SUBTITLES ***********
     ********************************************** -->
<script id="subtitles-peacock" type="text/vtt">
WEBVTT - MoTrack Therapy Peacock Spread Subtitles, March 25, 2019

00:00:00.000 --> 00:00:08.000
As you get ready to play, follow these steps to have the best experience possible.

00:00:09.000 --> 00:00:14.000
1. Place your phone down on a flat surface, with the screen facing up.

00:00:15.000 --> 00:00:19.000
2. Make sure there are no lights directly overhead.

00:00:20.000 --> 00:00:22.000
This makes it difficult for the camera to focus on your hand).

00:00:23.000 --> 00:00:25.000
3. Make sure your sound is on.

00:00:26.000 --> 00:00:30.000
The different sounds will let you know when different things are happening in the games.

00:00:32.000 --> 00:00:36.000
4. When you’re ready, the phone will automatically begin to count down from 5,

00:00:37.000 --> 00:00:43.000
giving you 5 seconds to remove any moving body parts (like your head and your hands) out of view of the camera.

00:00:44.000 --> 00:00:48.000
During and after the countdown, refrain from moving your phone again.

00:00:49.000 --> 00:00:53.000
5. When the countdown gets to 0, you will see the screen change.

00:00:54.000 --> 00:00:59.000
When this happens, you can move your hand back into the frame (but try to keep out any other body parts).

00:01:00.000 --> 00:01:04.000
Try to make sure your hand is roughly the same size as the hand that appears on the screen.

00:01:06.000 --> 00:01:10.000
6. The screen will change one more time, bringing you to the game.

00:01:11.000 --> 00:01:13.000
You can begin completing your exercises.

00:01:14.000 --> 00:01:20.000
7. If the background begins to look funny, like this--

00:01:21.000 --> 00:01:27.000
hit the reset button, which will bring you back to the countdown, and you can try again.

00:01:28.000 --> 00:01:34.000
Once everything seems to be working and you’re ready to play, begin completing the adduction/abduction exercises.

00:01:35.000 --> 00:01:39.000
Make sure your thumb is either out as far as possible, or, alternatively,

00:01:40.000 --> 00:01:42.000
it is folded over the palm of your hand.

00:01:43.000 --> 00:01:49.000
There will be text at the top of the screen that will instruct you to hold your current position (which should appear in green),

00:01:50.000 --> 00:01:55.000
or instruct you to move to the next position, “readjust” (which should appear in red).

00:01:56.000 --> 00:02:03.000
The objective of this game is to help the peacock spread out its feathers as many times as you can while still feeling comfortable.

00:02:04.000 --> 00:02:17.000
If you feel extreme pain or discomfort at any point, please stop playing and contact your healthcare provider.

</script>


  <!-- ============================================================= -->
  <!--                     MAIN SCREENS                    -->
  <!-- ============================================================= -->

  <div data-role="page" id="homescreen" data-theme="c">
    <div data-role="header" class="header-bar"> Home </div>


    <div data-role="popup" id="signin-info-popup" data-theme="d" style="font-size: 18px;" > <!-- Add data-overlay-theme="b" to add shading to back part-->
      <img src="Dropbox/ui_media/main_images/reminderspopup.png" alt="Logo" style="width: 100%; ">
      <!--
      <h1> Welcome! </h1>
      <p> Before you begin, we just have a few reminders to make your experience as fun as possible</p>
      <ul>
        <li>
          <p style="text-align: left">Allow MoTrack access to your camera </p>
        </li>
      </ul>
      <div style="text-align: center">
        <img src="Dropbox/ui_media/main_images/singleletterlogo.png" alt="Logo" style="width: 50px; height: 50px; ">
      </div>

      <ul>
        <li>
          <p>Turn on your device's sound</p>
        </li>
      </ul>
      <div style="text-align: center">
        <img src="Dropbox/ui_media/main_images/singleletterlogo.png" alt="Logo" style="width: 50px; height: 50px; ">
      </div>

      <ul>
        <li>
          <p> Take your time and take a break if your hand hurts </p>
        </li>
      </ul>
      <div style="text-align: center; margin-top:0px; ">
        <img src="Dropbox/ui_media/main_images/singleletterlogo.png" alt="Logo" style="width: 50px; height: 50px; margin-top:0px;">
      </div>
      !-->
    </div>

    <div class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
      <!-- 38.75% was the maximum height to fit exactly into one page without scrolling as of Dec 24, 2018 -->
      <img src="Dropbox/ui_media/main_images/medicalprofessional.png" alt="Logo" style="width: 38.75%">
      <h3>Welcome back to <span style="color:#30ABDF;">MoTrack Therapy</span>, <span class="display-name-holder">[Name]</span>!</h3>
      <p> Let's get you started! </p>

       <!-- <video width="100%" controls volume=0 poster="Dropbox/ui_media/games/tutorialvideoplaceholder.png">
        <source src="testvideo.mov" type="video/mp4">
        <track src="http://motracktherapy.com/testsubtitles.vtt" default kind="captions" srclang="en"/>
        Sorry, your browser doesn't support embedded videos.
      </video> -->

      <form>
        <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
          <img src="Dropbox/ui_media/main_images/hands.png" alt="Hand Exercises" class="button-icon" style="height: 10%;">
          <p class="button-title"> Exercises </p>
          <p class="button-explanation"> Get started with some exercises! </p>
          <input type="button" data-enhanced="true" value="Exercises" id="exercises-type-button">
        </div>

        <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
             <img src="Dropbox/ui_media/main_images/chart.png" alt="Progress Chart" class="button-icon" style="height: 10%;">
             <p class="button-title">       Progress                            </p>
             <p class="button-explanation"> Check your weekly progress!         </p>
             <input type="button" data-enhanced="true" value="Progress" id="open-progress-area-button">
         </div>


        <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 0px; padding-bottom: 0px; /*default is 17 top and bottom padding*/">
          <p> Settings </p>
          <input type="button" data-enhanced="true" value="Settings" id="homescreen-settings-button">
        </div>



        <!--
        <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
          <img src="Dropbox/ui_media/main_images/questionmark.png" alt="Question Mark" class="button-icon" style="height: 10%;">
          <p class="button-title"> FAQs </p>
          <p class="button-explanation"> Learn the ins and outs of the app! </p>
          <input type="button" data-enhanced="true" value="Tutorial" id="tutorial-button">
        </div> -->


        <!-- instructions from: https://www.typeform.com/help/embed-a-typeform/ -->
        <a class="ui-input-btn ui-btn ui-corner-all ui-shadow typeform-share" href="https://anitalouie.typeform.com/to/WYPYYT" style="padding-top: 25px; padding-bottom: 25px;" data-mode="popup" data-hide-headers=true data-hide-footer=true data-submit-close-delay="0" target="_blank">Feedback Survey
        </a>
        <script>
          (function() { var qs,js,q,s,d=document, gi=d.getElementById, ce=d.createElement, gt=d.getElementsByTagName, id="typef_orm_share", b="https://embed.typeform.com/"; if(!gi.call(d,id)){ js=ce.call(d,"script"); js.id=id; js.src=b+"embed.js"; q=gt.call(d,"script")[0]; q.parentNode.insertBefore(js,q) } })()
        </script>

        <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 0px; padding-bottom: 0px; /*default is 17 top and bottom padding*/">
          <!-- <img src="Dropbox/ui_media/main_images/signout.png" alt="Arrow" class="button-icon" style="height: 6%;">
          <p class="button-title"> Log out </p> -->
          <p> Log out </p>
          <input type="button" data-enhanced="true" value="Sign out" id="logout-button">
        </div>
      </form>
    </div> <!-- main -->

    <script type="text/javascript">
      //Learned to loop using this link: https://stackoverflow.com/questions/6516297/can-mustache-iterate-a-top-level-array
      $("#exercises-type-button").click(function() {
        playClickSound();
        navigateTo("#exercisetypescreen")
      });
      $("#open-progress-area-button").click(function() {
        playClickSound();
        navigateTo("#progress-screen-main")
      });

      $("#homescreen-settings-button").click(function() {
        playClickSound();
        navigateTo("#settingsscreen-main")
      });
      /*
      $("#tutorial-button").click(function() {
        playClickSound();
        navigateTo("#tutorial-main")
      }); */
      $("#logout-button").click(function() {
        playClickSound();
        // Sign out
        signOutAndGoToLoginScreen();
      });

      function signOutAndGoToLoginScreen() {
        firebase.auth().signOut().then(function() {
          // Sign-out successful.
          console.log("Signed out");
        }).catch(function(error) {
          // An error happened.
        });
      }
    </script>
  </div> <!-- home screen page -->



  <div data-role="page" id="settingsscreen-main" data-theme="c">
    <div data-role="header" class="header-bar-force-with-home"> Exercise types </div>

    <div class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
      <!-- 38.75% was the maximum height to fit exactly into one page without scrolling as of Dec 24, 2018 -->
      <img src="Dropbox/ui_media/main_images/medicalprofessional.png" alt="Logo" style="width: 38.75%">
      <p> Customize your settings to exactly fit you! </p>

      <form>

        <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
          <p> Exercise Options </p>
          <input type="button" data-enhanced="true" value="Exercise Options" id="exercise-settings-button">
        </div>

        <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
          <p> Account Options </p>
          <input type="button" data-enhanced="true" value="Account Options" id="account-settings-button">
        </div>

        <div class="ui-input-btn ui-btn ui-corner-all ui-shadow ui-disabled" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
          <p> General App Options </p>
          <input type="button" data-enhanced="true" value="Exercise Options" id="general-app-settings-button">
        </div>

      </form>

    </div> <!-- main -->

    <script type="text/javascript">
      $("#exercise-settings-button").click(function() {
        playClickSound();
        navigateTo("#exercise-settings")
      });
      $("#general-app-settings-button").click(function() {
        playClickSound();
        navigateTo("#general-app-settings")
      });
      $("#account-settings-button").click(function() {
        playClickSound();
        navigateTo("#account-settings")
      });
    </script>
  </div> <!-- exercise type page -->


  <div data-role="page" id="general-app-settings" data-theme="c">
    <div data-role="header" class="header-bar"> General All Options </div>
    <div class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">

      <!-- 38.75% was the maximum height to fit exactly into one page without scrolling as of Dec 24, 2018 -->
      <img src="Dropbox/ui_media/main_images/medicalprofessional.png" alt="Logo" style="width: 38.75%">
      <p> Customize your settings to exactly fit you! </p>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
        <p> Back to General Settings </p>
        <input type="button" data-enhanced="true" value="Account Options" id="back-from-general-app-settings-button">
      </div>


    </div> <!-- main -->

    <script type="text/javascript">
      $("#back-from-general-app-settings-button").click(function() {
        playClickSound();
        navigateTo("#settingsscreen-main")
      });
    </script>
  </div> <!-- general app settings page -->


  <div data-role="page" id="account-settings" data-theme="c">
    <div data-role="header" class="header-bar"> Account Options </div>
    <div class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">


      <div style="padding-left: 20%; padding-right: 20%;">
      <div class='ui-field-contain'>
        <label for='access-code-settings-btn'> MoTrack Access Code </label>
        <input type='text' class='access-code-settings-btns' readonly="readonly" value="N/A"><!-- checked -->
      </div>


      <div class='ui-field-contain'>
        <label for='qrcode'> Share the app by scanning or tapping below</label>
        <a href="https://www.motracktherapy.com/download-motrack/" target="external">
          <img id='qrcode' src="Dropbox/ui_media/main_images/qrcode.png"  alt="QR Code" style="width: 100%" />
        </a>
      </div>

      </div>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
        <p> Back to General Settings </p>
        <input type="button" data-enhanced="true" value="Account Options" id="back-from-account-settings-button">
      </div>


    </div> <!-- main -->

    <script type="text/javascript">
      $("#back-from-account-settings-button").click(function() {
        playClickSound();
        navigateTo("#settingsscreen-main")
      });
    </script>
  </div> <!-- account settings page -->


  <div data-role="page" id="exercise-settings" data-theme="c">
    <div data-role="header" class="header-bar"> Exercise types </div>
    <div class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">

      <!-- 38.75% was the maximum height to fit exactly into one page without scrolling as of Dec 24, 2018 -->
      <img src="Dropbox/ui_media/main_images/medicalprofessional.png" alt="Logo" style="width: 38.75%">
      <p> Customize your settings to exactly fit you! </p>

          <!--
          <ul data-role="listview" data-filter="true" data-filter-theme="a" data-filter-placeholder="Search exercises..." data-divider-theme="b" data-split-icon="info" data-split-theme="a">
              <li>
                <a href="index.html">
                  <img src="Dropbox/ui_media/exercise_arrows/flexion_arrows.png">
                  <h3>Pronation/Supination</h3>
                  <p>Rotating the wrist</p>
                </a>
                <a href="index.html" data-rel="dialog" data-transition="slideup">Purchase album
                </a>
              </li>
              <li>
                <a href="index.html">
                  <img src="Dropbox/ui_media/exercise_arrows/flexion_arrows.png">
                  <h3>Wrist Flexion/Extension</h3>
                  <p>Flexing the fist up and down</p>
                </a>
                <a href="index.html" data-rel="dialog" data-transition="slideup">Purchase album
                </a>
              </li>
              <li>
                <a href="index.html">
                  <img src="Dropbox/ui_media/exercise_arrows/exercise_gifs/abduction_arrows.gif">
                  <h3>Finger Abduction</h3>
                  <p>Spread and close four fingers</p>
                  </a>
                <a href="index.html" data-rel="dialog" data-transition="slideup">Purchase album
                </a>
              </li>
          </ul> -->

          <!--
          <ul data-role="listview" data-inset="true">
              <li><a href="#">Acura</a></li>
              <li><a href="#">Audi</a></li>
              <li><a href="#">BMW</a></li>
              <li><a href="#">Cadillac</a></li>
              <li><a href="#">Ferrari</a></li>
          </ul> -->

          <script id="exerciselistforsettings_template" type="text/html">
            <ul data-role="listview" data-inset="true" data-filter="true" data-filter-placeholder="Search exercises" data-count-theme="b">
            {{#.}}
              {{^is_always_disabled}}
                {{#enabled}}
                  <li data-icon="edit" data-exercise-enabled=true data-filtertext="{{short_exercise_name_lc}}: enabled">
                    <a href="#" id="enable-{{short_exercise_name_lc}}-settings-btn" class=="enable-exercise-settings-btns">
                      {{short_exercise_name_lc}}
                      <span class="ui-li-count">{{repsToDo}}</span>
                    </a>
                    <a id="expand-{{short_exercise_name_lc}}-settings-btn">Edit</a>
                  </li>
                  <li data-exercise-enabled=true style="display: none" id="expandable-{{short_exercise_name_lc}}-settings-area">
                    <label for="slider-fill">Reps per day</label>
                    <input type="range" name="slider-fill" id="repsToDo-{{short_exercise_name_lc}}-fill" value="{{repsToDo}}" min="2" max="150" step="2" data-highlight="true">
                    <fieldset class="ui-grid-a">
                      <div class="ui-block-a"><button class="ui-btn ui-corner-all ui-btn-a delete-exercise-btn">Delete</button></div>
                      <div class="ui-block-b"><button class="ui-btn ui-corner-all ui-btn-a save-exercise-btn">Save</button></div>
                    </fieldset>
                  </li>
                {{/enabled}}
                {{^enabled}}
                  <li data-icon="plus" data-exercise-enabled=false data-filtertext="{{short_exercise_name_lc}}: disabled">
                    <a href="#" id="enable-{{short_exercise_name_lc}}-settings-btn" class=="enable-exercise-settings-btns" style="background-color: #A8A8A8">
                      {{short_exercise_name_lc}}
                    </a>
                  </li>
                {{/enabled}}
              {{/is_always_disabled}}
            {{/.}}
            </ul>
          </script>

          <div id="exerciselistforsettings_optionholder">
            <!-- Buttons from the template will go here -->
          </div>


      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
        <p> Back to General Settings </p>
        <input type="button" data-enhanced="true" value="Account Options" id="back-from-exercise-settings-button">
      </div>

    </div> <!-- main -->


    <script type="text/javascript">
    //NOTE: Listeners for when an enable-{{short_exercise_name_lc}}-settings-btn is clicked
    //can't be here because those buttons are not loaded yet
    $("#back-from-exercise-settings-button").click(function() {
      playClickSound();
      navigateTo("#settingsscreen-main")
    });
    </script>
  </div> <!-- exercise settings page -->




  <div data-role="page" id="exercisetypescreen" data-theme="c">

    <div data-role="header" class="header-bar"> Exercise types </div>

    <div class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
      <!-- 38.75% was the maximum height to fit exactly into one page without scrolling as of Dec 24, 2018 -->
      <img src="Dropbox/ui_media/main_images/medicalprofessional.png" alt="Logo" style="width: 38.75%">
      <p> Let's see what we should work on today! </p>

      <div data-role="popup" id="reminderspopup" data-dismissible="true" style="background-color: rgba(255,255,255,0.8); border: 0px solid black; font-size: 18px;  text-align: center; margin: 50px; padding: 10px"> <!-- Add data-overlay-theme="b" to add shading to back part-->
        <img src="Dropbox/ui_media/main_images/reminderspopup.png" alt="Logo" style="width: 100%; " />
        <a href="#" class="ui-btn ui-corner-all ui-shadow" style="margin-left: 50px; margin-right: 50px" data-rel="back"> Got it!</a>
      </div>

      <form>

        <script id="exercisetypescreen_template" type="text/html">
          {{#.}}
            <div id="{{short_exercise_name_lc}}-exercise" style="text-shadow: none; /* prevent blurryness from the color shading */">
              <div class="ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn button-with-progress-bar" style="background-color: {{background_color}}; background-image: linear-gradient(to right, {{background_color}} 10%, #000 10.01%, #000 10.29%, #30ABDF 10.3%); border: 1px solid black;">
                <p class="button-title">            {{descriptive_short_exercise_name}}             </p>
                <p class="button-explanation">      {{background_color_name}} Set             </p>
                <input type="button" data-enhanced="true" value="{{short_exercise_name_lc}}" id="all-{{short_exercise_name_lc}}-exercises-button">
              </div>
              <div class="progress-bar-holder">
                <div class="progress-bar">
                  <div class="progress-bar-filler" id="{{short_exercise_name_lc}}-progress-bar-filler"></div>
                </div>
              </div>
            </div>
          {{/.}}
        </script>

        <div id="exercisetypescreen_optionholder">
          <!-- Buttons from the template will go here -->
        </div>

        <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
          <!-- <img src="Dropbox/ui_media/main_images/signout.png" alt="Arrow" class="button-icon" style="height: 6%;">
          <p class="button-title"> Back </p> -->
          <p> Back to Home </p>
          <input type="button" data-enhanced="true" value="Sign out" id="exercise-type-back-button">
        </div>

      </form>

    </div> <!-- main -->

    <script type="text/javascript">
      $("#exercise-type-back-button").click(function() {
        playClickSound();
        navigateTo("#homescreen");
        //window.location = "#homescreen";
      });

      //popup opened in the $(document).on("pagecontainershow", ...) method

    </script>
  </div> <!-- exercise type page -->


  <!-- ===================== -->
  <!-- EXERCISE TYPE SCREENS -->
  <!-- ===================== -->

  <!-- THIS CODE IS FROM WHEN I TRIED TO MAKE THE EXERCISE/GAME SCREENS AUTOMATIC
  <div id="eachexercisescreen">
  </div>

  <script id="eachexercisescreen_template" type="text/html">
    {{#.}}
    <div data-role="page" class="gamelistscreen" id="gamelistscreen-{{short_exercise_name_lc}}" data-theme="d">
      <div data-role="header" class="header-bar"> {{short_exercise_name_lc}} Games </div>
      <div data-role="header" class="header-bar2"> <h1 class="header-text">  </h1> </div>

      <div data-role="main" class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
        <img alt="Instructions" class="gamelistscreen-exercise-instructions hand-flippable">

        <div class='ui-field-contain which-hand-gif-field-contain'>
          <select id='hand-select-{{short_exercise_name_lc}}' class='hand-select-option' name='hand-select' data-role='flipswitch' >
            <option selected='' value='r'>right</option>
            <option value='l'>left</option>
          </select>
          <label for='hand-select-{{short_exercise_name_lc}}'> hand </label>
        </div>

        <p class="try-this-exercise-out-text">Try this exercise out with some games </p>

        <div class="ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn-v2 plain-game-button-holder">
          <img src="Dropbox/ui_media/main_images/questionmark.png" alt="Question Mark">
          <br /> Basic {{short_exercise_name_lc}}
          <input type="button" data-enhanced="true" value="{{short_exercise_name_lc}} plain" id="{{short_exercise_name_lc}}-plain-button">
        </div>

      </div>
    </div>
    {{/.}}
  </script> -->

  <!--
  <div data-role="page" class="gamelistscreen" id="gamelistscreen-fist" data-theme="d"> </div>
  <div data-role="page" class="gamelistscreen" id="gamelistscreen-deviation" data-theme="d"> </div>
  <div data-role="page" class="gamelistscreen" id="gamelistscreen-pronation" data-theme="d"> </div>
  <div data-role="page" class="gamelistscreen" id="gamelistscreen-flexion" data-theme="d"> </div>

  <script id="eachexercisescreen_template2" type="text/html">
    <div data-role="page" class="gamelistscreen" id="gamelistscreen-{{short_exercise_name_lc}}" data-theme="d">
      <div data-role="header" class="header-bar"> {{short_exercise_name_lc}} Games </div>
      <div data-role="header" class="header-bar2"> <h1 class="header-text">  </h1> </div>

      <div data-role="main" class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
        <img alt="Instructions" class="gamelistscreen-exercise-instructions hand-flippable">

        <div class='ui-field-contain which-hand-gif-field-contain'>
          <select id='hand-select-{{short_exercise_name_lc}}' class='hand-select-option' name='hand-select' data-role='flipswitch' >
            <option selected='' value='r'>right</option>
            <option value='l'>left</option>
          </select>
          <label for='hand-select-{{short_exercise_name_lc}}'> hand </label>
        </div>

        <p class="try-this-exercise-out-text">Try this exercise out with some games </p>

        <div class="ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn-v2 plain-game-button-holder">
          <img src="Dropbox/ui_media/main_images/questionmark.png" alt="Question Mark">
          <br /> Basic {{short_exercise_name_lc}}
          <input type="button" data-enhanced="true" value="{{short_exercise_name_lc}} plain" id="{{short_exercise_name_lc}}-plain-button">
        </div>

      </div>
  </script> -->

  <div data-role="page" class="gamelistscreen" id="gamelistscreen-flexion" data-theme="d">
    <div data-role="header" class="header-bar"> Flexion Games </div>
    <div data-role="header" class="header-bar2"> <h1 class="header-text">  </h1> </div>

    <div data-role="main" class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
      <img alt="Instructions" class="gamelistscreen-exercise-instructions hand-flippable">

      <div class='ui-field-contain which-hand-gif-field-contain'>
        <select id='hand-select-flexion' class='hand-select-option' name='hand-select' data-role='flipswitch' >
          <option value='r'>right</option>
          <option value='l'>left</option>
        </select>
        <label for='hand-select-flexion'> hand </label>
      </div>

      <p class="try-this-exercise-out-text">Try this exercise out with some games </p>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn-v2">
        <img src="Dropbox/ui_media/games/cliff/clifficon.png" alt="Cliff" class="hand-flippable">
        <br /> Cliff Game
        <input type="button" data-enhanced="true" value="Flexion-Extension" id="flexion-cliff-mine-button">
      </div>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn-v2">
        <img src="Dropbox/ui_media/games/knock/knockicon.png" alt="Door">
        <br /> Knock Game
        <input type="button" data-enhanced="true" value="Flexion-Extension" id="flexion-door-knock-button">
      </div>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn-v2 plain-game-button-holder">
        <img src="Dropbox/ui_media/main_images/questionmark.png" alt="Question Mark">
        <br /> Basic Flexion
        <input type="button" data-enhanced="true" value="Flex Exten Knock" id="flexion-plain-button">
      </div>

    </div> <!-- main -->

    <script type="text/javascript">
      $("#flexion-door-knock-button").click(function() {
        playClickSound();
        navigateTo("#flexion-knock-game");
      });
      $("#flexion-cliff-mine-button").click(function() {
        playClickSound();
        navigateTo("#flexion-cliff-game");
      });
      $("#flexion-plain-button").click(function() {
        playClickSound();
        startGame(FLEXION_PLAIN_GAME, getWhichHandIntended("flexion"), 5);
      });
    </script>
  </div> <!-- game list page - flexion -->


  <div data-role="page" class="gamelistscreen" id="gamelistscreen-fist" data-theme="d">
    <div data-role="header" class="header-bar"> Fist Games </div>
    <div data-role="header" class="header-bar2"> <h1 class="header-text">  </h1> </div>

    <div data-role="main" class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
      <img alt="Instructions" class="gamelistscreen-exercise-instructions hand-flippable">

      <div class='ui-field-contain which-hand-gif-field-contain'>
        <select id='hand-select-fist' class='hand-select-option' name='hand-select' data-role='flipswitch'>
          <option value='r'>right</option>
          <option value='l'>left</option>
        </select>
        <label for='hand-select-fist'> hand </label>
      </div>

      <p class="try-this-exercise-out-text">Try this exercise out with some games </p>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn-v2">
        <img src="Dropbox/ui_media/games/balloon/balloonicon.png" alt="Balloon">
        <br /> Pump Balloon
        <input type="button" data-enhanced="true" value="Balloon Pop" id="fist-balloon-pump-button">
      </div>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn-v2">
        <img src="Dropbox/ui_media/games/squeeze/squeezebottleicon.png" alt="Bottle" class="hand-flippable">
        <br /> Squeeze Bottle
        <input type="button" data-enhanced="true" value="Squeeze Bottle" id="fist-bottle-squeeze-button">
      </div>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn-v2 plain-game-button-holder plain-game-button-holder">
        <img src="Dropbox/ui_media/main_images/questionmark.png" alt="Question Mark">
        <br /> Basic Fist
        <input type="button" data-enhanced="true" value="Fist" id="fist-plain-button">
      </div>
    </div> <!-- main -->

    <script type="text/javascript">
      $("#fist-bottle-squeeze-button").click(function() {
        playClickSound();
        navigateTo("#fist-squeeze-game");
        //window.location = "#fist-squeeze-game";
      });
      $("#fist-balloon-pump-button").click(function() {
        playClickSound();
        navigateTo("#pump-balloon-game");
      });
      $("#fist-plain-button").click(function() {
        playClickSound();
        startGame(FIST_PLAIN_GAME, getWhichHandIntended("fist"), 5);
      });
    </script>
  </div> <!-- game list page - fist -->

  <div data-role="page" class="gamelistscreen" id="gamelistscreen-hook-fist" data-theme="d">
    <div data-role="header" class="header-bar"> Hook Fist Games </div>
    <div data-role="header" class="header-bar2"> <h1 class="header-text">  </h1> </div>

    <div data-role="main" class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
      <img alt="Instructions" class="gamelistscreen-exercise-instructions hand-flippable">

      <div class='ui-field-contain which-hand-gif-field-contain'>
        <select id='hand-select-hook-fist' class='hand-select-option' name='hand-select' data-role='flipswitch'>
          <option value='r'>right</option>
          <option value='l'>left</option>
        </select>
        <label for='hand-select-hook-fist'> hand </label>
      </div>

      <p class="try-this-exercise-out-text">Try this exercise out with some games </p>


      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn-v2 plain-game-button-holder plain-game-button-holder">
        <img src="Dropbox/ui_media/main_images/questionmark.png" alt="Question Mark">
        <br /> Basic Hook Fist
        <input type="button" data-enhanced="true" value="Hook Fist" id="hook-fist-plain-button">
      </div>
    </div> <!-- main -->

    <script type="text/javascript">
      $("#hook-fist-plain-button").click(function() {
        playClickSound();
        startGame(HOOK_FIST_PLAIN_GAME, getWhichHandIntended("hook-fist"), 5);
      });
    </script>
  </div> <!-- game list page - hook fist -->


  <div data-role="page" class="gamelistscreen" id="gamelistscreen-deviation" data-theme="d">
    <div data-role="header" class="header-bar"> Deviation Games </div>
    <div data-role="header" class="header-bar2"> <h1 class="header-text">  </h1> </div>

    <div data-role="main" class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
      <img alt="Instructions" class="gamelistscreen-exercise-instructions hand-flippable">

      <div class='ui-field-contain which-hand-gif-field-contain'>
        <select id='hand-select-deviation' class='hand-select-option' name='hand-select' data-role='flipswitch'>
          <option value='r'>right</option>
          <option value='l'>left</option>
        </select>
        <label for='hand-select-deviation'> hand </label>
      </div>

      <p class="try-this-exercise-out-text">Try this exercise out with some games </p>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn-v2">
        <img src="Dropbox/ui_media/games/catapult/catapulticon.png" alt="Question Mark" class="hand-flippable">
        <br /> Catapult Game
        <input type="button" data-enhanced="true" value="Radial-Ulnar Deviation" id="deviation-catapult-launch-button">
      </div>
      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn-v2">
        <img src="Dropbox/ui_media/games/windshield/windshieldicon.png" alt="Question Mark">
        <br /> Windshield Game
        <input type="button" data-enhanced="true" value="Radial-Ulnar Deviation" id="deviation-windshield-wipe-button">
      </div>
      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn-v2 plain-game-button-holder">
        <img src="Dropbox/ui_media/main_images/questionmark.png" alt="Question Mark">
        <br /> Basic Deviation
        <input type="button" data-enhanced="true" value="Radial-Ulnar Deviation" id="deviation-plain-button">
      </div>

    </div> <!-- main -->

    <script type="text/javascript">
      $("#deviation-windshield-wipe-button").click(function() {
        playClickSound();
        navigateTo("#deviation-windshield-game")
      });
      $("#deviation-catapult-launch-button").click(function() {
        playClickSound();
        navigateTo("#deviation-catapult-game")
      });
      $("#deviation-plain-button").click(function() {
        playClickSound();
        startGame(DEVIATION_PLAIN_GAME, getWhichHandIntended("deviation"), 5);
      });
    </script>
  </div> <!-- game list page - deviation -->


  <div data-role="page" class="gamelistscreen" id="gamelistscreen-pronation" data-theme="d">
    <div data-role="header" class="header-bar"> Pronation Games </div>
    <div data-role="header" class="header-bar2"> <h1 class="header-text">  </h1> </div>

    <div data-role="main" class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
      <img alt="Instructions" class="gamelistscreen-exercise-instructions hand-flippable">

      <div class='ui-field-contain which-hand-gif-field-contain'>
        <select id='hand-select-pronation' class='hand-select-option' name='hand-select' data-role='flipswitch'>
          <option value='r'>right</option>
          <option value='l'>left</option>
        </select>
        <label for='hand-select-pronation'> hand </label>
      </div>

      <p class="try-this-exercise-out-text">Try this exercise out with some games </p>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn-v2">
        <img src="Dropbox/ui_media/games/ketchup/ketchupicon.png" alt="Ketchup">
        <br /> Ketchup Game
        <input type="button" data-enhanced="true" value="Pronation-Supination" id="pronation-ketchup-shake-button">
      </div>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn-v2">
        <img src="Dropbox/ui_media/games/dial/dialicon.png" alt="Dial">
        <br /> Dial Game
        <input type="button" data-enhanced="true" value="Pronation-Supination" id="pronation-dial-turn-button">
      </div>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn-v2 plain-game-button-holder">
        <img src="Dropbox/ui_media/main_images/questionmark.png" alt="Question Mark">
        <br /> Basic Pronation
        <input type="button" data-enhanced="true" value="Pronation-Supination" id="pronation-plain-button">
      </div>

    </div> <!-- main -->

    <script type="text/javascript">
      $("#pronation-dial-turn-button").click(function() {
        playClickSound();
        navigateTo("#pronation-dial-game");
        //window.location = "#pronation-dial-game";
      });
      $("#pronation-ketchup-shake-button").click(function() {
        playClickSound();
        navigateTo("#pronation-ketchup-game");
      });
      $("#pronation-plain-button").click(function() {
        playClickSound();
        startGame(PRONATION_PLAIN_GAME, getWhichHandIntended("pronation"), 5);
        //window.location = "#pronation-dial-game";
      });
    </script>
  </div> <!-- game list page - pronation -->


  <div data-role="page" class="gamelistscreen" id="gamelistscreen-abduction" data-theme="d">
    <div data-role="header" class="header-bar"> Finger Abduction Games </div>
    <div data-role="header" class="header-bar2"> <h1 class="header-text">  </h1> </div>

    <div data-role="main" class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
      <img alt="Instructions" class="gamelistscreen-exercise-instructions hand-flippable">

      <div class='ui-field-contain which-hand-gif-field-contain'>
        <select id='hand-select-abduction' class='hand-select-option' name='hand-select' data-role='flipswitch'>
          <option value='r'>right</option>
          <option value='l'>left</option>
        </select>
        <label for='hand-select-abduction'> hand </label>
      </div>

      <p class="try-this-exercise-out-text">Try this exercise out with some games </p>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn-v2">
        <img src="Dropbox/ui_media/games/peacock/peacockicon.png" alt="Peacock" class="hand-flippable">
        <br /> Peacock Game
        <input type="button" data-enhanced="true" value="Flexion-Extension" id="abduction-peacock-fan-button">
      </div>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn-v2 plain-game-button-holder">
        <img src="Dropbox/ui_media/main_images/questionmark.png" alt="Question Mark">
        <br /> Basic Finger Abduction
        <input type="button" data-enhanced="true" value="Pronation-Supination" id="abduction-plain-button">
      </div>

    </div> <!-- main -->

    <script type="text/javascript">
      $("#abduction-peacock-fan-button").click(function() {
        playClickSound();
        navigateTo("#abduction-peacock-game");
        //window.location = "#pronation-dial-game";
      });
      $("#abduction-plain-button").click(function() {
        playClickSound();
        startGame(EXERCISE_GAME_ABDUCTION_PLAIN, getWhichHandIntended("abduction"), 5);
        //window.location = "#pronation-dial-game";
      });
    </script>
  </div> <!-- game list page - abduction -->


  <div data-role="page" class="gamelistscreen" id="gamelistscreen-opposition" data-theme="d">
    <div data-role="header" class="header-bar"> Thumb Opposition Games </div>
    <div data-role="header" class="header-bar2"> <h1 class="header-text">  </h1> </div>

    <div data-role="main" class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
      <img alt="Instructions" class="gamelistscreen-exercise-instructions hand-flippable">

      <div class='ui-field-contain which-hand-gif-field-contain'>
        <select id='hand-select-opposition' class='hand-select-option' name='hand-select' data-role='flipswitch'>
          <option value='r'>right</option>
          <option value='l'>left</option>
        </select>
        <label for='hand-select-opposition'> hand </label>
      </div>

      <p class="try-this-exercise-out-text">Try this exercise out with some games </p>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn-v2">
        <img src="Dropbox/ui_media/games/alligator/alligatoricon.png" alt="Alligator" class="hand-flippable">
        <br /> Alligator Game
        <input type="button" data-enhanced="true" value="Opposition" id="opposition-alligator-chomp-button">
      </div>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow two-layer-btn-v2 plain-game-button-holder">
        <img src="Dropbox/ui_media/main_images/questionmark.png" alt="Question Mark">
        <br /> Basic Thumb Opposition
        <input type="button" data-enhanced="true" value="Pronation-Supination" id="opposition-plain-button">
      </div>

    </div> <!-- main -->

    <script type="text/javascript">
      $("#opposition-alligator-chomp-button").click(function() {
        playClickSound();
        navigateTo("#opposition-alligator-game");
      });
      $("#opposition-plain-button").click(function() {
        playClickSound();
        startGame(EXERCISE_GAME_OPPOSITION_PLAIN, getWhichHandIntended("opposition"), 5);
        //window.location = "#pronation-dial-game";
      });
    </script>
  </div> <!-- game list page - thumb opposition -->



  <!-- ======================== -->
  <!-- GAME INSTRUCTION SCREENS -->
  <!-- ======================== -->
  <script type="text/javascript">
    $.each( exercises_map, function( index, exercise ) {
      //for pages of the class ".deviation-game-displayer" etc
      $(document).delegate('.' + exercise.short_exercise_name_lc + '-game-displayer', 'pagebeforeshow', function() {
        //Your code for each page load here
        var volRatio = getVolumeLevelRatio(); //returns double from 0 to 1 representing the % sound, or returns -1 if not available on this device
        if (volRatio != -1) {
          if (volRatio <= 2/15) {//on Android S9 and Note 8, non-ratio vol is increments of 1, between 0 and 15
            showAndroidToast("Make sure to turn on sound!", 1);
          }
        }
      });
    });
  </script>


  <div data-role="page" id="deviation-windshield-game" class="deviation-game-displayer" data-theme="d">
    <!-- "Instructions" but would be cut off in header-->
    <div data-role="header" class="header-bar"> Windshield Game </div>
    <div data-role="header" class="header-bar2"> <h1 class="header-text">  </h1> </div>

    <div data-role="main" class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
      <!-- Given what this image is, it doesn't really need flipping left to right (it doesn't really matter either way) -->
      <img src="Dropbox/ui_media/games/windshield/windshieldgame_instructionicon.png" alt="Windshield Game" class="hand-flippable" style="width: 75%">

      <!-- <div class="game-instructions-entry">
        <h3> Exercise: </h3>
        <p> Radial/Ulnar Deviation </p>
      </div> -->

      <div class="game-instructions-entry">
        <h3> Game Difficulty: </h3>
        <p> Advanced </p>
      </div>

      <div class="game-instructions-entry">
        <h3> Reps: </h3>
        <button id="rep-counter-2-decrementer" data-change-unit=2 data-inline="true" data-icon="arrow-d" data-iconpos="notext" data-mini="true"> Up </button>
        <p id="rep-counter-2" class="rep-count" data-inline="true"> 6 </p>
        <button id="rep-counter-2-incrementer" data-change-unit=2 data-inline="true" data-icon="arrow-u" data-iconpos="notext" data-mini="true"> Down </button>
      </div>

      <div class="game-instructions-entry">
        <h3> Phone Orientation: </h3>
        <p> Horizontal/Landscape </p>
      </div>

      <img src="Dropbox/ui_media/exercise_arrows/deviation_arrows.png" alt="Picture instructions" class="hand-flippable" style="width: 50%">

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
        <p class="game-play-or-tutorial-button-text"> Let's play </p>
        <input type="button" data-enhanced="true" value="StartGame" id="ulnar-radial-windshield-play-button">
      </div>

    </div> <!-- main -->

    <script type="text/javascript">
      $("#ulnar-radial-windshield-play-button").click(function() {
        playClickSound();
        var gameIndex = 2;
        var ntrtbc = parseInt($('#rep-counter-' + gameIndex).html(), 10);
        var nrtbc_each = ntrtbc / ($('#rep-counter-' + gameIndex + '-decrementer').data('change-unit') || 2); //default value is 2
        startGameAndSetGenericEnding(gameIndex, -1, nrtbc_each);
      });
    </script>
  </div> <!-- Windshield game precursor screen -->


  <div data-role="page" id="deviation-catapult-game" class="deviation-game-displayer" data-theme="d">
    <div data-role="header" class="header-bar"> Catapult Game </div>
    <div data-role="header" class="header-bar2"> <h1 class="header-text">  </h1> </div>

    <div data-role="main" class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
      <img src="Dropbox/ui_media/games/catapult/catapultgame_instructionicon.png" alt="Catapult Game" class="hand-flippable" style="width: 75%">

      <!-- <div class="game-instructions-entry">
        <h3> Exercise: </h3>
        <p> Radial/Ulnar Deviation </p>
      </div> -->

      <div class="game-instructions-entry">
        <h3> Game Difficulty: </h3>
        <p> Beginner </p>
      </div>

      <div class="game-instructions-entry">
        <h3> Reps: </h3>
        <button id="rep-counter-5-decrementer" data-change-unit=1 data-inline="true" data-icon="arrow-d" data-iconpos="notext" data-mini="true"> Up </button>
        <p id="rep-counter-5" class="rep-count" data-inline="true"> 4 </p>
        <button id="rep-counter-5-incrementer" data-change-unit=1 data-inline="true" data-icon="arrow-u" data-iconpos="notext" data-mini="true"> Down </button>
      </div>

      <div class="game-instructions-entry">
        <h3> Phone Orientation: </h3>
        <p> Horizontal/Landscape </p>
      </div>

      <img src="Dropbox/ui_media/exercise_arrows/deviation_arrows.png" alt="Picture instructions" class="hand-flippable" style="width: 50%">

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
        <p class="game-play-or-tutorial-button-text"> Let's play </p>
        <input type="button" data-enhanced="true" value="StartGame" id="ulnar-radial-catapult-play-button">
      </div>

    </div> <!-- main -->

    <script type="text/javascript">
      $("#ulnar-radial-catapult-play-button").click(function() {
        playClickSound();
        var gameIndex = 5;
        var ntrtbc = parseInt($('#rep-counter-' + gameIndex).html(), 10);
        var nrtbc_each = ntrtbc / ($('#rep-counter-' + gameIndex + '-decrementer').data('change-unit') || 2); //default value is 2
        startGameAndSetGenericEnding(gameIndex, -1, nrtbc_each);
      });
    </script>
  </div> <!-- Catapult game precursor screen -->


  <div data-role="page" id="flexion-knock-game" class="flexion-game-displayer" data-theme="d">
    <!-- "Instructions" but would be cut off in header -->
    <div data-role="header" class="header-bar"> Door Knock Game </div>
    <div data-role="header" class="header-bar2"> <h1 class="header-text"> </h1> </div>

    <div data-role="main" class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
      <img src="Dropbox/ui_media/games/knock/knockgame_instructionicon.png" alt="Door Knock Game" class="hand-flippable" style="width: 75%">

      <!-- <div class="game-instructions-entry">
        <h3> Exercise: </h3>
        <p> Palmar/Dorsiflexion </p>
      </div> -->
      <div class="game-instructions-entry">
        <h3> Game Difficulty: </h3>
        <p> Advanced </p>
      </div>

      <div class="game-instructions-entry">
        <h3> Reps: </h3>
        <button id="rep-counter-0-decrementer" data-change-unit=2 data-inline="true" data-icon="arrow-d" data-iconpos="notext" data-mini="true"> Up </button>
        <p id="rep-counter-0" class="rep-count" data-inline="true"> 6 </p>
        <button id="rep-counter-0-incrementer" data-change-unit=2 data-inline="true" data-icon="arrow-u" data-iconpos="notext" data-mini="true"> Down </button>
      </div>

      <div class="game-instructions-entry">
        <h3> Phone Orientation: </h3>
        <p> Horizontal/Landscape </p>
      </div>

      <img src="Dropbox/ui_media/exercise_arrows/flexion_arrows.png" alt="Picture instructions" class="hand-flippable" style="width: 50%">

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
        <p class="game-play-or-tutorial-button-text"> Let's play </p>
        <input type="button" data-enhanced="true" value="StartGame" id="flexion-knock-play-button">
      </div>

    </div> <!-- main -->

    <script type="text/javascript">
      $("#flexion-knock-play-button").click(function() {
        playClickSound();
        var gameIndex = 0;
        var ntrtbc = parseInt($('#rep-counter-' + gameIndex).html(), 10);
        var nrtbc_each = ntrtbc / ($('#rep-counter-' + gameIndex + '-decrementer').data('change-unit') || 2); //default value is 2
        startGameAndSetGenericEnding(gameIndex, -1, nrtbc_each);
      });
    </script>
  </div> <!-- Knock game precursor screen -->


  <div data-role="page" id="flexion-cliff-game" class="flexion-game-displayer" data-theme="d">
    <!-- "Instructions" but would be cut off in header -->
    <div data-role="header" class="header-bar"> Cliff Mine Game </div>
    <div data-role="header" class="header-bar2"> <h1 class="header-text"> </h1> </div>

    <div data-role="main" class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
      <img src="Dropbox/ui_media/games/cliff/cliffgame_instructionicon.png" alt="Cliff Mine Game" class="hand-flippable" style="width: 75%">

      <!-- <div class="game-instructions-entry">
        <h3> Exercise: </h3>
        <p> Palmar/Dorsiflexion </p>
      </div> -->
      <div class="game-instructions-entry">
        <h3> Game Difficulty: </h3>
        <p> Beginner </p>
      </div>

      <div class="game-instructions-entry">
        <h3> Reps: </h3>
        <button id="rep-counter-6-decrementer" data-change-unit=1 data-inline="true" data-icon="arrow-d" data-iconpos="notext" data-mini="true"> Up </button>
        <p id="rep-counter-6" class="rep-count" data-inline="true"> 4 </p>
        <button id="rep-counter-6-incrementer" data-change-unit=1 data-inline="true" data-icon="arrow-u" data-iconpos="notext" data-mini="true"> Down </button>
      </div>

      <div class="game-instructions-entry">
        <h3> Phone Orientation: </h3>
        <p> Horizontal/Landscape </p>
      </div>

      <img src="Dropbox/ui_media/exercise_arrows/flexion_arrows.png" alt="Picture instructions" class="hand-flippable" style="width: 50%">

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
        <p class="game-play-or-tutorial-button-text"> Let's play </p>
        <input type="button" data-enhanced="true" value="StartGame" id="flexion-cliff-play-button">
      </div>

    </div> <!-- main -->

    <script type="text/javascript">
      $("#flexion-cliff-play-button").click(function() {
        playClickSound();
        var gameIndex = 6;
        var ntrtbc = parseInt($('#rep-counter-' + gameIndex).html(), 10);
        var nrtbc_each = ntrtbc / ($('#rep-counter-' + gameIndex + '-decrementer').data('change-unit') || 2); //default value is 2
        startGameAndSetGenericEnding(gameIndex, -1, nrtbc_each);
      });
    </script>
  </div> <!-- Knock game precursor screen -->


  <div data-role="page" id="fist-squeeze-game" class="fist-game-displayer" data-theme="d">
    <!-- "Instructions" but would be cut off in header -->
    <div data-role="header" class="header-bar"> Squeeze Bottle Game </div>
    <div data-role="header" class="header-bar2"> <h1 class="header-text">  </h1> </div>

    <div data-role="main" class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
      <!-- can't flip this image because the background has the MoTrack logo. Plus only the foreground, not the background is flipped in the game itself (for the same reason). -->
      <img src="Dropbox/ui_media/games/squeeze/squeezegame_instructionicon.png" alt="Squeeze Bottle Game" style="width: 75%">

      <!-- <div class="game-instructions-entry">
        <h3> Exercise: </h3>
        <p> Fist </p>
      </div> -->

      <div class="game-instructions-entry">
        <h3> Game Difficulty: </h3>
        <p> Advanced </p>
      </div>

      <div class="game-instructions-entry">
        <h3> Reps: </h3>
        <button id="rep-counter-1-decrementer" data-inline="true" data-icon="arrow-d" data-iconpos="notext" data-mini="true"> Up </button>
        <p id="rep-counter-1" class="rep-count" data-inline="true"> 6 </p>
        <button id="rep-counter-1-incrementer" data-inline="true" data-icon="arrow-u" data-iconpos="notext" data-mini="true"> Down </button>
      </div>

      <div class="game-instructions-entry">
        <h3> Phone Orientation: </h3>
        <p> Vertical/Portrait </p>
      </div>

      <img src="Dropbox/ui_media/exercise_arrows/fist_arrows.png" alt="Picture instructions" style="width: 50%">

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
        <p class="game-play-or-tutorial-button-text"> Let's play </p>
        <input type="button" data-enhanced="true" value="StartGame" id="fist-squeeze-play-button">
      </div>

    </div> <!-- main -->

    <script type="text/javascript">
      $("#fist-squeeze-play-button").click(function() {
        playClickSound();
        var gameIndex = 1;
        var ntrtbc = parseInt($('#rep-counter-' + gameIndex).html(), 10);
        var nrtbc_each = ntrtbc / ($('#rep-counter-' + gameIndex + '-decrementer').data('change-unit') || 2); //default value is 2
        startGameAndSetGenericEnding(gameIndex, -1, nrtbc_each);
      });
    </script>
  </div> <!-- Squeeze bottle game precursor screen -->


  <div data-role="page" id="pump-balloon-game" class="fist-game-displayer" data-theme="d">
    <!-- "Instructions" but would be cut off in header -->
    <div data-role="header" class="header-bar"> Pump Balloon Game </div>
    <div data-role="header" class="header-bar2"> <h1 class="header-text"> </h1> </div>

    <div data-role="main" class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
      <img src="Dropbox/ui_media/games/balloon/balloongame_instructionicon.png" alt="Pump Balloon Game" class="hand-flippable" style="width: 75%">

      <!-- <div class="game-instructions-entry">
        <h3> Exercise: </h3>
        <p> Fist </p>
      </div> -->

      <div class="game-instructions-entry">
        <h3> Game Difficulty: </h3>
        <p> Beginner </p>
      </div>

      <div class="game-instructions-entry">
        <h3> Reps: </h3>
        <button id="rep-counter-4-decrementer" data-change-unit=1 data-min-allowed=1 data-max-allowed=10 data-inline="true" data-icon="arrow-d" data-iconpos="notext" data-mini="true"> Up </button>
        <p id="rep-counter-4" class="rep-count" data-inline="true"> 4 </p>
        <button id="rep-counter-4-incrementer" data-change-unit=1 data-min-allowed=1 data-max-allowed=10 data-inline="true" data-icon="arrow-u" data-iconpos="notext" data-mini="true"> Down </button>
      </div>

      <div class="game-instructions-entry">
        <h3> Phone Orientation: </h3>
        <p> Vertical/Portrait </p>
      </div>

      <img src="Dropbox/ui_media/exercise_arrows/fist_arrows.png" alt="Picture instructions" style="width: 50%">

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
        <p class="game-play-or-tutorial-button-text"> Let's play </p>
        <input type="button" data-enhanced="true" value="StartGame" id="fist-pump-play-button">
      </div>

    </div> <!-- main -->

    <script type="text/javascript">
      $("#fist-pump-play-button").click(function() {
        playClickSound();
        var gameIndex = 4;
        var ntrtbc = parseInt($('#rep-counter-' + gameIndex).html(), 10);
        var nrtbc_each = ntrtbc / ($('#rep-counter-' + gameIndex + '-decrementer').data('change-unit') || 2); //default value is 2
        startGameAndSetGenericEnding(gameIndex, -1, nrtbc_each);
      });
    </script>
  </div> <!-- pump balloon game precursor screen -->


  <div data-role="page" id="pronation-dial-game" class="pronation-game-displayer" data-theme="d">
    <!-- "Instructions" but would be cut off in header -->
    <div data-role="header" class="header-bar"> Turn Dial Game </div>
    <div data-role="header" class="header-bar2"> <h1 class="header-text"> </h1> </div>

    <div data-role="main" class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
      <img src="Dropbox/ui_media/games/dial/dialgame_instructionicon.png" alt="Turn Dial Game" style="width: 75%">

      <!-- <div class="game-instructions-entry">
        <h3> Exercise: </h3>
        <p> Pronation/Supination </p>
      </div> -->

      <div class="game-instructions-entry">
        <h3> Game Difficulty: </h3>
        <p> Advanced </p>
      </div>

      <div class="game-instructions-entry">
        <h3> Reps: </h3>
        <button id="rep-counter-3-decrementer" data-inline="true" data-icon="arrow-d" data-iconpos="notext" data-mini="true"> Up </button>
        <p id="rep-counter-3" class="rep-count" data-inline="true"> 6 </p>
        <button id="rep-counter-3-incrementer" data-inline="true" data-icon="arrow-u" data-iconpos="notext" data-mini="true"> Down </button>
      </div>

      <div class="game-instructions-entry">
        <h3> Phone Orientation: </h3>
        <p> Vertical/Portrait </p>
      </div>

      <img src="Dropbox/ui_media/exercise_arrows/pronation_arrows.png" alt="Picture instructions" class="hand-flippable" style="width: 50%">

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
        <p class="game-play-or-tutorial-button-text"> Let's play </p>
        <input type="button" data-enhanced="true" value="StartGame" id="pronation-dial-play-button">
      </div>

    </div> <!-- main -->

    <!-- pronation-ketchup-shake-button -->

    <script type="text/javascript">
      $("#pronation-dial-play-button").click(function() {
        playClickSound();
        var gameIndex = 3;
        var ntrtbc = parseInt($('#rep-counter-' + gameIndex).html(), 10);
        var nrtbc_each = ntrtbc / ($('#rep-counter-' + gameIndex + '-decrementer').data('change-unit') || 2); //default value is 2
        startGameAndSetGenericEnding(gameIndex, -1, nrtbc_each);
      });
    </script>
  </div> <!-- Pronation dial game precursor screen -->


  <div data-role="page" id="pronation-ketchup-game" class="pronation-game-displayer" data-theme="d">
    <!-- "Instructions" but would be cut off in header -->
    <div data-role="header" class="header-bar"> Ketchup Shake Game </div>
    <div data-role="header" class="header-bar2"> <h1 class="header-text"> </h1> </div>

    <div data-role="main" class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
      <img src="Dropbox/ui_media/games/ketchup/ketchupgame_instructionicon.png" alt="Shake Ketchup Game" class="hand-flippable" style="width: 75%">

      <!-- <div class="game-instructions-entry">
        <h3> Exercise: </h3>
        <p> Pronation/Supination </p>
      </div> -->

      <div class="game-instructions-entry">
        <h3> Game Difficulty: </h3>
        <p> Beginner </p>
      </div>

      <div class="game-instructions-entry">
        <h3> Reps: </h3>
        <button id="rep-counter-7-decrementer" data-change-unit=1 data-min-allowed=1 data-max-allowed=10 data-inline="true" data-icon="arrow-d" data-iconpos="notext" data-mini="true"> Up </button>
        <p id="rep-counter-7" class="rep-count" data-inline="true"> 4 </p>
        <button id="rep-counter-7-incrementer" data-change-unit=1 data-min-allowed=1 data-max-allowed=10 data-inline="true" data-icon="arrow-u" data-iconpos="notext" data-mini="true"> Down </button>
      </div>

      <div class="game-instructions-entry">
        <h3> Phone Orientation: </h3>
        <p> Horizontal/Landscape </p>
      </div>

      <img src="Dropbox/ui_media/exercise_arrows/pronation_arrows.png" alt="Picture instructions" class="hand-flippable" style="width: 50%">

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
        <p class="game-play-or-tutorial-button-text"> Let's play </p>
        <input type="button" data-enhanced="true" value="StartGame" id="pronation-ketchup-play-button">
      </div>

    </div> <!-- main -->

    <script type="text/javascript">
      $("#pronation-ketchup-play-button").click(function() {
        playClickSound();
        var gameIndex = 7;
        var ntrtbc = parseInt($('#rep-counter-' + gameIndex).html(), 10);
        var nrtbc_each = ntrtbc / ($('#rep-counter-' + gameIndex + '-decrementer').data('change-unit') || 2); //default value is 2
        startGameAndSetGenericEnding(gameIndex, -1, nrtbc_each);
      });
    </script>
  </div> <!-- Pronation ketchup game precursor screen -->


  <div data-role="page" id="abduction-peacock-game" class="abduction-game-displayer" data-theme="d">
    <!-- "Instructions" but would be cut off in header -->
    <div data-role="header" class="header-bar"> Abduction Peacock Game </div>
    <div data-role="header" class="header-bar2"> <h1 class="header-text"> </h1> </div>

    <div data-role="main" class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
      <img src="Dropbox/ui_media/games/peacock/peacockgame_instructionicon.png" alt="Peacock Fan Game" class="hand-flippable" style="width: 75%">

      <!-- <div class="game-instructions-entry">
        <h3> Exercise: </h3>
        <p> Finger Abduction/Adduction </p>
      </div> -->

      <div class="game-instructions-entry">
        <h3> Game Difficulty: </h3>
        <p> Advanced </p>
      </div>

      <div class="game-instructions-entry">
        <h3> Reps: </h3>
        <button id="rep-counter-8-decrementer" data-inline="true" data-icon="arrow-d" data-iconpos="notext" data-mini="true"> Up </button>
        <p id="rep-counter-8" class="rep-count" data-inline="true"> 6 </p>
        <button id="rep-counter-8-incrementer" data-inline="true" data-icon="arrow-u" data-iconpos="notext" data-mini="true"> Down </button>
      </div>

      <div class="game-instructions-entry">
        <h3> Phone Orientation: </h3>
        <p> Vertical/Portrait </p>
      </div>

      <img src="Dropbox/ui_media/exercise_arrows/abduction_arrows.png" alt="Picture instructions" style="width: 50%">

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
        <p class="game-play-or-tutorial-button-text"> Let's play </p>
        <input type="button" data-enhanced="true" value="StartGame" id="abduction-peacock-play-button">
      </div>

    </div> <!-- main -->

    <script type="text/javascript">
      $("#abduction-peacock-play-button").click(function() {
        playClickSound();
        var gameIndex = 8;
        var ntrtbc = parseInt($('#rep-counter-' + gameIndex).html(), 10);
        var nrtbc_each = ntrtbc / ($('#rep-counter-' + gameIndex + '-decrementer').data('change-unit') || 2); //default value is 2
        startGameAndSetGenericEnding(gameIndex, -1, nrtbc_each);
      });
    </script>
  </div> <!-- Finger abduction peacock precursor screen -->


<div data-role="page" id="opposition-alligator-game" class="opposition-game-displayer" data-theme="d">
  <!-- "Instructions" but would be cut off in header -->
  <div data-role="header" class="header-bar"> Opposition Alligator Game </div>
  <div data-role="header" class="header-bar2"> <h1 class="header-text"> </h1> </div>

  <div data-role="main" class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
    <img src="Dropbox/ui_media/games/alligator/alligatorgame_instructionicon.png" alt="Alligator Chomp Game" class="hand-flippable" style="width: 75%">

    <!-- <div class="game-instructions-entry">
      <h3> Exercise: </h3>
      <p> Finger Abduction/Adduction </p>
    </div> -->

    <div class="game-instructions-entry">
      <h3> Game Difficulty: </h3>
      <p> Advanced </p>
    </div>

    <div class="game-instructions-entry">
      <h3> Reps: </h3>
      <button id="rep-counter-9-decrementer" data-inline="true" data-icon="arrow-d" data-iconpos="notext" data-mini="true"> Up </button>
      <p id="rep-counter-9" class="rep-count" data-inline="true"> 6 </p>
      <button id="rep-counter-9-incrementer" data-inline="true" data-icon="arrow-u" data-iconpos="notext" data-mini="true"> Down </button>
    </div>

    <div class="game-instructions-entry">
      <h3> Phone Orientation: </h3>
      <p> Vertical/Portrait </p>
    </div>

    <img src="Dropbox/ui_media/exercise_arrows/opposition_arrows.png" alt="Picture instructions" style="width: 50%">

    <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
      <p class="game-play-or-tutorial-button-text"> Let's play </p>
      <input type="button" data-enhanced="true" value="StartGame" id="opposition-alligator-play-button">
    </div>

  </div> <!-- main -->

  <script type="text/javascript">
    $("#opposition-alligator-play-button").click(function() {
      playClickSound();
      var gameIndex = 9;
      var ntrtbc = parseInt($('#rep-counter-' + gameIndex).html(), 10);
      var nrtbc_each = ntrtbc / ($('#rep-counter-' + gameIndex + '-decrementer').data('change-unit') || 2); //default value is 2
      startGameAndSetGenericEnding(gameIndex, -1, nrtbc_each);
    });
  </script>
</div> <!-- thumb opposition alligator precursor screen -->


  <script type="text/javascript">
  function getWhichHandIntended(shortExerciseName_lc) {
    /*var handStr = $("#hand-select-"+shortExerciseName_lc).val().toLowerCase();
    if (handStr === "r") {
      return 0;
    } else if (handStr === "l") {
      return 1;
    } else {
      return null;
    }*/

    return should_use_left_hand ? 1 : 0;
  }

  //function startPlainGame

  function startGameAndSetGenericEnding(gameIndex, which_hand_intended, nrtbc_each) {
    var game = games_map2.find((game) => game.gameIndex === gameIndex);
    var shortExerciseName_lc = game["shortExerciseName"].toLowerCase();

    if (isNaN(which_hand_intended) || which_hand_intended < 0) {
      // 0 for right, 1 for left. getWhichHandIntended() returns null if error
      which_hand_intended = getWhichHandIntended(shortExerciseName_lc) || 0;
    }
    //console.log(which_hand_intended);
    if (isNaN(nrtbc_each) || nrtbc_each < 0) {
      nrtbc_each = 3; // 5 each means 10 reps total, and max score of 10
    }

    var longGameName = game["longGameName"];
    var longGameName_lc = longGameName.toLowerCase();
    var exerciseGameNum = game["exerciseGameNum"]; //shortGameName
    var shortGameName_lc = game["shortGameName"].toLowerCase();
    var showVideoForThisGame = game["showVideo"];
    var tutorialVidName = game["tutorialVidName"];
    var tutorialVidSubtitlesName = game["tutorialVidSubtitlesName"];
    var videoWatches = game["videoWatches"] || 0;
    var shortExerciseName_lc = game["shortExerciseName"].toLowerCase();
    var exercise = exercises_map.find((exercise) => exercise.short_exercise_name_lc === shortExerciseName_lc);
    var background_color = exercise["background_color"];

    console.log("exerciseGameNum from startGameAndSetGenericEnding: " + exerciseGameNum);

    function setupGameFunc(e) {
      startGame(exerciseGameNum, which_hand_intended, nrtbc_each);

      //update firebase with new game done
      currentGameID  = firebase.database().ref('gameActions/' + uid + '/' + exerciseGameNum + '/').push().key;
      var newGameRef = firebase.database().ref('gameActions/' + uid + '/' + exerciseGameNum + '/' + currentGameID);
      var time = getTimeAsReadableString();
      newGameRef.set({
        longGameName: longGameName,
        gameIndex: gameIndex,
        startUnixTime: time.unix,
        startStringTime: time.str,
        loginSessionID: loginSessionID
      }, completionCallback);

      var loginToGameActionRef = firebase.database().ref('logins/' + uid + '/' + loginSessionID + '/linkedGameActions/' + currentGameID);
      loginToGameActionRef.set(true, completionCallback);


      var game = games_map2.find((game) => game.gameIndex === gameIndex);

      // can't use navigateTo because I can't figure out how to pass
      // arguments through jQuery.mobile.changePage() plus, it doesn't
      // matter because the reason why I used jQuery.mobile.changePage()
      // in the first place was to use transitions which don't matter
      // if the next screen is the game
      console.log("game.scoringSystem: " + game.scoringSystem);
      window.location = "#generic-game-ending-v" + (game.scoringSystem || 1) + "?gameIndex=" + gameIndex;
      if (game.scoringSystem == 2) { //v2, an advanced scoring page used for continuous games
        var scoreRankCtToDisplay = 3; //this represents the number of scores to display
        var scoreRank = 1;
        $("#leaderboard tbody").empty(); //remove all children, emptying out the table (not counting the header row)
        while (scoreRank <= scoreRankCtToDisplay) { //fill this up with blank values in case there aren't enough gameScores to fill it up completely
          var className = "scoring-row-" + scoreRank;
          $("#leaderboard tbody").append("<tr class='" + className + "'><td>#" + scoreRank + "</td> <td class='" + className + "-score'>" + "-" + "</td> <td class='" + className + "-time'>" + "-" + "</td></tr>");
          scoreRank = scoreRank + 1;
        }
        scoreRank = scoreRankCtToDisplay; //bring back counter to max because firebase gives data in the reverse order (firebase gives in ascending order)
        firebase.database().ref('gameActions/' + uid + '/' + exerciseGameNum + '/').orderByChild('gameScore').startAt(0).limitToLast(3).on("child_added", function(snapshot) {
          var gameScore = snapshot.child('gameScore').val();
          var currentUnixTime = (new Date()).getTime() / 1000.0;
          //have the || default value because of bug I couldn't figure out where the value isn't defined correctly
          //for new users playing a game for the first time
          var startUnixTime = snapshot.child('startUnixTime').val() || currentUnixTime;
          var timeStr = getTimeAsUserFriendlyString(currentUnixTime - startUnixTime);
          var className = "scoring-row-" + scoreRank;
          $("#leaderboard tbody ." + className + "-score").html(gameScore.toFixed(1));
          $("#leaderboard tbody ." + className + "-time").html(timeStr);
          //$("#leaderboard tbody").prepend("<tr><td>#" + scoreRank + "</td> <td>" + gameScore.toFixed(1) + "</td> <td>" + timeStr + "</td></tr>");
          //$("#leaderboard tbody tr:nth-child(" + counter + "n)").html("<td>" + counter + "</td> <td>" + gameScore + "</td> <td>" + timeStr + "</td>");
          scoreRank = scoreRank - 1;
        }, function(err) {
          console.log("Error: " + err);
        });

      }
    };

    //format the screen colors to match the exercise type
    $("#generic-game-ending-v1 .ui-btn:not(.ui-btn-icon-notext), #generic-game-ending-v2 .ui-btn:not(.ui-btn-icon-notext), #video1-screen .ui-btn:not(.ui-btn-icon-notext), #video2-screen .ui-btn:not(.ui-btn-icon-notext)").css("background-image", "linear-gradient(to right, "+background_color+" 10%, #000 10.01%, #000 10.29%, #30ABDF 10.3%)");


    //plays tutorial videos even if play_tutorial_videos=false if the video hasn't been watched before
    if ( (play_tutorial_videos || videoWatches < 1 ) && showVideoForThisGame ) {
      //Since the src doesn't change for video1, just define it in the html tag itself
      //var video1_local_url = "Dropbox/ui_media/games/generaltutorial.mp4";
      //$('#video1-source1').attr("src", video1_local_url);
      //video1_player.load();

      var p_elem = $("#jump-within-video-button-holder p").first();
      var onTimeUpdateFunc = function(trackWatches) {
        //allow player to start game after watching video (aka 90% of the video is done)
        if (trackWatches && video2_player.currentTime > video2_player.duration * 0.9) {
          $("#skip-video2-button").prop("disabled", false);
          $("#skip-video2-button-holder").removeClass("ui-disabled");

          //increase the value of videoWatches in the server
          var videoWatchesRef = firebase.database().ref('users/' + uid + '/games/' + longGameName_lc + '/videoWatches');
          videoWatchesRef.transaction(function(transVideoWatchesValue) {
            // Note: If users/.../videoWatches has never been set, videoWatchesValue will be `null`.
            if (transVideoWatchesValue == null) {
              videoWatches = 1;

            } else if (transVideoWatchesValue <= -1) { //if current value is -1 or below, that signals that the video should never be skippable.
              videoWatches = transVideoWatchesValue;

            } else {
              videoWatches = transVideoWatchesValue + 1;
            }
            game["videoWatches"] = videoWatches; //This might end up happening twice, once here and once in the games "on" firebase method. But better twice than none.
            return videoWatches;
          }, function(err, committed, dataSnap) {
            videoWatches = videoWatches + 1;
            game["videoWatches"] = videoWatches;
            completionCallback(err);
          });

          video2_player.ontimeupdate = function() {
            onTimeUpdateFunc(false)
          }; //don't need to keep calling the first part of this method more than once, so the listener to one where the input boolean is false

        }

        if (video2_player.currentTime > VIDEO2_PLAYER_PART2_TIME && p_elem.text().trim() == "Skip to Tutorial Pt 2") { //measured in seconds
          p_elem.text("Restart Video");
        }
      };

      // if the video has never been watched before, then force the user to watch it (i.e. don't allow skipping of the video through the skip button)
      if (videoWatches < 1) {
        $("#skip-video2-button").prop("disabled", true);
        $("#skip-video2-button-holder").addClass("ui-disabled");
        video2_player.ontimeupdate = function() {
          onTimeUpdateFunc(true)
        };

      } else {
        $("#skip-video2-button").prop("disabled", false);
        $("#skip-video2-button-holder").removeClass("ui-disabled");
        video2_player.ontimeupdate = function() {
          onTimeUpdateFunc(false)
        };
      }

      video2_ended = setupGameFunc;
      var video2_local_url = "Dropbox/ui_media/games/" + shortGameName_lc + "/" + shortGameName_lc + "tutorial.mp4";
      //$('#subtitles2-source1').attr("src", "Dropbox/ui_media/games/testsubtitles");
      if (use_local_tutorial_vid_files) { //just get video locally
        $('#video2-source1').attr("src", video2_local_url);
        video2_player.load();

      } else {
        if (tutorialVidName == null) { //if there is no key/value for this tutorial
          console.log("No tutorial video name found in the cloud for " + shortGameName_lc);
          showAndroidToast("No tutorial available");

        } else if (tutorialVidName.toLowerCase().includes("\\local\\")) { //the first \ of each pair is for escaping. Thus the string is \local\
          console.log("Firebase said to attempt using local video");
          $('#video2-source1').attr("src", video2_local_url);
          video2_player.load();

        } else { //get video from firebase storage in the cloud
          //define what to do if there is an error with firebase storage
          var storageErrorFunc = function(error) {
            // Handle any errors
            if (error.code == "storage/quota-exceeded") {
              errorMsg = "storage quota is exceeded";
              showAndroidToast("Video error: " + errorMsg);
              console.log("Error getting tutorial video material for " + shortGameName_lc + " because the " + errorMsg + ".");
            } else if (error.code == "storage/") {
              errorMsg = error.code.substring(8);
              showAndroidToast("Video error: " + errorMsg);
              console.log("Error getting tutorial video material for " + shortGameName_lc + " because the " + errorMsg + ".");
            } else {
              showAndroidToast("Video error");
              console.log("Error getting tutorial video material for " + shortGameName_lc);
            }
          };

          //download video from firebase storage
          storageRef.child(tutorialVidName).getDownloadURL().then(function(url) {
            console.log("Getting tutorial video for " + shortGameName_lc);
            console.log("tutorialVidSubtitlesName: " + tutorialVidSubtitlesName);
            console.log("tutorialVidName: " + tutorialVidName);
            $('#video2-source1').attr("src", url);

            //On Chrome, need to get subtitles locally avoid cross-origin error
            if (device == ANDROID_DEVICE || device == OTHER_DEVICE ) {
              /*var subtitlesStr = "WEBVTT - This file has cues. \n\
\n\
              00:01.000 --> 00:04.000 \n\
              Welcome to this app. \n\
\n\
              00:05.000 --> 00:09.000 \n\
              - It is a pleasure to meet you. \n\
              - Cheers."*/
              var subtitlesStr = $("#subtitles-"+shortGameName_lc).html();
              var prefix = "data:text/plain;charset=UTF-8;page=21,";
              if (subtitlesStr != null) {
                //important because won't work if first line of subtitles file isn't on the same line as the prefix
                subtitlesStr = subtitlesStr.trim();
                $('#subtitles2-source1').attr("src",prefix+subtitlesStr);
                console.log("subtitlesStr:");
                console.log(subtitlesStr);
              } else {
                $('#subtitles2-source1').attr("src","");
              }
              video2_player.load();

            } else { //for iOS (not restricted by Chrome's strict cross-origin policy, so have more options)
              if (tutorialVidSubtitlesName == null || tutorialVidSubtitlesName == "") { //no subtitles
                video2_player.load();

              } else if (tutorialVidSubtitlesName.toLowerCase().startsWith("\\web\\")) { //get subtitles file from motracktherapy.com url
                tutorialVidSubtitlesName = tutorialVidSubtitlesName.substring("\\web\\".length);
                console.log("tutorialVidSubtitlesName: " + tutorialVidSubtitlesName);
                $('#subtitles2-source1').attr("src", tutorialVidSubtitlesName);
                video2_player.load();

              } else { //download subtitles file from firebase storage
                storageRef.child(tutorialVidSubtitlesName).getDownloadURL().then(function(url2) {
                  console.log("Getting tutorial video subtitles for " + shortGameName_lc);
                  $('#subtitles2-source1').attr("src", url2);
                  //$('#subtitles2-source1').attr("src", "Dropbox/ui_media/games/testsubtitles.vtt");
                  video2_player.load();
                }).catch(storageErrorFunc); //callback for getting subtitles from firebase storage
              }
            }

          }).catch(storageErrorFunc); //callback for getting video from firebase storage

        }
      }

      if (play_gen_tutorial_video) {
        navigateTo("#video1-screen");
      } else {
        navigateTo("#video2-screen");
      }


    } else {
      setupGameFunc(null);
    }

  }

  //normally called from Android, but can be called from javascript if testing on google chrome
  function updateAfterGameFinished(exerciseGameNum, gameScore, repsCompletedTot, nrtbc_each) {
    var game = games_map2.find((game) => game.exerciseGameNum === exerciseGameNum);
    var exercise = game["shortExerciseName"].toLowerCase();
    var repSetLen = game["repSetLen"];

    var newGameRef = firebase.database().ref('gameActions/' + uid + '/'  + exerciseGameNum + '/' + currentGameID + '/');
    var time = getTimeAsReadableString();
    //repsCompletedEquivalentTot factors in a difficult ratio, i.e. balloon game rep is equivalent to 10 squeeze game reps
    var repsCompletedEquivalentTot = repsCompletedTot * (game["repDifficultyRatio"] || 1);
    var updates = {};
    updates['gameScore'] = gameScore;
    updates['endUnixTime'] = time.unix;
    updates['endStringTime'] = time.str;
    updates['repsCompletedTot'] = repsCompletedTot;
    updates['repsAttemptedEach'] = nrtbc_each;
    updates['repsAttemptedTot'] = nrtbc_each * repSetLen;
    updates['repsCompletedEquivalentTot'] = repsCompletedEquivalentTot;
    newGameRef.update(updates, completionCallback)


    $("#generic-game-reps-attempted").html((nrtbc_each * repSetLen).toFixed(0));
    setGenericEndingV2RepsAndScore(exerciseGameNum, gameScore, repsCompletedTot, nrtbc_each * repSetLen);

    // Increment repsDone rank by repsCompletedTot.
    $("#generic-game-reps-completed").html(repsCompletedTot + "");
    var repsDoneRef = firebase.database().ref('users/' + uid + '/exercises/' + exercise + '/repsDone');
    repsDoneRef.transaction(function(currentRepsDoneValue) {
      // Note: If users/.../repsDone has never been set, currentRepsDoneValue will be `null`.
      if (currentRepsDoneValue == null) {
        return repsCompletedEquivalentTot
      } else {
        var total = currentRepsDoneValue + repsCompletedEquivalentTot;
        $("#generic-game-daily-reps-completed").html((total).toFixed(0) + "");
        return total;
      }
    }, function(err, committed, dataSnap) {
      completionCallback(err);
    });

  }

  function saveAPNToken(apnToken) {
    console.log("Will save token: " + apnToken);
    //var apnRef = firebase.database().ref('users/' + uid + "/APNToken");
    //apnRef.set(apnToken);

    var time = getTimeAsReadableString();
    var apnsRef = firebase.database().ref('users/' + uid + "/APNTokens/"+apnToken);
    apnsRef.set({enabled: true, enabledTime: time.unix, enabledTimeStr: time.str},
       function(error) {
         if (error) {
           // The write failed...
         } else {
           // Data saved successfully!
         }
       });

  }
  </script>


  <!-- ======================== -->
  <!--    GAME ENDING SCREENS   -->
  <!-- ======================== -->
  <div data-role="page" id="generic-game-ending-v1" data-theme="d">
    <div data-role="header" class="header-bar-force-with-home" id="generic-game-header"> Game Results </div>
    <div data-role="main" class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
      <img id="generic-game-instructionicon" alt="Game Icon" style="width: 75%">

      <div class="game-instructions-entry">
        <h3> Exercise: </h3>
        <p id="generic-game-exercise"> - </p>
      </div>

      <div class="game-instructions-entry">
        <h3> Reps Completed: </h3>
        <p>
          <span id="generic-game-reps-completed"> - </span> /
          <span id="generic-game-reps-attempted"> - </span>
        </p>
      </div>

      <div class="game-instructions-entry">
        <h3> Daily Rep Total: </h3>
        <p id="generic-game-daily-reps-completed"> - </p>
      </div>

      <div class="game-instructions-entry">
        <h3 style="color: black; margin-top: 25px;">
          Good job,
          <span class="display-name-holder">[Name]</span>!
          <!--But we know you can do even better next time!-->
        </h3>
      </div>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 0px; padding-bottom: 0px; /*default is 17 top and bottom padding*/">
        <p> Play again </p>
        <input type="button" data-enhanced="true" value="StartGame" id="generic-game-v1-play-again-button">
      </div>
      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 0px; padding-bottom: 0px; /*default is 17 top and bottom padding*/">
        <p> Other Exercises </p>
        <input type="button" data-enhanced="true" value="StartGame" id="generic-game-v1-other-exercises-button">
      </div>

    </div> <!-- main -->

    <script type="text/javascript">
      $("#generic-game-v1-play-again-button").click(function() {
        playClickSound();
        var gameIndexStr = getUrlVars(window.location.href)["gameIndex"];
        if (gameIndexStr != null) {
          var gameIndex = parseInt(gameIndexStr, 10);
          var ntrtbc = parseInt($('#generic-game-reps-attempted').first().html(), 10);
          var nrtbc_each = ntrtbc / ($('#rep-counter-' + gameIndex + '-decrementer').data('change-unit') || 2); //divide by 2 because the displayed value is total, and we need the number per each of the two exercises
          if (isNaN(nrtbc_each)) {
            nrtbc_each = 10;
          }
          startGameAndSetGenericEnding(gameIndex, -1, nrtbc_each);
        } else {
          console.log("gameIndex is null");
        }
      });
      $("#generic-game-v1-other-exercises-button").click(function() {
        playClickSound();
        navigateTo("#exercisetypescreen");
        //window.location = "#exercisetypescreen";
      });
      $(document).delegate('#generic-game-ending-v1', 'pagebeforeshow', function() {
        //Your code for each page load here
        var gameIndexStr = getUrlVars(window.location.href)["gameIndex"];
        if (gameIndexStr != null) {
          var gameIndex = parseInt(gameIndexStr, 10);
          var game = games_map2.find((game) => game.gameIndex === gameIndex);
          var long_game_name = game["longGameName"];
          var long_exercise_name = game["longExerciseName"];
          var short_game_name = game["shortGameName"];
          var short_game_name_lc = short_game_name.toLowerCase();
          if (long_game_name.length <= 12) { //12 is an arbitrary number from testing on chrome's galaxy s5
            $("#generic-game-header .header-text").first().html(long_game_name + " Game"); //"Turn Dial"
          } else {
            $("#generic-game-header .header-text").first().html(short_game_name + " Game");
          }
          $("#generic-game-exercise").html(long_exercise_name); //"Pronation/Supination"
          $("#generic-game-reps-completed").html("N/A");
          $("#generic-game-reps-attempted").html("N/A");
          $("#generic-game-daily-reps-completed").html("N/A");
          $("#generic-game-instructionicon").attr("src", "Dropbox/ui_media/games/" + short_game_name_lc + "/" + short_game_name_lc + "game_instructionicon.png"); // "Dial"->"dial"

          //simulate playing the game
          if (device == OTHER_DEVICE) {
            var exerciseGameNum = game["exerciseGameNum"];
            updateAfterGameFinished(exerciseGameNum, 0, 0, 0);
          }
        } else {
          console.log("gameIndex is null")
        }
      });
    </script>
  </div> <!-- generic-game-ending-v1 screen -->


  <div data-role="page" id="generic-game-ending-v2" data-theme="d">
    <div data-role="header" class="header-bar-force-with-home"> Game Results </div>
    <div data-role="main" class="ui-content" style="padding-bottom: 0px; margin-bottom: 0px;">
      <div class="game-instructions-entry">
        <h3> Score: </h3>
        <p id="generic-ending-v2-score"> 8,500 </p>

        <div id="generic-ending-v2-small-icon-displayer">
          <img src="Dropbox/ui_media/main_images/singleletterlogo.png" class="generic-game-ending-v2-icon" alt="Logo" width="20px">
          <img src="Dropbox/ui_media/main_images/singleletterlogo.png" class="generic-game-ending-v2-icon" alt="Logo" width="20px">
          <img src="Dropbox/ui_media/main_images/singleletterlogo.png" class="generic-game-ending-v2-icon" alt="Logo" width="20px">
          <img src="Dropbox/ui_media/main_images/singleletterlogo.png" class="generic-game-ending-v2-icon" alt="Logo" width="20px">
          <!-- <img src="Dropbox/ui_media/games/balloon/balloonicon.png" class="generic-game-ending-v2-icon" alt="Balloon" width="20px">
          <img src="Dropbox/ui_media/games/balloon/balloonicon.png" class="generic-game-ending-v2-icon" alt="Balloon" width="20px">
          <img src="Dropbox/ui_media/games/balloon/balloonicon.png" class="generic-game-ending-v2-icon" alt="Balloon" width="20px">
          <img src="Dropbox/ui_media/games/balloon/balloonicon.png" class="generic-game-ending-v2-icon" alt="Balloon" width="20px"> -->
        </div>

        <p>
          <span id="generic-ending-v2-reps-completed-total">4</span>
          <span id="generic-ending-v2-reps-completed-total-phrase">items done</span> <!-- example: balloons pumped -->
        </p>
      </div>


      <table data-role="table" id="leaderboard" data-mode="overflow" style="margin-top: 40px; margin-bottom: 40px;">
        <thead>
          <tr>
            <th colspan="3"> Leaderboard</th>
          </tr>
          <tr>
            <th>Place</th>
            <th>Score</th>
            <th>Time</th>
          </tr>
        </thead>
        <tbody>
          <!--
             <tr>
               <td>#1</td>
               <td>-</td>
               <td>-</td>
             </tr>
             <tr>
               <td>#2</td>
               <td>-</td>
               <td>-</td>
             </tr>
             <tr>
               <td>#3</td>
               <td>-</td>
               <td>-</td>
             </tr> -->
          <!--<tr>
               <td>1</td>
               <td>11,000</td>
               <td>Jan 15</td>
             </tr>
             <tr>
               <td>2</td>
               <td>9,000</td>
               <td>Feb 4</td>
             </tr>
             <tr>
               <td>3</td>
               <td>8,800</td>
               <td>Jan 30</td>
             </tr> -->
          <!--<tr>
               <td>4</td>
               <td>8,600</td>
               <td>Jan 27</td>
             </tr>
             <tr>
               <td>5</td>
               <td>8,400</td>
               <td>Jan 26</td>
             </tr> -->
        </tbody>
      </table>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 0px; padding-bottom: 0px; /*default is 17 top and bottom padding*/">
        <p> Play again </p>
        <input type="button" data-enhanced="true" value="StartGame" id="generic-ending-v2-play-again-button">
      </div>
      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 0px; padding-bottom: 0px; /*default is 17 top and bottom padding*/">
        <p> Other Exercises </p>
        <input type="button" data-enhanced="true" value="StartGame" id="generic-ending-v2-other-exercises-button">
      </div>

      </div> <!-- main -->


      <script type="text/javascript">
        $("#generic-ending-v2-play-again-button").click(function() {
          playClickSound();
          var gameIndexStr = getUrlVars(window.location.href)["gameIndex"];
          if (gameIndexStr != null) {
            var gameIndex = parseInt(gameIndexStr, 10);
            var ntrtbc = $("#generic-ending-v2-small-icon-displayer .generic-game-ending-v2-icon").length;
            var nrtbc_each = ntrtbc / ($('#rep-counter-' + gameIndex + '-decrementer').data('change-unit') || 2); //divide by 2 because the displayed value is total, and we need the number per each of the two exercises
            if (isNaN(nrtbc_each)) {
              nrtbc_each = 10;
            }
            startGameAndSetGenericEnding(gameIndex, -1, nrtbc_each);
          } else {
            console.log("gameIndex is null");
          }
        });
        $("#generic-ending-v2-other-exercises-button").click(function() {
          playClickSound();
          navigateTo("#exercisetypescreen");
          //window.location = "#exercisetypescreen";
        });
        $(document).delegate('#generic-game-ending-v2', 'pagebeforeshow', function() {
          //Your code for each page load here
          var gameIndexStr = getUrlVars(window.location.href)["gameIndex"];
          if (gameIndexStr != null) {
            var gameIndex = parseInt(gameIndexStr, 10);
            var game = games_map2.find((game) => game.gameIndex === gameIndex);

            $("#generic-ending-v2-reps-completed-total").html("N/A");
            $("#generic-ending-v2-score").html("N/A");

            //simulate playing the game
            if (device == OTHER_DEVICE) {
              var exerciseGameNum = game["exerciseGameNum"];
              updateAfterGameFinished(exerciseGameNum, 0, 0, 0);
            }
          } else {
            console.log("gameIndex is null")
          }
        });

        function setGenericEndingV2RepsAndScore(exerciseGameNum, game_score, ntrc_tot, nrtbc_tot) {
          var game = games_map2.find((game) => game.exerciseGameNum === exerciseGameNum);

          var shortGameName_lc = game.shortGameName.toLowerCase();
          var longGameName_lc = game.longGameName.toLowerCase();
          var indBreak = longGameName_lc.indexOf(" ");

          $("#generic-ending-v2-reps-completed-total").html(ntrc_tot);
          $("#generic-ending-v2-score").html(game_score.toFixed(1)); //toFixed rounds to 2 decimal points (leaves trailing 0s too)
          //space is included in the second part. Example would be "balloons pumped" which came from [balloon][s][ pump][ed].
          $("#generic-ending-v2-reps-completed-total-phrase").text(longGameName_lc.substring(0,indBreak) + (ntrc_tot == 1 ? "" : "s") + longGameName_lc.substring(indBreak) + (longGameName_lc.endsWith("e") ? "d" : "ed"));

          //below part will make a container full of filled or empty balloons, denoting how many the patient did
          $("#generic-ending-v2-small-icon-displayer").empty();
          var it = 0
          for (; it < ntrc_tot; it++) {
            $("#generic-ending-v2-small-icon-displayer").append('<img src="Dropbox/ui_media/games/'+shortGameName_lc+'/'+shortGameName_lc+'endingicon.png" alt="'+shortGameName_lc+'" class="generic-game-ending-v2-icon">');
          }
          for (; it < nrtbc_tot; it++) {
            $("#generic-ending-v2-small-icon-displayer").append('<img src="Dropbox/ui_media/games/'+shortGameName_lc+'/'+shortGameName_lc+'endingiconblank.png" alt="Blank '+shortGameName_lc+'" class="generic-game-ending-v2-icon">');
          }
        }
      </script>
  </div> <!-- generic-game-ending-v2 -->


  <!-- ================================================== -->
  <!--      GAME PRECURSOR "TUTORIAL" VIDEO SCREENS       -->
  <!-- ================================================== -->
  <div data-role="page" id="video1-screen" class="video-screen" data-theme="d">
    <div data-role="header" class="header-bar"> Tutorial Video #1/2</div>
    <!-- height of 650px was enough for my galaxy s9, but it was cutoff in Keefer's phone, which confused him, so I made it 900 because better safe than sorry-->
    <div data-role="main" class="ui-content">
      <video playsinline webkit-playsinline id="video1-player" width="100%" controls volume=0 style="" poster="Dropbox/ui_media/games/tutorialvideoplaceholder.png">
        <source id="video1-source1" src="" type="video/mp4"> <!-- src="Dropbox/ui_media/games/generaltutorial.mp4" -->
        <track id="subtitles1-source1" src="" default kind="captions" srclang="en" /> <!-- src="Dropbox/ui_media/games/testsubtitles.vtt" -->
        Sorry, your browser doesn't support embedded videos.
      </video>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow">
        <p> Next Video </p>
        <input type="button" data-enhanced="true" value="SkipButton" id="skip-video1-button">
      </div>

    </div> <!-- main -->

    <script type="text/javascript">
      $(document).delegate('#video1-screen', 'pagebeforeshow', function() {
        //Your code for each page load here
        if (video1_player.readyState >= 4) {
          console.log("Video 1 played");
          video1_player.play();
        } else {
          video1_player.oncanplaythrough = function() {
            console.log("Video 1 started playing after delay.");
            video1_player.play();
            // if not set to null, then video2_player will continue to play again
            // after being paused (if video2_player is both paused and has it's time set to 0)
            video1_player.oncanplaythrough = null;
          };
          console.log("Warning. Video 1 not setup on pagebeforeshow.");
        }
      });
      $(document).delegate('#video1-screen', 'pagebeforehide', function() {
        //Your code for each page load here
        if (video1_player.readyState > 0) { //should only equal zero if I refresh in iOS
          video1_player.pause();
          video1_player.currentTime = 0;
        } else {
          console.log("Error. Video 1 not setup on pagebeforehide.");
        }
      });
      $("#skip-video1-button").click(function() {
        playClickSound();
        //video1_player.currentTime = video1_player.duration;
        if (video1_player.readyState > 0) { //should only equal zero if I refresh in iOS
          //var setupGameFunc = video1_player.onended;
          //setupGameFunc(null); //put null for event e
          video1_ended(null);
        } else {
          console.log("Error. Video 1 not setup on skip button click.")
          //var setupGameFunc = video1_player.onended;
          //setupGameFunc(null);
          video1_ended(null);
        }

      });
    </script>
  </div> <!-- Tutorial Video 1 screen -->


  <div data-role="page" id="video2-screen" class="video-screen" data-theme="d">
    <div data-role="header" class="header-bar"> Tutorial Video #2/2</div>
    <!-- height of 650px was enough for my galaxy s9, but it was cutoff in Keefer's phone, which confused him, so I made it 900 because better safe than sorry-->
    <div data-role="main" class="ui-content">
      <video playsinline webkit-playsinline id="video2-player" controls volume=1 poster="Dropbox/ui_media/games/tutorialvideoplaceholder.png">
        <source id="video2-source1" src="" type="video/mp4">
        <track id="subtitles2-source1" src="" default kind="captions" srclang="en" /> <!-- src="Dropbox/ui_media/games/testsubtitles.vtt" -->
        Sorry, your browser doesn't support embedded videos.
      </video>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" id="jump-within-video-button-holder">
        <p> Skip to Tutorial Pt 2 </p>
        <input type="button" data-enhanced="true" value="SkipButton" id="jump-within-video-button">
      </div>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" id="skip-video2-button-holder">
        <p> Start the Game! </p>
        <input type="button" data-enhanced="true" value="SkipButton" id="skip-video2-button">
      </div>


    </div> <!-- main -->

    <script type="text/javascript">
      $(document).delegate('#video2-screen', 'pagebeforeshow', function() {
        //Your code for each page load here

        if (video2_player.readyState >= 4) {
          console.log("Video 2 played");
          video2_player.play();
        } else {
          video2_player.oncanplaythrough = function() {
            console.log("Video 2 started playing after delay.");
            video2_player.play();
            // if not set to null, then video2_player will continue to play again
            // after being paused (if video2_player is both paused and has it's time set to 0)
            video2_player.oncanplaythrough = null;
          };
          console.log("Warning. Video 2 not setup on pagebeforeshow.");
        }

        var p_elem = $("#jump-within-video-button-holder p").first();
        p_elem.text("Skip to Tutorial Pt 2");

      });

      $(document).delegate('#video2-screen', 'pagebeforehide', function() {
        //Your code for each page load here
        if (video2_player.readyState > 0) { //should only equal zero if I refresh in iOS
          video2_player.pause();
          video2_player.currentTime = 0;
        } else {
          console.log("Error. Video 2 not setup on pagebeforehide.");
        }
      });

      $("#jump-within-video-button").click(
        function() {
          playClickSound();
          var p_elem = $("#jump-within-video-button-holder p").first();
          if (p_elem.text().trim() == "Skip to Tutorial Pt 2") {
            video2_player.currentTime = VIDEO2_PLAYER_PART2_TIME; //in seconds (not milliseconds)
            p_elem.text("Restart Video");

          } else if (p_elem.text().trim() == "Restart Video") {
            video2_player.currentTime = 0; //in seconds (not milliseconds)
            p_elem.text("Skip to Tutorial Pt 2");

          }
        });

      $("#skip-video2-button").click(
        function() {
          playClickSound();
          //video2_player.currentTime = video2_player.duration;
          if (video2_player.readyState > 0) { //should only equal zero if I refresh in iOS
            //var setupGameFunc = video2_player.onended;
            //setupGameFunc(null); //put null for event e
            video2_ended(null);
          } else {
            console.log("Error. Video 2 not setup on skip button click.")
            //var setupGameFunc = video2_player.onended;
            //setupGameFunc(null);
            video2_ended(null);
          }

        });
    </script>
  </div> <!-- Tutorial Video 2 screen -->


  <!-- ===================== -->
  <!-- PROGRESS SCREENS PAGES-->
  <!-- ===================== -->
  <div data-role="page" id="progress-screen-main" data-theme="c">
    <div data-role="header" class="header-bar"> Progress </div>
    <div data-role="main" class="ui-content" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">

      <div style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
        How have you been doing?
      </div>

      <script id="progress_exercises_template" type="text/html">
        <fieldset data-role="controlgroup" data-theme="a">
          <legend>For exercise...</legend>
          <!-- Note: label must immediately follow the input. Otherwise, CSS might fail (input[type="radio"]:checked+label) -->
          <input type="radio" name="exercises-radio-choice" id="all-radio-choice" value="combined exercises">
          <label for="all-radio-choice" style="padding-left: 15%; background-color: #30ABDF; color: #FFF;">All exercises</label>
          {{#.}}
            {{#enabled}}
              <input type="radio" name="exercises-radio-choice" id="{{short_exercise_name_lc}}-radio-choice" value="{{short_exercise_name_lc}}">
              <label for="{{short_exercise_name_lc}}-radio-choice" style="padding-left: 15%; background-color: {{background_color}}; background-image: linear-gradient(to right, {{background_color}} 40px, #000 40.01px, #000 41px, #30ABDF 41.01px); border: 1px solid black; color: #FFF;" id="{{short_exercise_name_lc}}-label">{{descriptive_exercise_name}}</label>
            {{/enabled}}
          {{/.}}
        </fieldset>
      </script>

      <div id="progress_exercises_optionholder">
        <!-- items from the template will go here -->
      </div>

      <canvas id="progress_bar_chart" width="400" height="400"></canvas>

      <div style="background-color: #EBEBEB">
        <button id="chart-date-decrementer" data-change-unit=1 data-inline="true" data-icon="arrow-l" data-iconpos="notext" data-mini="true"> Up </button>
        <p id="chart-date" data-inline="true" style='display: inline-block;'>   </p>
        <button id="chart-date-incrementer" data-change-unit=1 data-inline="true" data-icon="arrow-r" data-iconpos="notext" data-mini="true"> Down </button>
      </div>

      <!--
      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow ui-mini" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
        <p> Previous </p>
        <input type="button" data-enhanced="true" value="Button2" id="chart-date-decrementer">
      </div>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow ui-mini" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
        <p> Next </p>
        <input type="button" data-enhanced="true" value="Button2" id="chart-date-incrementer" class="">
      </div> -->
    </div> <!-- main -->


    <script type="text/javascript">
      $(document).delegate('#progress-screen-main', 'pagebeforeshow', function() {
        var progress_exercises_template = $('#progress_exercises_template').html();
        var output = Mustache.render(progress_exercises_template, exercises_map);
        $( "#progress_exercises_optionholder" ).html( output ); //use .prepend(.) or .append(.)
        $( "#progress_exercises_optionholder" ).enhanceWithin();

        // For some reason (presumably because the data isn't gotten from firebase
        // fast enough before being lost as a reference somewhere?), I had to click
        // twice on an exercise radio button to have the graph load up.
        // I got this to go away by having it preload the data here with shouldDraw
        // as false. Then I realied that for some reason, you get the same benefit
        // if you have shouldDraw here and it gets draw as the frame opens

        var shouldDraw, numDaysAgo;

        shouldDraw = true;
        numDaysAgo = 0;
        manageChart("combined exercises", shouldDraw, numDaysAgo);

        shouldDraw = false;
        numDaysAgo = 0+num_days_ago_increment_amt;
        manageChart("combined exercises", shouldDraw, numDaysAgo);

        //Don't need to do it for numDaysAgo-1 because that should never happen
        shouldDraw = false;
        numDaysAgo = 0-num_days_ago_increment_amt;
        manageChart("combined exercises", shouldDraw, numDaysAgo);

        $('#progress_exercises_optionholder input').change(function() {
          var short_exercise_name_lc = $("#progress_exercises_optionholder :radio:checked").val() || "combined exercises"//the value is represented by short_exercise_name_lc
          var shouldDraw, numDaysAgo;

          //do this for previous day set and next day set to fix bug where it doesn't load properly the first time you click
          shouldDraw = true;
          numDaysAgo = num_days_ago_progress_showing;
          manageChart(short_exercise_name_lc, shouldDraw, numDaysAgo);

          shouldDraw = false;
          numDaysAgo = num_days_ago_progress_showing + num_days_ago_increment_amt;
          manageChart(short_exercise_name_lc, shouldDraw, numDaysAgo);

          shouldDraw = false;
          numDaysAgo = num_days_ago_progress_showing - num_days_ago_increment_amt;
          manageChart(short_exercise_name_lc, shouldDraw, numDaysAgo);

          $("#progress_exercises_optionholder label").css("font-weight","normal")
          $("#"+short_exercise_name_lc+"-label").css("font-weight","bold")
        });
      });


      $("#chart-date-decrementer").click(
        function() {
          playClickSound();

          num_days_ago_progress_showing = num_days_ago_progress_showing - num_days_ago_increment_amt;
          //if (num_days_ago_progress_showing < 0) num_days_ago_progress_showing = 0;

          var short_exercise_name_lc = $("#progress_exercises_optionholder :radio:checked").val() || "combined exercises"
          var shouldDraw, numDaysAgo;

          shouldDraw = true;
          numDaysAgo = num_days_ago_progress_showing;
          manageChart(short_exercise_name_lc, shouldDraw, numDaysAgo);

          shouldDraw = false;
          numDaysAgo = num_days_ago_progress_showing + num_days_ago_increment_amt;
          manageChart(short_exercise_name_lc, shouldDraw, numDaysAgo);

          shouldDraw = false;
          numDaysAgo = num_days_ago_progress_showing - num_days_ago_increment_amt;
          manageChart(short_exercise_name_lc, shouldDraw, numDaysAgo);
        });


        $("#chart-date-incrementer").click(
          function() {
            playClickSound();

            num_days_ago_progress_showing = num_days_ago_progress_showing + num_days_ago_increment_amt;

            var short_exercise_name_lc = $("#progress_exercises_optionholder :radio:checked").val() || "combined exercises"
            var shouldDraw, numDaysAgo;

            shouldDraw = true;
            numDaysAgo = num_days_ago_progress_showing;
            manageChart(short_exercise_name_lc, shouldDraw, numDaysAgo);

            shouldDraw = false;
            numDaysAgo = num_days_ago_progress_showing + num_days_ago_increment_amt;
            manageChart(short_exercise_name_lc, shouldDraw, numDaysAgo);

            shouldDraw = false;
            numDaysAgo = num_days_ago_progress_showing - num_days_ago_increment_amt;
            manageChart(short_exercise_name_lc, shouldDraw, numDaysAgo);
          });


      //numDaysAgo of 0 means up to today, numDaysAgo of 1 means up to yesterday, etc
      function manageChart(short_exercise_name_lc, shouldDraw, numDaysAgo) {
        if (short_exercise_name_lc == null) { //nothing is checked

        } else {
          var numDaysToShow = 7;
          var dateStrs, epochTimes;
          [dateStrs, epochTimes] = getDatesAndTimes(numDaysToShow, numDaysAgo);

          var repsDoneCounters = [];
          var bgColors = [];
          var labels = [];
          var stacked;

          if (short_exercise_name_lc == "combined exercises") { //for a graph of all the exercises (doesn't split by game though)
            $.each( exercises_map, function( index, exercise ) {
              if (exercise["enabled"] == true || TEST_MODE_ENABLED === true) {
                var exerciseGameNums = [];
                var repsDoneCounter = []; //use same array for all games within the same exercise
                $.each( games_map2, function( index, game ) {
                  if (game.shortExerciseName.toLowerCase() == exercise.short_exercise_name_lc) {
                    if (game["enabled"] == true || TEST_MODE_ENABLED === true) {
                      exerciseGameNums.push(game.exerciseGameNum);
                      loadRepChartData(game.exerciseGameNum, epochTimes, repsDoneCounter);
                    }
                  }
                });

                repsDoneCounters.push(repsDoneCounter);
                var border_color = exercise.background_color_rgba;
                bgColors.push( border_color.substring(0,border_color.lastIndexOf(",")) + "," + 0.2 + ")" );
                var label = exercise.short_exercise_name_lc;
                if (label == null || label == "" ) {
                  label = "Label";
                } else {
                  label = label[0].toUpperCase() + label.substring(1); //make title case from lowercase
                }
                labels.push(label);
              }
            });

            stacked = true; //stacked should definitely be true for individual exercises, but idk about for combined

          } else {// For graphs of games within individual exercises.
            var exercise = exercises_map.find((exercise) => exercise.short_exercise_name_lc === short_exercise_name_lc);
            var games_for_this_exercise = games_map2.filter( function (value, index) {
               return value["enabled"]==true && value.shortExerciseName.toLowerCase() == short_exercise_name_lc;
            });

            $.each( games_for_this_exercise, function( index, game ) {
              var repsDoneCounter = [];
              loadRepChartData(game.exerciseGameNum, epochTimes, repsDoneCounter);
              repsDoneCounters.push(repsDoneCounter);
              //Our border color will be the background_color. Then will add transparency to get our background colors
              var border_color = exercise.background_color_rgba;
              //assume that the color is in the form "rgba(48,171,223,1)" and not as a hex
              bgColors.push( border_color.substring(0,border_color.lastIndexOf(",")) + "," + ( (1-index/(games_for_this_exercise.length))) + ")" );
              labels.push(game.longGameName);
            });

            stacked = true; //stacked should definitely be true for individual exercises, but idk about for combined

          }

          if (shouldDraw) {
            drawChart(dateStrs, labels, repsDoneCounters, stacked, bgColors);
          }

        }
      }

      //numDaysAgo of 0 means up to today, numDaysAgo of 1 means up to yesterday, etc
      function getDatesAndTimes(numDaysToShow, numDaysAgo) {
        var dt = new Date();
        dt.setDate(dt.getDate()-numDaysAgo);

        //setHours dt to midnight of current day/last night (returns back epoch time, but also changes the object itself)
        //will create first element of epochTimes. There will eventually be numDaysToShow+1 elements.
        var epochTimes = [ dt.setHours(24,0,0,0) ];
        var repsDoneCounter = [];
        var dateStrs = [];
        for (var it = 0; it < numDaysToShow; it++) { //this for loop goes backwards (i.e. epochTimes is added front to back)
          //Subtract by one "day", which is not necessarily 24 hours because of daylight savings
          epochTimes.unshift(dt.setDate(dt.getDate()-1)); //unshift adds to the beggining of the array (as opposed to .push)
          repsDoneCounter.push(0);
          dateStrs.unshift( (dt.getMonth()+1) + "/" + dt.getDate() );
        }

        return [dateStrs, epochTimes, repsDoneCounter];
        //epochTimes should have numDaysToShow+1 as of this point

      }
      function loadRepChartData(exerciseGameNum, epochTimes, repsDoneCounter) {
        //repsDoneCounter is just full of 0s, and has length of numDaysToShow

        //Now go through each entry in firebase and add up the reps
        var ref = firebase.database().ref('gameActions/' + uid + '/' + exerciseGameNum + '/');
        //have one .startAt/.endAt for all of them combined instead of each one for cleaner code and presumably faster results
        ref.orderByChild('endUnixTime').startAt(epochTimes[0]/1000).endAt(epochTimes[epochTimes.length-1]/1000).on("child_added",
         function(snapshot) {
           var thisEndUnixTime = snapshot.child('endUnixTime').val();
           var repsCompletedTot = snapshot.child('repsCompletedTot').val(); //should be repsCompletedEquivalentTot for the new system, but if we want to use old data repsCompletedTot
           if (repsCompletedTot != null) {
             var my_it = 0;
             while (my_it < epochTimes.length) { //go through each one. There are definitely faster methods (like binary sort), but this works.
               if (thisEndUnixTime >= epochTimes[my_it]/1000) {
                 my_it++
               } else {
                 my_it--; //went too far, go one back
                 break;
               }
             }
             //increment by repsCompletedTot (x || 0) means use value of 0 if x is null)
             repsDoneCounter[my_it] = (repsDoneCounter[my_it] || 0) + repsCompletedTot;
           }
         }, function(err) {
          console.log("Error: " + err);
        });
      }


      function drawChart(dateStrs, labels, repsDoneCounters, stacked, bgColors, borderColors) {
        var ctx = $("#progress_bar_chart");
        var datasets = [];
        for (var it=0; it < labels.length; it++) {
          //if bgColors or bgColors[it] is not defined, then make it gray at 100
          //borderColor is the same as bgColor, but last element is not transparenet
          var bgColor = bgColors==null || bgColors[it]==null ? 'rgba(100, 100, 100, 0.2)' : bgColors[it];
          //Below default border color is the same as background but not transparent
          //var defaultBorderColor = bgColor.substring(0,bgColor.lastIndexOf(",")) +  ", 1)";
          var defaultBorderColor = "rgba(0,0,0, 0.3)"
          var borderColor = borderColors==null || borderColors[it]==null ? defaultBorderColor : borderColors[it];
          datasets.push({
              label: labels[it],
              data: repsDoneCounters[it],
              backgroundColor: bgColor,
              borderColor: borderColor,
              borderWidth: 1
          });
        }
        //var ctx = document.getElementById("progress_bar_chart").getContext('2d');
        var progress_bar_chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: dateStrs,
                datasets: datasets
            },
            options: {
                scales: {
                    xAxes: [{
                      stacked: stacked,
                      ticks: {
                        fontSize: 14,
                        fontColor: "#000"
                      },
                      gridLines: {
                        fontSize: 14,
                        color: "#000",
                        lineWidth: 3,
                        display: false,
                      },
                    }],
                    yAxes: [{
                      stacked: stacked,
                      ticks: {
                        fontSize: 14,
                        fontColor: "#000",
                        beginAtZero:true,
                        suggestedMin: 0,
                        suggestedMax: 15, //Will be at least this, but will go higher if needed for the data
                      },
                    }]
                },
                legend: {
                    labels: {
                        // This more specific font property overrides the global property
                        // Unfortunatelly, making it Raleway with the below code didn't work
                        defaultFontFamily: "'Raleway', 'Arial', 'Helvetica', serif"
                    }
                }
            }
        });
      }
    </script>
  </div> <!-- Progress Main screen -->



  <!-- ===================== -->
  <!-- TUTORIAL SCREENS PAGES-->
  <!-- ===================== -->

  <div data-role="page" id="tutorial-main" data-theme="c">
    <div data-role="header" class="header-bar"> Guide </div>
    <div data-role="main" class="ui-content" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">

      <div style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
        Hello and welcome to MoTrack Therapy! Check here to see if you can find the answer to your question. If you need additional help, don’t hesitate to email us at <a class="text-contact-info" target="external" href="mailto:support@motracktherapy.com">support@motracktherapy.com </a> or text/call us
        at <a class="text-contact-info" target="external" href="tel:+1-732-456-5701">732-456-5701</a>.
      </div>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
        <p> Basic Walk-through </p>
        <input type="button" data-enhanced="true" value="Walk-through" id="walk-through-button">
      </div>

      <div class="ui-input-btn ui-btn ui-corner-all ui-shadow" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
        <p> FAQs </p>
        <input type="button" data-enhanced="true" value="FAQs" id="faqs-button">
      </div>
    </div> <!-- main -->


    <script type="text/javascript">
      $("#walk-through-button").click(function() {
        playClickSound();
        navigateTo("#tutorial-walk-through");
      });
      $("#faqs-button").click(function() {
        playClickSound();
        navigateTo("#tutorial-faqs");
      });
    </script>
  </div> <!-- Tutorial Main screen -->


  <div data-role="page" id="tutorial-walk-through" data-theme="c">
    <div data-role="header" class="header-bar"> Walk-through </div>
    <div data-role="main" class="ui-content" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
      <a id="tutorial-hand-positioning-button" data-icon="carat-r" data-iconpos="right" data-role="button" data-mini="true" class="walk-through-nav">
        1. Hand Positioning
      </a>
      <a id="tutorial-main-menu-button" data-icon="carat-r" data-iconpos="right" data-role="button" data-mini="true" class="walk-through-nav">
        2. Main Menu
      </a>
      <a id="tutorial-exercise-sets-button" data-icon="carat-r" data-iconpos="right" data-role="button" data-mini="true" class="walk-through-nav">
        3. Exercise Sets
      </a>
      <a id="tutorial-progress-bars-button" data-icon="carat-r" data-iconpos="right" data-role="button" data-mini="true" class="walk-through-nav">
        4. Progress Bars
      </a>
      <a id="tutorial-instructions-screen-button" data-icon="carat-r" data-iconpos="right" data-role="button" data-mini="true" class="walk-through-nav">
        5. Game Directions
      </a>
      <a id="tutorial-game-setup-button" data-icon="carat-r" data-iconpos="right" data-role="button" data-mini="true" class="walk-through-nav">
        6. Game Setup
      </a>
      <a id="tutorial-game-play-button" data-icon="carat-r" data-iconpos="right" data-role="button" data-mini="true" class="walk-through-nav">
        7. Game Play
      </a>
    </div> <!-- main -->

    <script type="text/javascript">
      $("#tutorial-hand-positioning-button").click(function() {
        playClickSound();
        navigateTo("#tutorial-hand-positioning");
      });
      $("#tutorial-main-menu-button").click(function() {
        playClickSound();
        navigateTo("#tutorial-main-menu");
      });
      $("#tutorial-exercise-sets-button").click(function() {
        playClickSound();
        navigateTo("#tutorial-exercise-sets");
      });
      $("#tutorial-progress-bars-button").click(function() {
        playClickSound();
        navigateTo("#tutorial-progress-bars");
      });
      $("#tutorial-instructions-screen-button").click(function() {
        playClickSound();
        navigateTo("#tutorial-instructions-screen");
      });
      $("#tutorial-game-setup-button").click(function() {
        playClickSound();
        navigateTo("#tutorial-game-setup");
      });
      $("#tutorial-game-play-button").click(function() {
        playClickSound();
        navigateTo("#tutorial-game-play");
      });
    </script>
  </div> <!-- Basic Walk-through Summary screen-->


  <div data-role="page" id="tutorial-hand-positioning" data-theme="c">
    <div data-role="header" class="header-bar"> </div>
    <div data-role="main" class="tutorial-content">
      <div class="tutorial-navigator">
        <div class="tutorial-header"> 1. Hand Positioning </div>
        <button id="walk-through-back-button-1" data-inline="true" data-icon="arrow-l" data-iconpos="notext" data-mini="true" data-direction="reverse"> Up </button>
        <button id="walk-through-next-button-1" data-inline="true" data-icon="arrow-r" data-iconpos="notext" data-mini="true"> Down </button>
      </div>

      <div class="tutorial-text">
        Please put your phone face up on a flat, stable surface such as a table or the floor (if you’re sitting on the ground). The phone should remain flat on this surface for the entirety of app usage. For each game, directions will be provided so
        you know whether your phone should be oriented in portrait mode (Portrait) or landscape mode (horizontal).
        During the games, please position your hand above the phone camera so your entire hand is visible and can be seen on the screen. If your arm gets tired, we recommend resting your elbow on the flat surface while keeping your hand elevated.
        For the app to work best, please make sure there are no lights directly overhead.
      </div>
    </div> <!-- main -->
  </div> <!-- Basic Walk-through Hand Positioning screen-->


  <div data-role="page" id="tutorial-main-menu" data-theme="c">
    <div data-role="header" class="header-bar"> </div>
    <div data-role="main" class="tutorial-content">
      <div class="tutorial-navigator">
        <div class="tutorial-header"> 2. Main Menu </div>
        <button id="walk-through-back-button-2" data-inline="true" data-icon="arrow-l" data-iconpos="notext" data-mini="true" data-direction="reverse"> Up </button>
        <button id="walk-through-next-button-2" data-inline="true" data-icon="arrow-r" data-iconpos="notext" data-mini="true"> Down </button>
      </div>
      <img src="Dropbox/ui_media/tutorial/tutorial_main_menu.jpeg" style="width: 45%" class="centered-image" />
      <div>On the main menu, you’ll see several different options to choose from. If you want to get started with your exercises, please select “Exercises.” If you would like to give us feedback on your experience with the app, you can select
        “Feedback Survey.” If you have trouble using the app, you can come back to this tutorial with the “Tutorial” button. You can also log out if you’re done with your exercise session.</div>

    </div> <!-- main -->
  </div> <!-- Basic Walk-through Main Menu screen-->


  <div data-role="page" id="tutorial-exercise-sets" data-theme="c">
    <div data-role="header" class="header-bar"> </div>
    <div data-role="main" class="tutorial-content">
      <div class="tutorial-navigator">
        <div class="tutorial-header"> 3. Exercise Sets </div>
        <button id="walk-through-back-button-3" data-inline="true" data-icon="arrow-l" data-iconpos="notext" data-mini="true" data-direction="reverse"> Up </button>
        <button id="walk-through-next-button-3" data-inline="true" data-icon="arrow-r" data-iconpos="notext" data-mini="true"> Down </button>
      </div>
      <img src="Dropbox/ui_media/tutorial/tutorial_exercise_sets.png" style="width: 45%" class="centered-image" />
      Here, you will see a list of exercise sets (ex. open palm/closed fist, radial ulnar deviation, etc.). Each set has exercises that will require you to move your hand in different ways, helping you regain full functionality of your hand.

    </div> <!-- main -->
  </div> <!-- Basic Walk-through Exercise Sets screen-->

  <div data-role="page" id="tutorial-progress-bars" data-theme="c">
    <div data-role="header" class="header-bar"> </div>
    <div data-role="main" class="tutorial-content">
      <div class="tutorial-navigator">
        <div class="tutorial-header"> 4. Progress Bars </div>
        <button id="walk-through-back-button-4" data-inline="true" data-icon="arrow-l" data-iconpos="notext" data-mini="true" data-direction="reverse"> Up </button>
        <button id="walk-through-next-button-4" data-inline="true" data-icon="arrow-r" data-iconpos="notext" data-mini="true"> Down </button>
      </div>
      <img src="Dropbox/ui_media/tutorial/tutorial_progress_bars.png" style="width: 100%" class="centered-image" />
      Below each exercise set is a progress bar. As you do exercises from each set, the progress bar will fill up.

    </div> <!-- main -->
  </div> <!-- Basic Walk-through Progress Bars screen-->


  <div data-role="page" id="tutorial-instructions-screen" data-theme="c">
    <div data-role="header" class="header-bar"> </div>
    <div data-role="main" class="tutorial-content">
      <div class="tutorial-navigator">
        <div class="tutorial-header"> 5. Game Directions </div>
        <button id="walk-through-back-button-5" data-inline="true" data-icon="arrow-l" data-iconpos="notext" data-mini="true" data-direction="reverse"> Up </button>
        <button id="walk-through-next-button-5" data-inline="true" data-icon="arrow-r" data-iconpos="notext" data-mini="true"> Down </button>
      </div>
      <img src="Dropbox/ui_media/tutorial/tutorial_instructions_screen.png" style="width: 45%" class="centered-image" />
      Once you select an exercise set and an exercise, you will be brought to an instruction screen that looks like the one pictured below. The screen will remind you what exercise you’re doing (“fist”), the number of times you will perform the
      exercise during the game (“10”), and how you should position your phone (“Portrait,” or in portrait position). Below there is also a graphic showing you how to do the exercise (in this case, going from a closed fist to an open palm motion).
      When you’re ready, you can hit the “let’s play” button to begin.

    </div> <!-- main -->
  </div> <!-- Basic Walk-through Instructions Screen screen-->


  <div data-role="page" id="tutorial-game-setup" data-theme="c">
    <div data-role="header" class="header-bar"> </div>
    <div data-role="main" class="tutorial-content">
      <div class="tutorial-navigator">
        <div class="tutorial-header"> 6. Game Setup </div>
        <button id="walk-through-back-button-6" data-inline="true" data-icon="arrow-l" data-iconpos="notext" data-mini="true" data-direction="reverse"> Up </button>
        <button id="walk-through-next-button-6" data-inline="true" data-icon="arrow-r" data-iconpos="notext" data-mini="true"> Down </button>
      </div>
      Once you hit “let’s play,” you will see a countdown on the screen during which you will need to move your hand and head out of the view of the camera. At the end of the countdown, the screen will change to a different background and you can
      bring your hand back into view.
      <div>If the background looks like it’s glitching, make sure there’s no direct light overhead. Then hit the “reset” button, which will take you back to the countdown, and try again.</div>


    </div> <!-- main -->
  </div> <!-- Basic Walk-through Game Setup screen-->

  <div data-role="page" id="tutorial-game-play" data-theme="c">
    <div data-role="header" class="header-bar"> </div>
    <div data-role="main" class="tutorial-content">
      <div class="tutorial-navigator">
        <div class="tutorial-header"> 7. Game Play </div>
        <button id="walk-through-back-button-7" data-inline="true" data-icon="arrow-l" data-iconpos="notext" data-mini="true" data-direction="reverse"> Up </button>
        <button id="walk-through-next-button-7" data-inline="true" data-icon="arrow-r" data-iconpos="notext" data-mini="true"> Down </button>
      </div>
      Make sure your full hand is in view of the camera. Arrows should pop up on the screen to let you know which motion you should be doing. Text on the screen will also let you know whether you should hold the current position of your hand or
      readjust your hand to the correct position. There will also be text displaying your score, which will increase by a point each time you perform a motion correctly.

    </div> <!-- main -->
  </div> <!-- Basic Walk-through Game Play screen-->

  <div data-role="page" id="tutorial-faqs" data-theme="c">
    <div data-role="header" class="header-bar"> </div>
    <div data-role="main" class="ui-content" style="padding-top: 5px; padding-bottom: 5px; /*default is 17 top and bottom padding*/">
      <div class="tutorial-header"> FAQs </div>
      <div align="left">
        <div class="faq-content">Q: The app asked for camera access. Do I allow it? </div>
        A: Yes, please allow MoTrack access to your camera! We use the camera to track the motion of your hand, making at-home hand therapy interactive and engaging. We promise the camera doesn’t track you while you’re not using our app!
         
        <div class="faq-content">Q: Doing these exercises is making my wrist hurt!</div>
        A: If our exercises are making your wrist hurt and you are a hand patient, please stop immediately—it’s important to trust what your body is telling you. That being said, if the pain is the same type you experience when doing exercises with
        your therapist in-clinic, that is natural and you can continue on although it’s important to communicate these experiences directly to your therapist.
        <div>If it’s specifically our exercises that are making your hand hurt (for example, if you feel as though you have to contort your hand unnaturally to gain points), try readjusting the positioning of your hand. Try the exercises with your
          hand closer or farther away from the camera. Ensure there’s nothing moving or no lights directly overhead. If you’re wearing baggy clothing, roll up your sleeve to make sure the camera can see your hand and arm as clearly as possible. You
          can find more tips and tricks in our other tutorial section, “Game Play.” </div>
         
        <div class="faq-content">Q: The background is glitching. What do I do?</div>
        A: First, check your setup. Ensure there’s nothing moving (ex. ceiling fans) or lights directly overhead. Then hit the “reset” button, which should bring you back to the screen that will tell you to move your head and hands out of the frame
        of the camera. Follow these instructions. At the end of the countdown when the background reappears, move your hand back into view of the camera while making sure nothing else is visible (ex. head). If you’re wearing baggy clothing, roll up
        your sleeve to make sure the camera can see your hand and arm as clearly as possible.
         
        <div class="faq-content">Q: I’m doing the exercise correctly (I swear!) but I’m not earning any points! What’s up with that?</div>
        A: We recommend you move your hand different distances away from the phone camera to see if there’s an ideal height at which the phone can detect the position of your hand. This height may differ between the different games.
        <div>You can also make sure the background isn’t glitching. To do this, see the section right before this one, “The background is glitching. What do I do?”</div>
        <div>If you’re wearing baggy clothing, roll up your sleeve to make sure the camera can see your hand and arm as clearly as possible.</div>
        <div>Finally, you can make sure you are holding your hand in the correct position for a long enough period of time. The screen will say “hold” for 3 seconds. Please hold your current position until the screen reads “readjust,” at which point
          you can move your hand to the next position.</div>
        <div>If you are still experiencing difficulties, don’t hesitate to contact us (information below).</div>
         
        <div class="faq-content">Q: Why is there a button called “Feedback Survey” and when do I use it?</div>
        <div>A: If you’re one of our alpha testers, please take the Feedback Survey after trying out the app. Ideally, we would like you to use our app over the course of a week, as if you were truly a hand patient. However, we know this isn’t
          feasible for everybody, so take it whenever you feel like you’re done testing the app. Our app is built on feedback, so PLEASE take the time to go through this, we promise it’s very short! We appreciate your participation!</div>
         
        <div class="faq-content">Q: How do I contact you?</div>
        A: First of all, please, please, please get in touch with us whenever you need to, whether you’re experiencing difficulties with the app or want to offer some feedback. We’d love to hear back from you! Our information is below. You can also
        take our user survey by going back to the Main Menu and selecting “Feedback.”
      </div>
      <div>
        Phone/text: <a style="color:#30ABDF" target="external" href="tel:+1-732-456-5701">732-456-5701</a>
      </div>
      <div>
        Email: <a style="color:#30ABDF" target="external" href="mailto:support@motracktherapy.com">support@motracktherapy.com</a>
      </div>
      <div>
        Website: <a style="color:#30ABDF" target="external" href="https://motracktherapy.com">https://motracktherapy.com</a>
      </div>
      <div>
        Anonymous suggestions: <a style="color:#30ABDF" target="external" href="http://freesuggestionbox.com/pub/cmeefzy">http://freesuggestionbox.com/pub/cmeefzy</a>
      </div>
    </div> <!-- main -->
  </div> <!-- FAQs screen-->


  <script type="text/javascript">
    function getVersionsRefFromFirebase() {
      //Goes into versions folder -> Android or iOS folder -> then finds the single greatest version that is less than or equal to this app's version
      //it does this by ordering the versions increasing order, taking only the ones <= versionCode, and then taking the last one of that
      var versionCodeStr = (versionCode+"");
      while (versionCodeStr.length < 4) versionCodeStr = "0" + versionCodeStr;
      return firebase.database().ref('versions/' + (device == ANDROID_DEVICE ? 'Android' : 'iOS') + '').orderByKey().endAt( device==OTHER_DEVICE ? "100000000" : versionCodeStr ).limitToLast(1);
    }

    function setCalibAlgorithm(background_calib_algorithm) {
      if (device == ANDROID_DEVICE) {
        Android.setCalibAlgorithm(exerciseGame, which_hand_intended, nrtbc_each);

      } else if (device == IOS_DEVICE) {
        //last two digits are nrtbc_each, two digits before that are which_hand_intended, and anything before that are exerciseGame. EX 1500110
        window.webkit.messageHandlers.setCalibAlgorithm.postMessage(background_calib_algorithm);

      } else if (device == OTHER_DEVICE) {

      } else {
        console.log("Error. Device number is not one of the possible numbers.")
      }
    }

    function startGame(exerciseGame, which_hand_intended, nrtbc_each) {
      console.log("Started game with which_hand_intended: " + which_hand_intended);
      if (device == ANDROID_DEVICE) {
        Android.startGame(exerciseGame, which_hand_intended, nrtbc_each);

      } else if (device == IOS_DEVICE) {
        //last two digits are nrtbc_each, two digits before that are which_hand_intended, and anything before that are exerciseGame. EX 1500110
        window.webkit.messageHandlers.startGame.postMessage(exerciseGame*100*100 + which_hand_intended*100 + nrtbc_each);

      } else if (device == OTHER_DEVICE) {

      } else {
        console.log("Error. Device number is not one of the possible numbers.")
      }

    }

    function getVolumeLevelRatio() {
      if (device == ANDROID_DEVICE) {
        return Android.getVolumeLevelRatio();
      } else if (device == IOS_DEVICE) {
        console.log("checkIfSoundIsOn is not available on iOS. ");
      } else if (device == OTHER_DEVICE) {
        console.log("checkIfSoundIsOn is not available on other devices. ");
      } else {
        console.log("checkIfSoundIsOn is not available. ");
      }
      return -1;
    }

    function showAndroidToast(toast, importance) {
      importance = importance || 0;

      if (is_test_account || importance>0) {
        if (device == ANDROID_DEVICE) {
          Android.showToast(toast);
        } else if (device == IOS_DEVICE) {
          console.log("TOAST: " + toast);
        } else if (device == OTHER_DEVICE) {
          console.log("TOAST: " + toast);
        } else {
          console.log("Error. Device number is not one of the possible numbers.");
          console.log("TOAST: " + toast);
        }
      }

    }

    function setDisplayExtraInfo(displayAmount) {
      if (device == ANDROID_DEVICE) {
        Android.setDisplayExtraInfo(displayAmount);
      } else if (device == IOS_DEVICE) {
        window.webkit.messageHandlers.setDisplayExtraInfo.postMessage(displayAmount);
      } else if (device == OTHER_DEVICE) {
        console.log("setDisplayExtraInfo is not available on this device. ");
      } else {
        console.log("Error. Device number is not one of the possible numbers.");
        console.log("TOAST: " + toast);
      }
    }

    function setGameSoundsEnabled(enabled) {
      if (device == ANDROID_DEVICE) {
        Android.setGameSoundsEnabled(enabled);
      } else if (device == IOS_DEVICE) {
        window.webkit.messageHandlers.setGameSoundsEnabled.postMessage(enabled);
      } else if (device == OTHER_DEVICE) {
        console.log("setDisplayExtraInfo is not available on this device. ");
      } else {
        console.log("Error. Device number is not one of the possible numbers.");
        console.log("TOAST: " + toast);
      }
    }

    function navigateTo(toURL) {
      //window.location = toURL;
      $.mobile.changePage(toURL, {
        transition: "slidefade"
      });
      //$.mobile.changePage(toURL, { transition: "slidefade", changeHash: false });
    }

    function playClickSound() {
      if (is_sound_enabled) {
        new Audio("Dropbox/ui_media/sounds/click.wav").play();
      }

    }
    'use strict';

  </script>

  <script src="helperfunctions.js"></script>


</body>

</html>
